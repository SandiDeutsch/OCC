<html><head><meta charset="utf-8"/><meta content="CCSP UI Help - Agent - Part 2" name="description"/></head><body><article><section><p>Check Time
This block routes calls by the time range that you select.
Properties
Values
Description
Time Zone
Local
The current local time for the connection server is used.
GMT
The current GMT time is used.
Configure the Check Time block
1.
Right-click the block and click Add case. The Time dialog appears.
2.
Enter a time range.
3.
Optionally, in Label, type an alternative description.
4.
Click OK. The Case branch
appears.
5.
Connect the Case branch to the appropriate block in the script.
CCSP Designer Help - Tenant - 7.4
134</p><p>6.
Repeat steps 1-5 to add the branches you need.
7.
Connect the Else branch
to the appropriate block in the script.
Clear Digits
This block clears the digit buffer before the script processes the next command. This block is typically used to
clear wrong digits entered from the buffer before prompting the caller to reenter the digits.
For example, "The Customer ID you entered is not valid, please try again".
Then clear the digits and return to the GetDigits block.
Properties
Values
Description
Line
Inbound
The function is applied to the original (incoming) call.
Outbound
The function is applied to the outbound call (to where the call is transferred).
Clear Digits Events
This block clears the digit buffer before the script processes to the next command. This block is typically used
before you want to subscribe to the On Digits event, used by the Set Event block.
CCSP Designer Help - Tenant - 7.4
135</p><p>Clear User Data
This block clears the line you that you specify.
Properties
Values
Description
Line
String
Inbound or outbound line which you want to clear. Clears the user data buffer on
the selected line. Any data received up to this point that has not been processed
by the Get User Data block is discarded.
Condition
This block contains an expression which can be evaluated as True or False.
Properties
Values
Description
Expression
True or False
Causes branching in the script so must be able to be evaluated as True or
False.
This property is data-type sensitive. For string to string comparison, text
should be surrounded by quotes on both sides.
For example, "$CallData.callset Name$" &lt;&gt; "" returns True if the
Queue has not been configured.
Note
Be careful when using variables in the Expression property of the Condition block. The way that the
interpreter expands variables into an intermediate string before using them can cause the interpreter to
incorrectly evaluate an expression. This is the only property in Designer in which you must use quotes (") to
denote a string. Furthermore, if a variable is to be evaluated as a string, enclose the variable in quotes.
CCSP Designer Help - Tenant - 7.4
136</p><p>Define Grammar
This block defines the Automatic Speech Recognition (ASR) grammar used in the application.
Properties
Values
Description
Grammar
Text
A grammar can be specified in the following ways:
l
Refer to a built-in grammar.
l
Specify it by using XML.
l
Refer to the URI of a grammar stored on a web server.
Content-Id
Text
ID or name for the grammar by which it will be referenced, for example,
request1@form-level.store.
Comment
Text
User description of the block in the script.
CCSP Designer Help - Tenant - 7.4
137</p><p>Routing
To include routing, add Success and Else cases, as show in the following example.
Note
In case of error (Else case), there is an additional delay of 5 seconds until the MRCP server responds to the
request.
CCSP Designer Help - Tenant - 7.4
138</p><p>Backward compatibility
To maintain backward compatibility in existing scripts, this block treats the next block it is directly connected to
as the Success case, as show in the following example.
Caution
If you delete the connection between the original DefineGrammar and Wait blocks, you must reconnect it
through the Success case.
CCSP Designer Help - Tenant - 7.4
139</p><p>Edit Email
This block allows manipulation of the email fields.
Properties
Values
Description
Rule
Reply To
If set, the reply to the email is sent to this address.
From
Email originator's email address.
To
Primary recipient's email address.
CC
Carbon copy - secondary recipient's email address.
BCC
Blind carbon copy – private secondary recipient's email address.
Subject
Email's title.
Importance
Email's priority level:
l
Low — low priority
l
Normal — normal priority
l
High — high priority
l
NoChange — leave as is
Note
l
A validation process runs on the input of the email address values. If validation fails, the email is moved
to the Sent Items folder with the Invalid state.
l
Validation is minimal and doesn’t cover the full RFC 5322.
All recipient email address fields can have multiple values separated by a semi-colon (;).
Email addresses can be configured to display as follows.
Syntax
Example
Only email address
Jane.Green@enghouse.com
Name and email address
Jane &lt; Jane.Green@enghouse.com&gt;
Name with quotation marks (“").
"Jane" &lt; Jane.Green@enghouse.com&gt;
CCSP Designer Help - Tenant - 7.4
140</p><p>Syntax
Example
Usually used when the display name includes
a space.
Email address with left and right angle
brackets (&lt;&gt;)
&lt;Jane.Green@enghouse.com&gt;
Multiple email addresses - combination of any
of the above formats
Jane.Green@enghouse.com;
Simon.Brown@enghouse.com;Julie.Black@enghouse.com
To set the Reply To, To, CC, and BCC fields to empty, use $empty$. See How to use the $empty$ constant.
CCSP Designer Help - Tenant - 7.4
141</p><p>Get Agent Statistics
This block allows polling of the Realtime Reports (RTR) server to make decisions based upon current agent
activity.
Properties
Values
Description
URL to
RTRWeb
Web address
The location of the RTR server as a URL. For example,
http://ais.yourcompany.com/rtrdll/
This can be specified as an IP address.
Caution
This should be only the path to the RTRWeb.dll file, and should not
include the RTRWeb.dll filename.
RTR Timeout 
Seconds
Maximum time to wait for RTR to respond before continuing on to the
next block. Default is 10 seconds.
Note
This property is a new feature of this block. When you apply the
corresponding hot fix to existing scripts, the default value does not
appear but is still applied.
Group Name
String
You can select the group name from a drop-down list of available
groups in the tenant. This list is refreshed every time you select the
block. If a new group is added while you are editing the block, to see
the added group, select another block or select the Flow editor
background and then reselect the Get Agent Statistics block.
If a group is removed from the tenant and the value is currently being
used as the group name, the value remains as the selected value, until
you manually change it. You are not restricted to the values provided in
the drop down list, so you can use an expression as the selected value.
CCSP Designer Help - Tenant - 7.4
142</p><p>Properties
Values
Description
Agent state
Initialized
Get statistics on all agents who are currently initialized.
All
Get statistics on all agents who are logged on.
Available
Get statistics on all agents who are logged on and waiting for calls.
Available In Call
Get statistics on all agents who are in one or more calls but may have
capacity for additional calls.
Released
Get statistics on all agents who are unavailable to take calls.
Released In Call
Get statistics on all agents who are in one or more calls but not
available for additional calls.
Agent in call
state
All
Get statistics on all agents who are in all the following states.
In Call
Get statistics on all agents who are in the In all state.
On Hold
Get statistics on all agents who are in the On Hold state.
Preview
Get statistics on all agents who are in the Preview state.
Ringing
Get statistics on all agents who are in the Ringing state.
Wrap Up
Get statistics on all agents who are in the Wrapup state.
Call Type
Caution
For valid combinations, see the following table.
All
For cumulative stats for all call types.
CallBack
For callback calls only.
Internet
For chat calls.
Message
For email or voicemail messages.
Multiple
For multichat agents.
Phone
For voice calls.
Result Variable
String
Variable name in which to store a returned value for further
processing.
Returns -1 for timeout or failure.
See How to use variables.
The valid combinations of Agent state, Agent in call state, and Call type are as follows.
CCSP Designer Help - Tenant - 7.4
143</p><p>Agent state
Agent in call state
Call type
Initialized
N/A
N/A
Available
N/A (All)
N/A (All)
Ringing
N/A (All)
Available In Call
In Call
CallBack, Internet, Message, Multiple, Phone
On Hold
CallBack, Internet, Message, Multiple, Phone
Preview
Phone
Ringing
Multiple
Wrap Up
CallBack, Internet, Message, Multiple, Phone
Released
N/A (All)
N/A (All)
Released In Call
In Call
CallBack, Internet, Message, Multiple, Phone
On Hold
CallBack, Internet, Message, Multiple, Phone
Preview
Phone
Wrap Up
CallBack, Internet, Message, Multiple, Phone
CCSP Designer Help - Tenant - 7.4
144</p><p>Get Digits
VCS only.
This block allows the script to capture DTMF digits (tones) entered by the caller.
Properties
Values
Description
Max Time
Seconds 
(integer)
Maximum amount of time to wait for the entire string of digits.
If Max Time is left blank, it is calculated by multiplying the Max Silence
(default is 3 seconds) by the Max Digits.
Max Silence
Seconds
(integer)
Maximum amount of time (silence) between digits.
If left blank the default is 3 seconds per digit. So if the number could be 3 or 4
digits, the Max Digits would be set to 4, and if 4 digits are entered, the
getDigits block ends. If 1, 2 or 3 digits are entered, the block waits 3 seconds
then ends.
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to terminate
this command.
For example, to allow any touch tone to be a termination digit, set this to
1234567890#*
Include
Termination
Yes or No
Include termination digit in the resulting string.
For example, the termination digit is # and caller enters 1234#.
If this is Yes, the result is 1234#. If this is No, the result is 1234.
Max Digits
Integer
Maximum number of DTMF digits allowed.
Result
Variable
String
Name of a variable into which the digit string is to be passed.
Must start with an alphabetic character and not exceed 255 characters in
length.
See How to use variables.
Clear Digits
Yes or No
Clear the digit buffer of any digits entered prior to this command. This should
be set to No by default.
Line
Inbound
The function is applied to the original (incoming) call.
Outbound
The function is applied to the outbound call (to where the call is transferred).
Note
If the caller has entered 10 digits and there are 5 GetDigits blocks, each with Max Digits set to 2, each
CCSP Designer Help - Tenant - 7.4
145</p><p>GetDigits block takes 2 digits so there will be 10, then 8 then 6, then 4 then 2 and after the 5th GetDigits
block there will be no digits left in the buffer, but only if none of the blocks have Clear Digits set to Yes.
CCSP Designer Help - Tenant - 7.4
146</p><p>Get Phone Information
This block allows an agent to view information about the caller displayed in the Chat window of their agent
application.
Caution
This block must be used in conjunction with the TARGUSinfo phone-based data service. To be able to use
this block, you need an account (Service ID) with TARGUSinfo, as well as a username and a password.
Properties
Values
Description
URL to WebGW
Web address
Currently, the default value for this is already entered in this field, and
should not be changed.
Service Id
Number
This is the account ID or Service ID assigned to your account by
TARGUSinfo.
User Name
String
The user name for this account.
Password 
String
The password for this account.
Phone Number
String
This number must be available to this block, either as the result of caller
input, or, for example, by getting line.ANI information from the Line
object.
Note
This service is only available for US and Canadian calls. This field only
accepts 10-digit phone numbers without spaces or characters other
than digits.
Result Variable
String
Variable name in which to store returned value(s) for further
processing.
See How to use variables.
Information fields
The following information fields are available in the Result Variable.
CCSP Designer Help - Tenant - 7.4
147</p><p>Field
Description
.Error
0 if the call was successful.
.Building
If the building has a name, such as the Empire State Building, that information may appear
here.
.Address
The street address of the caller
.City
The caller's city
.State
The caller's state
.Zip
The caller's 5-digit ZIP code
.Zip4
The caller's 4-digit ZIP code extension
.NameType
This is either B for a business or C for a home consumer number.
For B, a business, the following values appear:
l
.BusinessName — the name of this business
l
.BusinessSuffix — this field may show such information as "Inc.", "LTD", or "LLP".
For C, a home consumer, the following values appear:
l
.LastName — the caller's last name
l
.FirstName — the caller's first name
l
.MiddleInitial— the caller's middle initial
.TimeZone
The caller's time zone
CCSP Designer Help - Tenant - 7.4
148</p><p>Get Queue Statistics
This block allows polling of the Realtime Reports (RTR) server to make decisions based upon current queue
activity.
Properties
Values
Description
URL to
RTRWeb
Web address
The location of the RTR server as a URL. For example,
http://ais.yourcompany.com/rtrdll/
This can be specified as an IP address.
Caution
This should be only the path to the RTRWeb.dll file, and should not
include the RTRWeb.dll filename.
RTR
Seconds
Maximum time to wait for RTR to respond before continuing on to the
next block.
Default is 10 seconds.
Note
This property is a new feature of this block. When you apply the
corresponding hot fix to existing scripts, the default value does not
appear but is still applied.
Call Type
All
For cumulative statistics for all call types listed below.
CallBack
For callback calls only
Internet
For chat calls
Message
For email or voicemail messages
Phone
For voice calls
Statistic
Calls Waiting
Number of calls waiting in this queue
Calls Being Handled
Number of calls connected to agents
Longest Wait Time
Longest wait time of current calls in this queue
Average Wait Time
Average waiting time in this queue
Queue Name
String
To find this name, in CCSP Admin, use the toolbar to turn on Detail
view and from the Action menu, select Customize and enable the
First column in detail view.
CCSP Designer Help - Tenant - 7.4
149</p><p>Properties
Values
Description
Result
Variable
String
Variable name in which to store a returned value for further
processing.
Returns -1 for timeout or failure.
See How to use variables.
CCSP Designer Help - Tenant - 7.4
150</p><p>Get User Data
This block waits for data to arrive at the specified line during the time out interval and receives the data if it
arrives within that interval.
Properties
Values
Description
Line
String
Inbound or outbound line from which you want to get the data.
Termination Digits
0-9 # and *
Enter a digit, #, or * that terminates this command.
Timeout 
Integer
Optional. If greater than 0, the number of seconds to wait for
information.
-1
Infinite.
0
Zero timeout (do not block).
No value
Zero timeout (do not block).
Result Variable
String
Variable name to store value returned from this command. The
returned value is the body of the received INFO message.
The GetUserData block parses a SIP INFO message to retrieve its content values.
Build the SIP INFO message, as follows:
l
The content type is application/ccu-integration.
l
Format the content this way:
&lt;ParameterName1&gt;=&lt;ParameterValue1&gt; [Return]
&lt;ParameterName2&gt;=&lt;ParameterValue2&gt; [Return]
.
&lt; ParameterNamen&gt;=&lt;ParameterValuen&gt; [Return]
Retrieved values are recorded in the Result Variable of the block, as follows:
&lt;ReturnVariableName&gt;.&lt;ParameterName1&gt;
&lt;ReturnVariableName&gt;.&lt;ParameterName2&gt;
.
&lt;ReturnVariableName&gt;.&lt;ParameterNamen&gt;
CCSP Designer Help - Tenant - 7.4
151</p><p>GoTo
This block continues execution at a call block in this script or another script.
Properties
Values
Description
GoTo
Depends on where control is passed. See examples below.
Same
script
#RecordAudio924
(#NameOfBlock)
Different
script (top)
http://ServerName/Directory/CallArrival.xml
Different
script
(block)
http://ServerName/Directory/MusicOnHold.xml#PlayAudio865
ASP page
http://ServerName/Directory/DBLookup.asp
Method
GET or
POST
When the GoTo property is an ASP page, all Designer variables are
automatically sent to the page using either GET (query string) or POST (form).
The Method property controls how they are sent.
For example, the DBLookup.asp script uses GET (QueryString) to retrieve
information from the XML script as a URL. Therefore the GoTo block must also
use the GET method.
GoTo Voicemail
This block continues execution at the Leave Voicemail script or the Retrieve Voicemail script.
Properties
Values
Description
Voicemail script
Leave Voicemail or
Retrieve Voicemail
Leave the current script and execute the selected script. The
default is Leave Voicemail.
CCSP Designer Help - Tenant - 7.4
152</p><p>Hangup
VCS only.
This block terminates the call.
Properties
Values
Description
Line
Inbound
The .wav file is played to the original (incoming) caller.
Outbound
The .wav file is played to the transferee (the party to whom the call is
transferred).
CCSP Designer Help - Tenant - 7.4
153</p><p>IVR Recording
VCS only.
This block enables you to record parts of the IVR script.
The block is allowed only in the Ivr and Post Call scripts.
Properties
Values
Description
Action
Start
Starts recording.
Stop
Stops recording.
IVR recording always stops automatically at the end of the script. Consequently, a final IVR Recording block set
to Stop is not required.
Caution
l
The IVR recording includes everything a customer says while IVR recording is on.
l
IVR recordings are precise to 1 whole second, which means that the recording of a block may start too
soon or finish too early, unless you insert a Wait block set to 1 second before the start and stop IVR
Recording blocks. See the second example below.
l
Leave Voicemail and Record Voicemail blocks are not recorded. Additionally, they stop IVR recording. If
you want IVR recording to continue after these blocks, you must add a start IVR Recording block.
CCSP Designer Help - Tenant - 7.4
154</p><p>Examples
In the following example, the script records the Play 1 and Play 3 blocks, but not the Play 2 block.
CCSP Designer Help - Tenant - 7.4
155</p><p>IVR recordings are precise to 1 whole second, which means that the recording of a block may start too soon or
finish too early.
To handle this limitation, insert a Wait block set to 1 second before the start and stop IVR Recording blocks.
Leave Voicemail and Record Voicemail blocks are not recorded and stop the IVR recording.
If you want IVR recording to continue after these blocks, you must add a start IVR Recording block.
CCSP Designer Help - Tenant - 7.4
156</p><p>IVR Transfer Recording
This block records bridged calls to an external number.
It must be used after the Supervised Transfer, Transfer Call, or Bridge Call blocks.
CCSP Designer Help - Tenant - 7.4
157</p><p>Leave Voicemail
This block records voicemail. It replaces the deprecated Record Voicemail block.
Properties
Values
Description
Max Time
Seconds (integer)
Maximum length of recording. If left blank, the default is 300
seconds.
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to
terminate this command.
For example, to allow any touch tone to be a termination digit, set
this to 1234567890#*
Clear Digits
Yes or No
Clear the digit buffer of any digits entered prior to recording. The
default is No.
Beep Type
None
Type of beep to play at start of recording time, or none.
If left blank, the default is 0 (None).
Short, Normal, or Long
The filenames that correspond to the various beep lengths are:
l
beep_short.wav
l
beep.wav (default)
l
beep_long.wav
Line
Inbound
The function is applied to the outbound call (to where the call is
transferred).
Outbound
The function is applied to the Email address of the sender.
Store to DB
Yes or No
Determines if stored in recording database.
Note
If you select Yes, you must also set the mandatory From and
Recipient email addresses otherwise the voicemail is not stored in
the database.
Store
Voicemail
Folder or full file path
The folder is the valid directory path that holds the voicemail for
review before sending. The folder can be empty, in which case the
voicemail is not saved to a file.
If a folder is specified but not the filename, the filename is
assigned automatically by the system.
CCSP Designer Help - Tenant - 7.4
158</p><p>Properties
Values
Description
All recorded files are in MP4 format.
Note
Only the MP4 file is saved, not the call information file.
ACD Voicemail
String
Name of the tenant's voicemail folder. If left blank, the tenant's
default voicemail folder is used (default).
Interaction will ring at an agent as an ACD voicemail.
If set to none and Recipient or CC properties match the rules for
ACD voicemail, ACD voicemail is created with SMTP services only.
If left blank or has a value other than none, ACD voicemail is
created without SMTP services.
Note
See Examples below.
Segregation
Group Id
Integer
Group ID used to filter voicemail items in Supervisor Message
View.
Left blank by default.
From
String
When sending ACD voicemail over SMTP or when sending
voicemail as an email with an attachment, specify the email
address of the sender.
Recipients
String
Email addresses of recipients to which the voicemail will be sent
over SMTP.
Multiple email addresses can be delimited by a semi-colon (;).
If a recipient email address starts with voicemail, an ACD
voicemail interaction is created and rings at an agent as a
voicemail.
If a recipient email address matches one of the tenant’s email
folders, an ACD email interaction is created and rings at an agent
as an incoming email.
Left blank by default.
Note
See Examples below.
CC
String
Email addresses of recipients that will receive a carbon copy of the
voicemail being sent over SMTP.
For additional rules, see the Recipients property.
Note
See Examples below.
Subject
String
When sending voicemail as an email with an attachment, specify
the email subject.
Body
String
When sending voicemail as an email with an attachment, specify
the email body text.
CCSP Designer Help - Tenant - 7.4
159</p><p>Examples
The following table provides some examples of values for the ACD Voicemail and Recipients/CC properties
and the expected behavior.
In this example, the email addresses are:
l
folder@tenant.loc — the email address of a tenant’s CCSP folder defined in CCSP Admin
l
voicemailFolder@tenant.loc — the email address of a tenant’s folder for incoming voicemail only
l
someone@home.loc — the email address of a recipient external to CCSP
The expected behavior types shown in the table are:
1.
ACD voicemail is created without using SMTP services.
2.
ACD voicemail is created using SMTP services and rings at an agent as an ACD voicemail interaction.
3.
ACD email and a recording attachment are created using SMTP services and ring at an agent as an ACD
email interaction.
4.
Regular email and a recording attachment are created and sent to an external recipient using SMTP
services.
Note
As you can see in the table, ACD Voicemail is disabled when:
l
ACD Voicemail = none AND Recipient is empty AND CC is empty
l
ACD Voicemail = none AND Recipient/CC fields specify the email address of a tenant folder or the email
address of a recipient external to CCSP
ACD Voicemail parameter
Recipient/CC parameter
Expected behavior
Left blank or set to voicemail
1
Left blank or set to voicemail
folder@tenant.loc
1, 3
Left blank or set to voicemail
voicemailFolder@tenant.loc
1, 2
Left blank or set to voicemail
someone@home.loc
1, 4
Left blank or set to voicemail
folder@tenant.loc; voicemailFolder@tenant.loc;
someone@home.loc
1, 2, 3, 4
Set to none
folder@tenant.loc
3
Set to none
voicemailFolder@tenant.loc
2
Set to none
someone@home.loc
4
Set to none
folder@tenant.loc; voicemailFolder@tenant.loc;
someone@home.loc
2, 3, 4
CCSP Designer Help - Tenant - 7.4
160</p><p>Log
This block writes a message to the event log file on the connection server. This log file usually resides on each
connection server in the %TEMP%/CosmoDesigner directory. The actual location depends on the setting for the
logging directory registry key.
Ask your CCSP service provider for guidelines in using Log blocks in Designer scripts.
Properties
Values
Description
Message
String
Use for debugging purposes only.
Messages starting with the prefix:
l
"ERROR:", "WARNING:", or "INFO:" are printed in log files and also
automatically placed in the Windows Event Log.
l
"DEBUG:" are printed only in log files.
l
"TRACE:" are printed only in log files, provided that trace is enabled in CCSP
Admin.
Messages without one of the above prefixes are written in log files, regardless of
the level set in CCSP Admin (unless the setting is None).
The log files are:
l
Designer’s dedicated log-per-call file (must be enabled in CCSP Admin)
l
Syslog log file (must be enabled in CCSP Admin)
Note
Prefixes must be uppercase.
CCSP Designer Help - Tenant - 7.4
161</p><p>Logging Control
This block turns logging on or off for the duration of the current event.
At the end of the CallTermination event, CCSP emails the entire log file as an attachment to the designated
Recipient.
Note
l
If you want to turn logging on or off for the whole call, you must put a Logging Control block in every
event script.
l
If script logging is globally enabled and you disable logging via a Logging Control block for a certain
event script, CCSP still emails the logs of the other event scripts to the Recipient. The global script
logging settings determine the verbosity and behavior of these logs.
l
In the event script, logging follows the global script logging settings until CCSP parses the Logging
Control block.
Properties
Values
Description
Value
On or Off
Enable or disable logging.
From
Email address of the sender.
Must be in the form of mailbox@domainname
Ask your CCSP service provider for an email address to
use for this purpose.
Recipient
Email address to which to send
the log file.
Must be in the form of mailbox@domainname
This can be an email address outside of the CCSP
system domain.
This block is useful for testing if a new script ran or if a new branch of an IVR script ran and the result of each
block in that script after the Logging Control block.
CCSP Designer Help - Tenant - 7.4
162</p><p>Mask Digits
VCS only.
This block masks the DTMF digits (tones) entered by the caller so the caller's PIN digits are not entered in the
VCS log.
Properties
Values
Description
Mask digits
Yes or No
Enable or disable masking of DTMF digits in IVR. The default is No.
MD5 Encryption
This block encrypts any string variable using MD5 hashing. This is useful for taking sensitive data collected via
IVR and passing it to an external application.
Properties
Values
Description
URL
Web
address
Web services URL, for example,
http://www.abc.com/soap/GetClientInformation.asmx
String to
Encrypt
String
The string that is to be encrypted.
Note
This operation is a one-way hash function, and it is not possible to de-encrypt the
result variable.
This can only be used to verify the integrity of information passed to the system,
as the function returns the same result given the same input.
Timeout
String
Number of seconds to wait for response from the web service before timing out.
If the web service does not respond within the specified timeout, the operation
is aborted and a log entry is created in the Designer log as follows:
No response was received from
http://webserver/webservices/test.asmx. Operation aborted.
Result
Variable
String
A variable name where responses are being prefixed. See XML response
example, for example, myVar. The result is in MD5 Format4 encryption.
CCSP Designer Help - Tenant - 7.4
163</p><p>Menu
VCS only.
This block specifies menu behavior.
Properties
Values
Description
Menu Prompt
Filename
The sound file to play for menu options.
Enter a URL address to the file you wish to play.
Invalid Prompt
Filename
The sound file to play for an invalid choice.
Enter a URL address to the file you wish to play.
No Entry
Prompt
Filename
The sound file to play if the caller does not enter anything within Max Time.
Enter a URL address to the file you wish to play.
Termination
Digits
0-9 # and *
Enter digit(s), # or * . These value(s) can be used by the caller to terminate
this command.
For example, to allow any touch tone to be a termination digit, set this to
1234567890#*
Clear Digits
Yes or No
Clear the digit buffer of any digits entered before playing the audio file. The
default is No.
Max Time
Integer
Maximum amount of time in seconds to wait for the entire string of digits.
The default is 3.
Note
Typically 3 is too low a number to work reliably and this value is set to 10 or
3 x number of digits to be entered.
Max Tries
Integer
Maximum number of times the caller can respond to a prompt. The default
is 1.
Result Variable
String
Name of a variable into which the digit string is to be passed.
Must start with an alphabetic character and not exceed 255 characters in
length.
There is no default value for this, so leaving this field blank causes this block
not to function properly.
See How to use variables.
CCSP Designer Help - Tenant - 7.4
164</p><p>Properties
Values
Description
Line
Inbound
The next block in the script is applied to the original (incoming) call.
Outbound
The next block in the script is applied to the outbound call (to where the call
is transferred).
Configure the Menu block
1.
Right-click the block and click Add case. The Menu dialog appears.
2.
From the Menu list, select one or more menu items.
Note
This item is a key press option for the caller. If you select more than one digit, the case accepts any one of
your selected digits if it matches caller input.
3.
Optionally, in Label, type an alternative description.
4.
Click OK. The Case branch
appears.
5.
Connect the Case branch to the appropriate block in the script.
CCSP Designer Help - Tenant - 7.4
165</p><p>6.
Repeat steps 1-5 to add the branches you need.
7.
Connect the Else branch
to the appropriate block in the script.
CCSP Designer Help - Tenant - 7.4
166</p><p>Optional Parameters
Optional parameter values are available for the life of the call. These values are also available to the agent for
use in third party integrations. Two examples of possible optional parameters are Account_ID and
IncidentNumber.
For example, you can set an optional parameter in IVR named PathToWavFiles and use it in every Play Audio
block as follows: $CallData.Option("PathToWavFiles")$Greeting.wav to use a set of previously created
scripts without needing to edit every PlayAudio block, or to set the language of the .wav files.
Note
By default, optional parameters are not stored in the historical database because they would consume a
very large amount of storage. If you want to store optional parameters in the historical database, estimate
the additional storage requirements and request Enghouse Technical Support's assistance.
Properties
Values
Description
Parameter Name
String
Name of the parameter.
Optional parameter names are case sensitive.
Parameter Value
String (Boolean number)
Value of the parameter.
Real-Time Speech Analytics
To enable the output of recording files for post call analysis using the batch-mode integration with Real-Time
Speech Analytics (VoiceCoach), include an optional parameter called EVCConfiguration for each call that you
want processed. This parameter contains the name of the configuration to use.
The actual value does not matter to CCSP, its existence means the DTR will process the recording and output
the relevant files for Real-Time Speech Analytics. The value of this parameter is included in the resulting .dat
files.
CCSP UI CustomRing parameter
Note
l
CCSP UI was previously called TouchPoint.
l
If an agent selects auto-answer then CCSP does not play the ring tone. This setting is only for CCSP UI,
not IP phones or alternative devices.
A unique optional parameter is available for CCSP UI: CustomRing.
CCSP Designer Help - Tenant - 7.4
167</p><p>Use this optional parameter to send a customized ring file location (URL) when a call is delivered to CCSP UI.
This ring file can be used to announce any desired message to an agent before the call is picked up.
CCSP UI looks for a CustomRing optional parameter. This parameter should contain the URL for the desired
ring file.
If this parameter is present, CCSP UI ignores ring preferences and uses the ring file specified in the
CustomRing optional parameter.
CCSP Designer Help - Tenant - 7.4
168</p><p>Percent Allocated
This block sets the percentage point (based, for example, on the number of calls handled) at which calls are
sent along different paths.
All percent case blocks must add up to 100%.
Configure the Percent Allocated block
1.
Right-click the block and click Add Case.
2.
In the Add percentage dialog, enter the percentage and click OK.
3.
Repeat steps 1-2 to add the percentages you need.
CCSP Designer Help - Tenant - 7.4
169</p><p>Play Audio
VCS only.
This block plays an audio (.wav) file to the caller.
Note
PlayAudio only works in IVR, IVRTimeOut, CallRejected, MusicOnHold, and MusicOnHoldWhileInQueue
events.
Properties
Values
Description
Audio file
Filename
Enter a URL address to the file you wish to play.
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to terminate
this command.
For example, to allow any touch tone to be a termination digit, set this to
1234567890#*
Clear Digits
Yes or No
Clear the digit buffer of any digits entered before playing the audio file.
This should be set to No unless digits from a previous Get Digits block need
to be cleared. Since callers often become familiar with your IVR and enter
the digits for 2 or 3 prompts ahead, if you clear the digits you delete the
entries for the next one (or more) Get Digits block(s).
Line
Inbound
The .wav file is played to the original (incoming) caller.
Outbound
The .wav file is played to the transferee (the party to whom the call is
transferred).
Async Mode
Yes or No
Async Mode allows the script to do other tasks, for example, to verify a
customers ID number from a database, while a .wav file plays. The default is
No.
Caution
Asynchronous playback should only be used for one .wav file at a time.
Attempting to use Async Mode for multiple simultaneous .wav files can
produce unpredictable results.
CCSP Designer Help - Tenant - 7.4
170</p><p>Play Date
VCS only.
This block plays a specific date to the caller.
Properties
Values
Description
Date
Digits only, no
text.
The date to play, as specified in the Date Format property. Must be in
the same format as specified in the Date Format property.
Typically, the value of a variable set earlier in the script is entered into
this field, for example,  $TransactionDate$.
Note
Entering $Now$ does not work since it gives the date and time and the
date format does not match any of the date formats for this block. To
use Now, change the value to match the chosen date format.
For example, if Date Format = yymmdd, this is a 6-digit number, such as
010130
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to
terminate this command.
For example, to allow any touch tone to be a termination digit, set this
to 1234567890*#
Clear Digits
Yes or No
Clear the digit buffer of any digits entered prior playing the date. This
should be set to No by default.
Date Format
yyyymmddhhnn
yyyymmdd
yymmddhhnn
yymmdd
mmddhhnn
mmddhhnnss
hhnnss
hhnn
Format in which the output date is spoken, where:
l
yyyy = four-digit year
l
yy = two-digit year
l
mm = two-digit month
l
dd = two-digit day
l
hh = two-digit hour
l
nn = two-digit minute
l
ss = two-digit seconds
Note
Default year: If yy and yyyy are omitted, the current year is played.
Line
Inbound
The .wav file is played to the original (incoming) caller.
CCSP Designer Help - Tenant - 7.4
171</p><p>Properties
Values
Description
Outbound
The .wav file is played to the transferee (the party to whom the call is
transferred).
Async Mode
Yes or No
Allow asynchronous playback of a .wav file. The default is No.
Caution
Asynchronous playback should only be used for one .wav file at a time.
Attempting to use Async Mode for multiple simultaneous .wav files can
produce unpredictable results.
Note
The Play Date, Play Money, and Play Number blocks use prerecorded .wav files to read the date, dollar
amount or number to the caller. These files are provided in English only but the service provider may have
recordings in other languages created by outside companies.
CCSP Designer Help - Tenant - 7.4
172</p><p>Play Greeting
This block plays a message to the caller and to the agent.
Properties
Values
Description
Greeting
Text
Path to .wav file to play or text to speech.
If Agent Greeting is blank, both the agent and customer hear this message.
Agent
Greeting
Text
Optional path to .wav file to play or text to speech presented only to the agent
before answering the call, for example, Incoming call from Sales.
Note
l
To use Agent Greeting, you must also have a caller Greeting.
l
To avoid either party hearing silence, we recommend that the Greeting and
Agent Greeting files are the same duration.
Async Mode
Yes or
No
Async Mode allows the script to do other tasks, for example, to verify a
customer's ID number from a database, while a .wav file plays. The default is No.
Note
l
If you use Async Mode, to ensure that CCSP plays the complete messages to
the relevant parties, we recommended that you follow this block with an Agent
Greeting block in Sync Mode that plays media files that last a few milliseconds.
Otherwise, CCSP plays neither message because it executes the next block and
connects the call.
l
If you don't use Async Mode, both messages will finish before the script moves
to the next block.
Comment
Text
Optional text you can enter to describe what this block does in your script.
CCSP Designer Help - Tenant - 7.4
173</p><p>Play Money
VCS only.
This block plays a specific dollar or dollar-and-cents amount to the caller.
Properties
Values
Description
Dollar
ddd or
ddd.cc
A monetary amount to play. In dollars only or dollars-and-cents format.
Termination
Digits
0-9 # and *
Enter digit(s), # or * . This value(s) can be used by the caller to terminate this
command.
For example, to allow any touch tone to be a termination digit, set this to
1234567890#*
Clear Digits
Yes or No
Clear the digit buffer of any digits entered prior to this command. This should
be set to no by default.
Line
Inbound
The .wav file is played to the original (incoming) caller.
Outbound
The .wav file is played to the transferee (the party to whom the call is
transferred).
Async Mode
Yes or No
Allow asynchronous playback of a .wav file. The default is No.
Caution
Asynchronous playback should only be used for one .wav file at a time.
Attempting to use Async Mode for multiple simultaneous .wav files can
produce unpredictable results.
Note
The Play Date, Play Money, and Play Number blocks use prerecorded wav files to "read" the date, dollar
amount or number to the caller. These files are provided in English only but the service provider may have
recordings in other languages created by outside companies.
CCSP Designer Help - Tenant - 7.4
174</p><p>Play Number
VCS only.
This block plays a specific number to the caller.
Properties
Values
Description
Number
Number
The number to play.
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to terminate
this command.
For example, to allow any touch tone to be a termination digit, set this to
1234567890#*
Clear Digits
Yes or No
Clear the digit buffer of any digits entered prior to playing the number. This
should be set to no by default.
Format
Number
Play digits as cardinal number (123 = "one hundred and twenty-three")
Ordinal
Play digits as ordinal number (123 = "one hundred and twenty-third")
Digits
Play digits individually (123 = "one, two, three"). This format is ideal for
playing back a number entered by the caller.
For example, if the number 51389 was entered, the first Play Audio block can
play "the customer ID you entered was" and then a Play Number block can
play "five, one, three, eight, nine".
Line
Inbound
The .wav file is played to the original (incoming) caller.
Outbound
The .wav file is played to the transferee (the party to whom the call is
transferred).
Async Mode
Yes or No
Allow asynchronous playback of a .wav file. The default is No.
Caution
Asynchronous playback should only be used for one .wav file at a time.
Attempting to use Async Mode for multiple simultaneous .wav files can
produce unpredictable results.
Note
The Play Date, Play Money, and Play Number blocks use prerecorded .wav files to read the date, dollar
amount or number to the caller. These files are provided in English only but the service provider may have
recordings in other languages created by outside companies.
CCSP Designer Help - Tenant - 7.4
175</p><p>Play Text
This block plays text to the caller.
Properties
Values
Description
Text to play
Text or
Speech
Synthesis
Mark Up
Language
(SSML).
Text
containing
optional
variables.
Text containing optional variables. A variable has a format similar to the one
in this example:
"The number &lt; phone &gt;$line.DNIS$ is unavailable."
For more information on SSML, see http://www.w3.org/TR/ssml-sayas/.
Speech Rate
Slow,
Medium
(default) or
Fast
_
Volume
Soft, Medium
(default) or
Loud
_
Termination
Digits
0-9 * and #
Numeric digit(s), # or * . The caller can use these value(s) to indicate the end
of their response.
When a termination digit is pressed, playback stops, and the script executes
the next block.
Clear Digits
Yes or No
Clear the digit buffer of any digits entered before playing the text file. The
default is No.
This should be set to No unless digits from a previous Get Digits block need
to be cleared. Since callers often become familiar with your IVR and enter
the digits for 2 or 3 prompts ahead, if you clear the digits, you delete the
entries for the next one (or more) Get Digits block(s).
Line
Inbound
The text file is played to the original (incoming) caller. The default is
Inbound.
Outbound
The text file is played to the transferee (the party to whom the call is
transferred).
CCSP Designer Help - Tenant - 7.4
176</p><p>Properties
Values
Description
Async Mode
Yes or No
Async Mode allows the script to do other tasks, for example, to verify a
customer's ID number from a database, while a text file plays. The default is
No.
Caution
Asynchronous playback should only be used for one text file at a time.
Attempting to use Async Mode for multiple simultaneous text files can
produce unpredictable results.
Comment
Text
Optional description of what this block does in the script.
CCSP Designer Help - Tenant - 7.4
177</p><p>Play Video
This block plays a video file to the caller.
Properties
Values
Description
Video File
Filename
This must be a name for a local video file, with or without a path.
Termination Digits
0-9 # and *
N/A
Clear Digits
Yes or No
N/A
Async Mode
Yes or No
N/A (Yes by default)
Implementation
This block delivers only a video file to the recipient. In addition, the block delivers control to the next block in
the script when it has finished executing. This is intentional. To implement this feature properly, the following
blocks must follow this block in the script:
l
A Wait or Play Audio block — this block must have the same duration as that of the Play Video block. This is
to ensure synchronization of the playback of the Play Video block.
l
A Stop Video block — this block must be inserted after the Wait or Play Audio block to ensure that all the
blocks end at the same time.
CCSP Designer Help - Tenant - 7.4
178</p><p>Playback Audio
Elsbeth integration only.
This block plays an audio (.wav) file to the caller.
Properties
Values
Description
Audio file
Filename
Enter a URL address to the file you want to play.
Note
For the Elsbeth integration scripts, leave blank. CCSP takes the URL of the
file to play from the campaign parameters configured in CCSP Admin.
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to terminate
this command. For example, to allow any touch tone to be a termination
digit, set this to 1234567890#*
Clear Digits
No or Yes
Clear the digit buffer of any digits entered before playing the audio file.
This should be set to No unless digits from a previous Get Digits block
need to be cleared. Since callers often become familiar with your IVR and
enter the digits for 2 or 3 prompts ahead, if you clear the digits you delete
the entries for the next one (or more) Get Digits block(s).
Line
Inbound
The .wav file is played to the original (incoming) caller.
Outbound
The .wav file is played to the transferee (the party to whom the call is
transferred).
Bi-Directional
The .wav file is played to the original caller and the transferee.
CCSP Designer Help - Tenant - 7.4
179</p><p>Queue Name
This block directs the call to a specific queue (callSetName).
Properties
Values
Description
Queue name
String
The name of the queue to which the current call is to be directed.
Note
Queue names should not be longer than 32 characters.
This must be a valid queue name for the tenant, so spelling is critical but queue
names are not case sensitive.
You can select the queue name from a drop-down list of available queues in the
tenant. This list is refreshed every time you select the block. If a new queue is
added while you are editing the block, to see the added queue, select another
block or select the Flow editor background and then reselect the Queue block.
If a queue is removed from the tenant and the value is currently being used as
the queue name, the value remains as the selected value, until you manually
change it. You are not restricted to the values provided in the drop down list, so
you can use an expression as the selected value.
CCSP Designer Help - Tenant - 7.4
180</p><p>Read SIP Header
This block reads SIP headers inside the INVITE message of incoming calls.
The block is allowed only in the Ivr script.
Properties
Values
Description
Header
Name
String
The name of the SIP header.
Note
l
The name must start with an uppercase letter as in the SIP message and be
exclusive, for example From, To, Via.
l
Do not include a colon (:).
Header
Value
String
The name of the variable to return the SIP header.
CCSP Designer Help - Tenant - 7.4
181</p><p>Record Audio
VCS only
This block captures a voice message left by the caller.
Properties
Values
Description
File Name
Filename
The name of the file that holds the recording. This can be either a fully-
qualified filename, for example, C:\MyFiles\foo.wav, or just a filename, for
example, foo.wav.
Use a unique or temporarily unique name so the script has time to send the
email with the wav file attached before another wav file is recorded with the
same name, for example: message$line.lineID$.wav creates a wav file
named message23.wav for line 23 on a VCS and is not overwritten until
another caller on line 23 of that VCS records a .wav file. See How to use
variables.
If it is a fully-qualified name, the file is not automatically deleted.
If it is not a fully-qualified filename, then the file is placed in the directory
pointed to by the CosmoDesignerTempDir registry key and is automatically
deleted at the end of the call. For more information, see XMLInterpreter Log
File in the CCSP Registry Key Reference.
All recorded files are in .wav format, 8KHz – 16 bit mono.
If the filename specified does not contain the .wav extension, this extension
is automatically appended to the filename.
Max Time
Seconds
(integer)
Maximum length of recording. If left blank the default is 300 seconds.
Max Silence
Seconds
(integer)
Maximum amount of time (silence) indicating the end of the recording. If
left blank the default is 3 seconds.
Termination
Digits
0-9 # and *
Enter digit(s), # or *. These value(s) can be used by the caller to terminate
this command.
For example, to allow any touch tone to be a termination digit, set this to
1234567890#*
Clear Digits 
Yes or No
Clear the digit buffer of any digits entered prior to recording. This should be
set to No by default.
Beep Type
None
Type of beep to play at start of recording time, or none.
If left blank, the default is 0 (None)
CCSP Designer Help - Tenant - 7.4
182</p><p>Properties
Values
Description
Short,
Normal, or
Long
The filenames that correspond to the various beep lengths are:
l
beep_short.wav
l
beep.wav
l
beep_long.wav
File Size
String
The name of the variable that holds the resulting file size (in bytes) of the
recording.
This can be used to determine if this .wav file should be sent or not. For
example, set File Size to VMSize and then compare VMSize to 40000 (2.5
seconds).If recording is &lt; 40000 (2.5 seconds) then do send voicemail (email
with .wav file attachment).
Note
The audio format for recording is 8k – 16 bit, so a one-second recording is
equal to 16000.
See How to use variables.
Line
Inbound
The function is applied to the original (incoming) call.
Outbound
The function is applied to the outbound call (to where the call is transferred).
CCSP Designer Help - Tenant - 7.4
183</p><p>Record Video
This block captures a video message left by the caller.
Properties
Values
Description
File Name
Filename
The name of the file that holds the recording. This can be either a fully-
qualified filename, for example, C:\MyFiles\foo.avi, or just a filename, for
example, foo.avi.
If the specified filename does not contain the .avi extension, this extension is
automatically appended to the filename.
Max Time
Seconds
Maximum length of recording. The default is 30.
Termination
Digits
0-9 # and *
This value(s) can be used by the caller to terminate this command. For
example, to allow any touch tone to be a termination digit, set this to
1234567890*#
Clear Digits
Yes or No
Clear the digit buffer of any digits entered prior to recording. The default is
No.
CCSP Designer Help - Tenant - 7.4
184</p><p>Record Voicemail
Caution
This block is deprecated. Instead, use the Leave Voicemail block.
This block records voicemail.
Properties
Values
Description
Max Time
Seconds
(integer)
See the corresponding property in the Leave Voicemail block.
Termination
Digits
0-9 # and *
See the corresponding property in the Leave Voicemail block.
Clear Digits 
Yes or No
See the corresponding property in the Leave Voicemail block.
Beep Type
None, Short,
Normal, or
Long
See the corresponding property in the Leave Voicemail block.
Line
Inbound or
Outbound
See the corresponding property in the Leave Voicemail block.
From
String
This property is deprecated.
Recipient
String
This property is deprecated.
In the Leave Voicemail block, this property is mapped to ACD Voicemail
Folder Name or External Mailbox Address.
Note
l
If the value (email address) starts with voicemail, it is mapped to ACD
Voicemail Folder Name. Otherwise, it is mapped to External Mailbox
Address.
l
Recipient has a mapping precedence over CC\BCC. The CC\BCC
properties are ignored.
CC
String
This property is deprecated.
In the Leave Voicemail block, this property is mapped to ACD Voicemail
Folder Name or External Mailbox Address.
Note
CCSP Designer Help - Tenant - 7.4
185</p><p>Properties
Values
Description
l
If the value (email address) starts with voicemail, it is mapped to ACD
Voicemail Folder Name. Otherwise, it is mapped to External Mailbox
Address.
l
CC has a mapping precedence over BCC. The BCC property is ignored.
BCC
String
This property is deprecated.
In the Leave Voicemail block, this property is mapped to ACD Voicemail
Folder Name or External Mailbox Address.
Note
If the value (email address) starts with voicemail, it is mapped to ACD
Voicemail Folder Name. Otherwise, it is mapped to External Mailbox
Address.
Subject
String
This property is deprecated.
Body
String
This property is deprecated.
Store to DB
Yes or No
See the corresponding property in the Leave Voicemail block.
Store
Voicemail
Folder or full
file path
See the corresponding property in the Leave Voicemail block.
CCSP Designer Help - Tenant - 7.4
186</p><p>Recorder
This block determines how calls are recorded.
For more information on recording, see CallData object.
Note
l
You cannot use this block in the CallAnswered script.
l
For email calls, agents can only control the screen recording. They cannot control the automatic email
recording by the server.
l
CCSP UI was previously called TouchPoint.
Properties
Field
type
Values
Description
Logging
String
On
The entire call is recorded.
Off
The call is not recorded unless the agent initiates the recording.
Screen
Recording
String
On
When a call is recorded, the screens are also captured.
For detailed information about ffmpeg screen recording, see Screen
recording default implementation in the CCSP UI Integrations Guide.
Off
When a call is recorded, the screens are not recorded.
Agent Control
(recording)
String
Allow
The Record button on CCSP UI is enabled when an agent is in call.
The agent can start recording by clicking this button.
See the Rules table.
Disallow
The Record button on CCSP UI is disabled. The agent cannot start a
recording by clicking this button.
See the Rules table.
Logging
Indicator
String
Show
The Record button on CCSP UI displays an indication if a call is being
recorded.
Hide
The Record button on CCSP UI does not indicate if a call is being
recorded.
When an agent receives a call, he or she may or may not be able to start recording, depending upon how the
values are set. See Rules table.
CCSP Designer Help - Tenant - 7.4
187</p><p>Note
If the Record button is added to the CCSP UI menu bar, the agent is only able to start recording if Logging
is set to Off, Agent Control is set to Allow and Logging Indicator is set to Show. If Logging is set to On, the
agent cannot stop the recording.
Rules table
The logging rules are as follows.
Logging
Agent
control
Logging
indicator
Effect
Off
Disallow
Hide
A call is not recorded from the beginning. The Record button is not
shown. Agents cannot control recording. Recording is off completely.
Off
Disallow
Show
A call is not recorded from the beginning. The Record button is not
shown. Agents cannot control recording.
Off
Allow
Hide
A call is not recorded from the beginning. The Record button is
shown. Agents can control recording by clicking the Record button.
Off
Allow
Show
A call is not recorded from the beginning. The Record button is
shown. Agents can control recording by clicking the Record button.
On
Disallow
Hide
A call is recorded from the beginning. The Record button is not
shown. Agents cannot control recording.
On
Disallow
Show
A call is recorded from the beginning. The Record button is shown.
Agents cannot control recording.
On
Allow
Hide
A call is recorded from the beginning. The Record button is not
shown. Third-party applications control recording.
On
Allow
Show
A call is recorded from the beginning. The Record button is shown.
Agents cannot control recording. Clicking the Record button has no
effect.
CCSP Designer Help - Tenant - 7.4
188</p><p>Remove Skill
This block removes a skill from a call.
Properties
Values
Description
Skill Name
String
The name of the skill to be removed from the current call.
If you want to remove all skills enter the word all in this field.
ReQueue
VCS only.
This block resubmits the call to the system by resubmitting the call request to the Call Management Service.
Note
UnQueue and ReQueue should only be used for the Music on Hold While In Queue event. See the Note for
Unqueue.
See also unQueue and reQueue.
CCSP Designer Help - Tenant - 7.4
189</p><p>Routing Mode
This block determines how each call in queue is routed when all the agents that meet the call parameters are
Logged off, Unavailable, or Busy.
All the suitable agents must be in the same state, for example, all the suitable agents must be Logged off. This
block is ignored if the agents are in a combination of the above states.
Properties
Values
Description
Logged Off
Default, Queue or
Reject
Controls how the call is routed when all the suitable agents are logged
off:
l
Default — reject or queue the call as configured in the registry
setting.
l
Queue — queue the call until an agent becomes available.
l
Reject — reject the call immediately.
Unavailable
Default, Queue or
Reject
Controls how the call is routed when all the suitable agents are in an
unavailable state.
For a description of the values, see the Logged Off property.
Busy
Default, Queue or
Reject
Controls how the call is routed when all the suitable agents are in a
busy state.
For a description of the values, see the Logged Off property
Note
l
The default values are set in the AcceptOnlyIfThereAreActiveAgents and RejectIfBusy registry values in
HKLM\SYSTEM\CurrentControlSet\Services\CCUCallManagementServer\Parameters.
For details, refer to the CCSP Registry Key Reference.
l
The value Route is obsolete.
CCSP Designer Help - Tenant - 7.4
190</p><p>Routing Properties
This block is not currently enabled except for a workaround for DID extension. For example, the workaround
adds a skill, for example, ext: 2155 to the call, the agent must have his/her DID set to 2155 and must be
servicing the queue of the call and have all other skills assigned to the call.
Run
This block runs a VBScript subroutine or function and receives a return value from it.
The following functions are restricted and cannot be accessed with the Run block:
l
CreateObject
l
Eval
l
Execute
l
Function
l
GetObject
l
GetRef
l
InputBox
l
Kill
l
LoadPicture
l
MsgBox
l
RGB
l
SetLocale
l
Stop
l
Sub
Property
Values
Description
Return Value
Variable name (string)
Name of Return Value.
See How to use variables.
Routine
Name of function or subroutine to execute.
CCSP Designer Help - Tenant - 7.4
191</p><p>Schedule Callback
This block schedules a callback request. It replaces the deprecated Send callback block.
Properties
Values
Description
Callback Destination
String
The phone number to which the callback should be made.
Generally would be $line.ani$ but can be from a Getdigits block.
Note
The maximum outgoing call number or SIP URI is 370 characters.
ACD Callback Folder
String
Name of the tenant's callback folder.
If left blank, the tenant's default callback folder is used (default).
Note
This property is for future use when more than one callback folder per
tenant is available.
Destination Agent Id
Integer
Enable routing the callback to a specific agent, using Agent ID.
Left blank by default (don't route the callback to a specific agent).
Note
If a personal callback is scheduled without the Segregation Group Id,
the Destination Agent Id is removed, an error is logged, and the
callback is treated as a non-personal callback and routed to the next
suitable agent.
Immediate Dialing
Yes or No
Dial out immediately when the call is answered.
The default is No.
Segregation Group Id
Integer
Group ID used to filter voicemail items in Supervisor Message View.
Left blank by default.
Note
Personal callbacks scheduled without the Segregation Group Id are
treated as non-personal callbacks.
Callback Time
String
The time or day to call back in the format: Month/Day/Year
Hour:Minutes AM/ PM, for example, 1/18/2018 6:05 PM.
For systems outside the United States, the date is usually Day/
Month/Year and the time format is in accordance. To test, configure a
CallerMessage block to $Now$ and get the current date and time.
This information should be obtained from the caller, from a Menu
CCSP Designer Help - Tenant - 7.4
192</p><p>Properties
Values
Description
block or from a Getdigits block.
The default is $Now$
Note
When rescheduling a new callback from callback calls (callback media) and outgoing callback calls (VoIP
media), the RescheduleCounter value of the newly scheduled callback is greater by 1 than the value in the
underlying call. When scheduling a callback from any other call and media type, the RescheduleCounter
value is set to 0 for the scheduled callback.
The following example shows how to use this block.
CCSP Designer Help - Tenant - 7.4
193</p><p>Script Entry Point
This block defines an entry point to a script that is not the start point. You can pass a single parameter to the
script through the Variable Name property of this block.
Properties
Values
Description
Variable
Name
String
The parameter to pass to the script.
This field is Required and the block will abort the script if one is not entered. This
variable does not have to be used in the script in any form.
Note
l
You can pass a string that is parsed by your script through the Variable Name parameter. That way you
can pass multiple parameters to your script.
l
Make sure that the Script Entry Point and the script in which you insert the Script Entry Point are
consistent with the entry point established in CCSP Admin.
l
To be able to use the parameter defined through the Variable Name property, the Parameter Accepted
option of the Entry Points dialog of CCSP Admin must be enabled. If the option is not enabled, the
Variable Name property is not available.
For more information, see entry point in the CCSP Tenant Administrator Guide.
CCSP Designer Help - Tenant - 7.4
194</p><p>Send Callback
Caution
This block is deprecated. Instead, use the Schedule Callback block.
This block sends a Callback request to an agent.
Properties
Values
Description
From
String
Email address of the sender.
This is typically the service account for the contact center. This can be the
actual email address of the caller.
Recipient
String
Email address of recipient(s). Multiple addresses separated by a semicolon (;).
These generally are prepopulated, but can be elicited through a Menu.
CC
String
Email address of carbon copy recipient(s). Multiple addresses separated by a
semicolon (;)
These generally are prepopulated, but can be elicited through a Menu.
BCC
String
Email address of blind carbon copy recipient(s). Multiple addresses separated
by a semi colon (;).
These generally are prepopulated, but can be elicited through a Menu.
Subject
String
Subject of the email message.
This should be prepopulated, but a choice can be given through the use of a
Menu.
Body
String
Since this a request for a callback, this should be prepopulated with some
generic text.
Attachment(s)
String
For use in third-party integrations.
Callback Time
String
The time or day to call back. This is based on the local time of the connection
Server: ICS, MCS or VCS and so must match the format, typically
Month/Day/Year Hour:Minutes AM/ PM, for example, 1/18/2003 6:05 PM.
For systems outside the United States, the date is usually Day/ Month/Year and
the time format is in accordance. To test, configure a Caller Message block to
$Now$ and get the current date and time.
This information should be obtained from the caller, from a Menu block or
from a Get Digits block.
CCSP Designer Help - Tenant - 7.4
195</p><p>Properties
Values
Description
Callback
Number
String
The phone number to which the callback should be made.
Generally would be $line.ani$ but can be from a Getdigits block.
Note
The maximum outgoing call number or SIP URI is 370 characters.
The following example shows how to use this block to elicit a callback number and time from an after-hours
caller.
CCSP Designer Help - Tenant - 7.4
196</p><p>Send Email
This block sends email to a valid recipient.
Properties
Values
Description
From
String
Email address of the sender.
Recipient
String
Email address of recipient(s). Multiple addresses separated by a semicolon (;).
CC
String
Email address of carbon copy recipient(s). Multiple addresses separated by a
semicolon (;).
BCC
String
Email address of blind carbon copy recipient(s). Multiple addresses separated
by a semicolon (;).
Subject
String
Subject of the email message.
Body Format
Html or
Plain text
Determines the format of the body of the email message. The default value is
Html.
Body
String
Body of the email message, in valid HTML format, unless the Body Format value
is plain text.
To embed variables into this property, surround the variable's name with
percent (%) characters. To display a percent character in the body, use two
percent characters together (%%).
For example, if you have a variable called average, you may use a string like
this:
The class average for the last text was %average% %%.
This would result in the email body containing something like:
The class average for this test was 85%.
See How to use variables.
Attachment
(s)
String
Filename(s) of attachment(s) to include. Multiple attachments separated by a
semicolon (;).
The default directory is the same as that for the Record block, so for Voicemail
the name of the file must match the name set in the Record block. If a specified
path is used in the Record block, then the same path must be used in the
attachment field of the SendEmail block.
Send On
Error
Yes or No
If set to Yes the email is sent even if an attachment fails. If set to No the email is
not sent if an attachment fails.
CCSP Designer Help - Tenant - 7.4
197</p><p>Properties
Values
Description
Result
String
Enter a variable name to hold the return result of the send email. The value is
l
0 if successful
l
1 if an attachment failed to be loaded
l
2 if the send email failed
l
3 for an unknown error
Minimum File
Size
Number
If set, the email is not sent unless the attachment file size is equal or greater
than this value. This value is in bytes.
Note
For CCSP wav files, 1 second equals 16000 bytes ex. Setting this field to 40000
would cause emails with attached .wav files that are 2.5 seconds or less not to
be sent.
CCSP Designer Help - Tenant - 7.4
198</p><p>Send User Data
This block sends a SIP INFO message.
Properties
Values
Description
Format
String or
blank
The format string defines the content type of the INFO message. The default is
blank.
If the format is blank, then VCS inserts application/ccu-integration as the
content type of the INFO message.
Line
String
Inbound /outbound line on which you want to send the INFO
User Data
String
The User Data is the body of the INFO message.
Set Defer Type
This block determines whether the deferred item is personal or shared.
Properties
Values
Description
DeferType
Personal
or Shared
Determines whether the deferred item is personal or shared.
Personal items can only be seen by the deferring agent and his supervisor.
Shared items can be seen by all members of the agent's group.
The default value is the defer type chosen by the agent when deferring the item.
This value can be overridden by the Defer script.
CCSP Designer Help - Tenant - 7.4
199</p><p>Set Event
This block subscribes to one of these events:
l
On Connected
l
On Disconnected
l
On Digits
This block must be used with the Wait for Event block.
Properties
Values
Description
Event
On Connected
When the call is first established.
On Disconnected
When an outbound call disconnects. (Inbound calls have the Call
Termination event associated with them.)
On Digits
When a specific digit or digit string is entered by the caller. Uses Data
property to specify digits.
Data
Digit or digit string
This can only be used if On Digits is specified, to check for the entry
of a specific digit or digit string.
Line
Inbound
The function is applied to the original (incoming) call.
Outbound
The function is applied to the outbound call (to where the call is
transferred).
Goto
Works the same as
the GoTo block
What to do (where to go to) when this event fires.
See GoTo.
Use the Set Event and Wait for Event blocks as follows:
1.
Use a Set Event block with Event set to On Disconnected.
2.
Use a Supervised Transfer block to make an outbound call.
3.
Bridge the outbound call with the original call.
4.
Use a Wait for Event block to offer new actions to the original caller only after the second call disconnects.
CCSP Designer Help - Tenant - 7.4
200</p><p>Set Language
This block is only available if Integrated Speech IVR is enabled.
This block sets the language of prompts for Text to Speech (TTS) synthesis and grammar for Automated Speech
Recognition (ASR). See the Speech Play and Collect block for a list of the available grammars.
This block can be used anywhere within a script. Therefore, it is possible to change the language of a script
while it is running.
Properties
Values
Description
IVR
Language
String
Type a command string provided to you by your system administrator. For
example, MRCP=&lt;language_code1&gt;
The default code for &lt;language_code1&gt; is en-US for American English.
Comment
Text
Optional description of this block in your script.
CCSP Designer Help - Tenant - 7.4
201</p><p>Set SIP Header
This block adds a custom SIP header to the INVITE message of an outgoing call or the outgoing leg part of the
call.
The custom SIP header starts with the prefix X-
If the Header Name value already starts with X-, it is not changed. If it starts with x-, it is changed to uppercase
(for example x-abc becomes X-abc).
If the Header Name value does not start with either of the above, it is prefixed with X- (for example abc
becomes X-abc).
To use, add this block to the Outgoing Call script or to a custom script that is pointed to from the Outgoing call
script by a GoTo block. More than one block can be used in the same script. For each block used, Designer adds
the appropriate header.
Properties
Values
Description
Header
Name
String
The name of the added custom SIP header.
Note
l
The name must contain only alphanumeric characters and hyphens (-). The
maximum length is 30 characters (including the prefix).
l
It must not be an empty string or just the prefix.
Header
Value
String
The value of the added custom SIP header.
Note
l
The name must contain only alphanumeric characters and the following
characters: space, comma, hyphen (-), underscore (_), semi-colon (;), plus sign
(+), double-quotes (”), and forward slash (/). The maximum length is 200
characters.
l
It must not be an empty string.
CCSP Designer Help - Tenant - 7.4
202</p><p>Speech Enabled Menu
This block is only available if Integrated Speech IVR is enabled.
This block is similar to the Menu block with the addition of Text to Speech (TTS) and Automated Speech
Recognition (ASR) speech capability. It is also an extension of the Speech Play and Collect block.
Properties
Values
Description
Menu Prompt
String
The sound file to play for menu options.
Enter a .wav file, plain text, or Speech Synthesis Markup
Language (SSML) string.
For a .wav file, do one of the following:
l
Enter a complete URL address to the file you wish to play.
l
If your system administrator created a shortcut to the .wav
files, enter /[file_name.wav].
Invalid Prompt
String
The sound file to play for an invalid choice.
See the Menu Prompt description.
No Entry Prompt
String
The sound file to play if the caller does not enter anything within
Max Time (for speech response).
See the Menu Prompt description.
Stop Prompt On
Start of Input,
Recognition
Complete, or
Don't Stop
This property determines if caller barge-in is enabled or disabled:
l
Start of Input — the prompt is stopped as soon as the user
starts to speak or presses a key on the phone keypad.
l
Recognition Complete — the prompt is stopped only after
recognition is achieved according to the configured grammar.
This is also known as Hot Word mode.
l
Don't Stop — no barge in during prompt.
Confidence Level
(optional)
Percent
This is a confidence threshold parameter. The speech recognizer
computes a confidence level. If the level is below the threshold
you set, the recognizer returns no-match as the recognition
result. If the level is at or above the threshold, then recognition is
successful. The default is 50.
Speech Rate
Slow, Medium, or
Fast
The rate a TTS message is read.
CCSP Designer Help - Tenant - 7.4
203</p><p>Properties
Values
Description
Volume
Soft, Medium, or
Loud
The volume level a TTS message is read.
Termination
Digits
0-9 # and *
Enter digit(s), # or * . These value(s) can be used by the caller to
terminate this command.
When a termination digit is pressed, playback stops, and the
script executes the next block.
Clear Digits
Yes or No
Clear the digit buffer of any digits entered before playing the
audio file. The default is No.
Max Time
Seconds
Maximum waiting time. The length of time the script waits for
caller response after the prompt completes. The default is 20 and
the maximum permitted value is 30.
This property applies only to Automatic Speech Recognition
(ASR).
Max Silence
Seconds
The maximum length of time to wait for the caller's next
response. The default is 5.
Max Tries
Integer
Maximum number of times the caller can respond to a prompt.
The default is 1.
Result Variable
String
Name of a variable into which the digit string is to be passed.
Must start with an alphabetic character and not exceed 255
characters in length.
There is no default value for this, so leaving this field blank
causes this block not to function properly.
See How to use variables.
Input Mode
Speech and DTMF,
Speech only, or
DTMF only
If you select Speech and DTMF, and if the caller presses a key
(DTMF), the system ignores anything the caller says after the key
press.
If you select Speech and DTMF, and if the caller speaks, the
system ignores any key press after anything the caller says.
The default is Speech and DTMF.
Close MRCP
Session
Yes or No
Close the MRCP session after leaving the MRCP block.
Comment
Text
Optional description of this block in your script.
CCSP Designer Help - Tenant - 7.4
204</p><p>Configure the Speech Enabled Menu block
1.
Right-click the block and click Add case. The Speech Enabled Menu dialog appears.
2.
Perform one or both of these steps:
a.
From the Speech Enabled Menu list, select one or more menu items.
b.
In Or said, type the text for matching the caller's spoken response. You can type up to 15 separate
words. Separate the words with semicolons (";").
Note
l
This is an alternative spoken response option for the caller.
l
The case accepts any one of your selected digits or words if the caller response is matched in
this case.
CCSP Designer Help - Tenant - 7.4
205</p><p>3.
Optionally, in Label, type an alternative description.
4.
Click OK. The Case branch
appears.
5.
Connect the Case branch to the appropriate block in the script.
6.
Repeat steps 1-5 to add the branches you need.
7.
Connect the Else branch
to the appropriate block in the script.
CCSP Designer Help - Tenant - 7.4
206</p><p>Speech Play and Collect
This block is only available if IVR is enabled.
This block enables the playing of audio or Text-to-Speech (TTS) and collection of human speech or touchtone
digits.
The block also enables caller barge-in, which occurs when a caller speaks during playback. See Stop Prompt On
property below.
Note
The times used for speech recognition are dependent on each other and used in the following way:
l
Max Time = total time required for the speech recognition process to complete
l
Max Silence = maximum time waited for caller's responses, both for starting to speak and to
determine end of speaking
To enable successful speech recognition process to complete, the Max Time must exceed the maximum
expected speech input time of the caller plus two times the Max Silence time.
For example, a scenario with a maximum expected speech input time of 5 seconds to input a single
number or name, and a maximum silence time of 2 seconds to wait for start and completion of input,
requires the following settings, in seconds:
l
Max Time = 10, which exceeds the minimum of 9, calculated as 5 second input plus 2 x silence time of 2
seconds
l
Max Silence = 2
Properties
Values
Description
Text or Audio File
String
Enter a .wav file, plain text, or Speech Synthesis Markup Language
(SSML) string.
For a .wav file, do one of the following:
l
Enter a complete URL address to the file you wish to play.
l
If your system administrator created a shortcut to the .wav files,
enter /[file_name.wav].
Stop Prompt On
Start of Input,
Recognition
Complete, or
Don't Stop
This property determines if caller barge-in is enabled or disabled:
l
Start of Input — the prompt is stopped as soon as the user starts
to speak or presses a key on the phone keypad.
l
Recognition Complete — the prompt is stopped only after
CCSP Designer Help - Tenant - 7.4
207</p><p>Properties
Values
Description
recognition is achieved according to the configured grammar. This
is also known as Hot Word mode.
l
Don't Stop — no barge in during prompt.
Grammar
String
The grammar determines what to recognize in a caller's speech when
barge-in is enabled, and a barge-in occurs.
Specify your grammar(s) in one of the following ways:
l
Use a built-in grammar if a built-in grammar is installed in your
system. For example, if you have built-in grammar boolean, enter
built-in:grammar/boolean. The syntax is built-in:grammar/
[your_grammar].
l
Enter complete URL(s) to your grammar(s).
l
Type a list of comma-delimited words instead of a grammar.
If more than one grammar is used, separate the grammars with a
semicolon (;). You can list up to ten grammars separated by ; or list
the Content-ID.
The speech is compared to the grammar. If recognition is successful,
playback is stopped, the result variable is assigned, and the next
block is executed.
Confidence Level
(optional)
Percent
This is a confidence threshold parameter. The speech recognizer
computes a confidence level. If the level is below the threshold you
set, the recognizer returns no-match as the recognition result. If the
level is at or above the threshold, then recognition is successful. The
minimum is 50 and the maximum is 100. The default is 50.
Speech Rate
Slow,
Medium, or
Fast
The rate for reading a Text to Speech (TTS) message.
Volume
Soft, Medium,
or Loud
The volume level for reading a TTS message.
Termination Digits
0-9 # and *
Enter digit(s), # or * . These value(s) can be used by the caller to
indicate the end of their response.
When a termination digit is pressed, playback stops, and the script
executes the next block.
Max Time
Seconds
Maximum permitted duration of the caller’s spoken response,
starting when the caller first begins speaking. Generally, there is no
reason to change this from the default value. Maximum permitted
setting is 30 seconds. The default is 20.
This property applies only to Automatic Speech Recognition (ASR).
Max Digits
Number
The maximum number of caller response DTMF digits. When the limit
CCSP Designer Help - Tenant - 7.4
208</p><p>Properties
Values
Description
is reached, the script proceeds to the next block.
Note
Typically 3 is too low a number to work reliably and this value is set to
10 or 3 x number of digits to be entered.
Max Silence
Seconds
The maximum length of time to wait for the caller's next response.
The default is 5.
Clear Digits
Yes or No
Clear the digit buffer of any digits entered before playing the audio
file. The default is No.
Result Variable
String
Name of a variable into which the digit string is to be passed. Must
start with an alphabetic character and not exceed 255 characters in
length.
There is no default value for this, so leaving this field blank causes
this block not to function properly.
See How to use variables.
Line
Inbound
The next block in the script is applied to the original (incoming) call.
Outbound
The next block in the script is applied to the outbound call (to where
the call is transferred).
Input Mode
Speech and
DTMF,
Speech only,
or
DTMF only
If you select Speech and DTMF, and if the caller presses a key (DTMF),
the system ignores anything the caller says after the key press.
If you select Speech and DTMF, and if the caller speaks, the system
ignores any key press after anything the caller says. The default is
Speech and DTMF.
Comment
Text
Optional description of this block in your script.
Configure the Speech Play and Collect block
Caution
Do not rename the Success branch. Otherwise, when the external speech server returns success, CCSP
routes the script to the else case.
1.
Right-click the block and click Add case. The Speech Play/Collect dialog appears.
CCSP Designer Help - Tenant - 7.4
209</p><p>2.
From the SpeechPlayCollect list, select one of the following:
o
NoMatch — recognition did not succeed or caller pressed invalid DTMF.
o
NoInput — the caller did not respond.
o
Error — technical issues prevented speech recognition.
3.
Click OK. The Case branch
appears.
4.
Connect the Case branch to the appropriate block in the script.
5.
Repeat steps 1-4 to add the branches you need.
6.
Connect the Success branch to the appropriate block in the script.
7.
Connect the Else branch
to the appropriate block in the script.
Stop Video
This block ensures that the Play Video block that it follows ends synchronously with any associated Wait or Play
Audio block.
Properties
Values
Description
Line
Inbound
Default
Outbound
N/A
CCSP Designer Help - Tenant - 7.4
210</p><p>Supervised Transfer
VCS only.
This block redirects a call to another phone number. The difference between Supervised Transfer and Transfer
is that the former waits for the outgoing call to be answered or failed. It then allows the call to be re-routed,
depending on the result.
Properties
Values
Description
Phone Number
0-9 * and #
Any valid phone number to which to redirect the call, for example,
+16315551212
By using the + format, the number is location independent. This should
be used unless you know all of your VCSs are in one location. If using a
variable, add + to the value of the variable, for example,
+$NumberDialed$.
Note
l
The maximum outgoing call number or SIP URI is 370 characters.
l
This can also be an IP address, if you prefix the number with TA:, for
example, TA:208.203.191.74.
Source ID
String
Note
This information is shown only if the Source display property is missing.
When transferring a call, you can optionally set the source address
(CallingPartyNumber) from the script you are using.
If this is left blank, the ANI for the gateway is used, if that is not set, the
ANI for the tenant is used.
This can be either an H323-ID or an E164 number:
l
H323-ID takes the format NAME:ARNIE or NAME:$anyvariable$
l
E164 takes the format TEL:1234 or
TEL:$anyvalidnumberorvariable$
All possible values for this property should be contained in a single string,
such as:
NAME:NJONES,NAME:FSCHMIDT,TEL:1234567
The source address can be specified as either an H323-ID value denoted
by the NAME: prefix, or as an E164 address denoted by the TEL: prefix.
You do not have to send both types of source address, but it is legal if
CCSP Designer Help - Tenant - 7.4
211</p><p>Properties
Values
Description
needed. However, if not blank, the source address must contain one or
the other prefix format.
Source display
String
What to display as a source. This property is also known as CallerID or
CallingPartyName.
Connect Timeout 
Number
The number of seconds to wait for the calling party to answer. If this is
exceeded, the result of No Answer is returned.
If left blank, the phone service times-out the dial attempt.
Wave File
Filename
Performs an Asynchronous Play Audio while the transfer is in progress.
The .wav file specified should be longer than the timeout value for the
connection, or the caller hears silence after the .wav is played.
Enter a URL address to the file you wish to play.
Bridge Method
Bridge
Calls 
Bridges the call control and media stream (the individual calls become a
single call). If either party disconnects, the call terminates.
Caution
For TTS scripts, the transferred call bridges with TTS and the call does not
transfer to a new agent. When the agent presses transfer or the
transferred call is bridged (whichever happens first), the TTS call
disconnects, the agent disconnects, and the transfer monitor moves to
the main call (the incoming call).
Note
The media stream is no longer available in the IVR.
Bridge
Media
Only
Parties can communicate with each other, but if one party disconnects,
call does not terminate.
Note
The media stream is no longer available in the IVR.
Do not
Bridge
Do not bridge the calls.
Note
To retain call control in the IVR, set the Bridge Method to Do not Bridge.
Add an Answer case to the Supervised Transfer block and connect this
case to a Bridge Call block to finally connect the call. Add other cases to
the Supervised Transfer block to perform normal IVR actions with the
caller, such as play messages or transfer to other destinations.
Bridge
Media &amp;
DTMF
Parties can communicate with and forward DTMF tones to each other, but
if one party disconnects, call does not terminate.
Note
The media stream is no longer available in the IVR.
CCSP Designer Help - Tenant - 7.4
212</p><p>Configure the Supervised Transfer block
1.
Right-click the block and click Add case. The Transfer dialog appears.
2.
From the Transfer list, select one or more items.
3.
Optionally, in Label, type an alternative description.
4.
Click OK. The Case branch
appears.
5.
Connect the Case branch to the appropriate block in the script. For example, the next block could play "The
line appears to be busy. If you want to try again in ten seconds, press one."
6.
Connect the Else branch
to the appropriate block in the script.
CCSP Designer Help - Tenant - 7.4
213</p><p>Switch
This block evaluates a case statement and branches according. For important information about variables in
Designer, see How to use variables.
Properties
Values
Description
Expression
The left side
of any valid
expression
equals.
(VBScript)
Causes branching in the script.
The name of the case branch you add to the block is the value to check the
expression is equal to.
For example, $Line.DNIS$ branches to 5551234 when the DNIS value for
this call is 5551234.
When the switch expression is $line.DNIS$, the Add case dialog presents a
drop down list of the available DNIS values for the tenant. You are not
restricted to using the DNIS values in the drop down list. For example, you
can use an expression as the selected value.
Configure the Switch block
1.
Right-click the block and click Add case. The Add Case dialog appears.
If the switch expression is $line.DNIS$, the Add Case dialog appears with a drop down list of the available
DNIS values for the tenant.
CCSP Designer Help - Tenant - 7.4
214</p><p>2.
Type a unique description or select the DNIS value to use.
3.
Click OK. The Case branch
appears.
4.
Connect the Case branch to the appropriate block in the script.
5.
Repeat steps 1-4 to add all the branches you need.
6.
Connect the Else branch
to the appropriate block in the script.
Note
The following blocks are used for call routing:
l
Check Date
l
Check Time
l
Percent Allocated
They all require Case statements to be evaluated to direct the call.
CCSP Designer Help - Tenant - 7.4
215</p><p>Table
Note
The Table block is obsolete because tables are now managed though the Tables page. See Manage tables.
However, they can still be added to a script and are still imported as part of a legacy script.
This block links to a table to use for quick lookups of information. This block and the Table Lookup block are
best used for static lookups.
Properties
Values
Description
Table Name
Text
Select from the list of tables in the workspace. See Manage tables.
Although the block does not require linking to other blocks to be functional, it is best practice to link it to the
Table Lookup block to aid understanding.
Table Lookup
This block must be linked to the Table block using the return value from the lookup, for example, Customer
Name from CustID. CustID can be a variable populated in a Get Digits block.
You can configure the Table Lookup block to use the value of the variable CustID to lookup the matching Name
for the row with a matching CustID column value.
Properties
Values
Description
Table Name
Text
Select from the list of tables in the workspace. See Manage tables.
Key Column Name
Text
Name of column to search for matching value.
Key Column Value
Text
Value to match in Key column
Lookup Col. Name
Text
Column name for return value.
Lookup Col. Value
Text
Variable to populate with Lookup Column Name for row matching Key
Column Value.
CCSP Designer Help - Tenant - 7.4
216</p><p>Terminate
This block sets the condition for termination.
Properties
Values
Description
Terminate
Yes or
No
If Yes, the call terminates on completion of this script event and goes straight to
the call terminate event.
If No, the event ends normally and moves to the next event according to the
predefined flowchart. The default is No for all scripts except Call Reject.
Note
l
In the Call Reject event, by default this parameter is set to Yes to terminate the
call. To resubmit a call to the queue, you can use a Terminate block set to No to
overwrite this default.
l
In the Call Pre Sent event, if set to Yes, the call will be terminated and the item
will be moved to the Sent Items folder with the Invalid status.
CCSP Designer Help - Tenant - 7.4
217</p><p>Transfer by Refer
VCS only.
This block transfers a SIP call without using IVR ports.
Properties
Values
Description
Phone Number
0-9 * and #
Any valid phone number to which to redirect the call, for example,
+16315551212
The + format makes the number location independent. This should be
used unless you know all of your VCSs are in the same location. If you
are using a variable, add + to the value of the variable, for example,
+$NumberDialed$.
After the Answer case, no blocks are executed.
If the phone number is not reachable (404 SIP error code), the
NoAnswer case is executed.
Note
l
The maximum outgoing call number or SIP URI is 370 characters.
l
This can also be an IP address. Use a prefix in the format
sip:DNIS@IP_ADDRESS, for example, sip:6111@192.168.100.100,
where 6111 is the DNIS.
Source ID
String
Note
This information is shown only if the Source display property is missing.
When transferring a call, you can optionally set the source address
(CallingPartyNumber) from the script you are using.
If this is left blank, the ANI for the gateway is used, if that is not set, the
ANI for the tenant is used.
E.164 takes the format TEL:1234 or
TEL:$anyvalidnumberorvariable$
All possible values for this property should be contained in a single
string, such as: NAME:NJONES,NAME:FSCHMIDT,TEL:1234567
The source address can be specified as an E.164 address denoted by
the TEL: prefix.
Source  Display
String
What to display as a source. This property is also known as CallerID or
CallingPartyName.
CCSP Designer Help - Tenant - 7.4
218</p><p>Properties
Values
Description
Connect Timeout
Integer
The number of seconds to wait for a connection. The default of 10
seconds is used when the value is:
l
Left blank
l
0
l
Less than 0
l
Greater than 300
Configure the Transfer by Refer block
1.
Right-click the block and click Add case. The Transfer dialog appears.
2.
From the Transfer list, select one or more items.
3.
Optionally, in Label, type an alternative description.
4.
Click OK. The Case branch
appears.
5.
Connect the Case branch to the appropriate block in the script.
6.
Connect the Else branch
to the appropriate block in the script.
CCSP Designer Help - Tenant - 7.4
219</p><p>Transfer Call
VCS only.
This block redirects a call to another phone number.
Properties
Values
Description
Phone
Number
0-9 * and
#
Any valid phone number to which to redirect the call, for example,
+16315551212
The + format makes the number location independent. This should be used
unless you know all of your VCSs are in the same location. If you are using a
variable, add + to the value of the variable, for example, +$NumberDialed$.
Note
l
The maximum outgoing call number or SIP URI is 370 characters.
l
This can also be an IP address. For H.323 calls, prefix the number with TA:, for
example, TA:208.203.191.74. For SIP calls, use a prefix in the format
sip:DNIS@IP_ADDRESS, for example, sip:6111@192.168.100.100, where
6111 is the DNIS.
Transfer
Type
Blind
Transfer
This transfer type causes the VCS to access a second line from the gateway and
generate an outbound call to the phone number specified in the Phone
Number property. It then bridges the original caller and the outbound call
together.
Transfer
Type
Outdial
This transfer type dials the specified digits. No hook flash or other signalling is
issued, so the script remains in control of the call and can interact with the
original caller after the called party hangs up.
Source ID
String
Note
This information is shown only if the Source display property is missing.
When transferring a call, you can optionally set the source address
(CallingPartyNumber) from the script you are using.
If this is left blank, the ANI for the gateway is used, if that is not set, the ANI for
the tenant is used.
This can be either an H.323-ID or an E.164 number:
l
H.323-ID takes the format NAME:ARNIE or NAME:$anyvariable$
l
E.164 takes the format TEL:1234 or TEL:$anyvalidnumberorvariable$
CCSP Designer Help - Tenant - 7.4
220</p><p>Properties
Values
Description
All possible values for this property should be contained in a single string, such
as: NAME:NJONES,NAME:FSCHMIDT,TEL:1234567
The source address can be specified as either an H.323-ID value denoted by the
NAME: prefix, or as an E.164 address denoted by the TEL: prefix
You do not have to send both types of source address, but it is legal if needed.
However, if not blank, the source address must contain one or the other prefix
format.
Source
display
String
What to display as a source. This property is also known as CallerID or
CallingPartyName.
Bridge
Method
Bridge
Calls 
Bridges the call control and media stream (the individual calls become a single
call). If either party disconnects, the call terminates.
Bridge
Media
Only
Parties can communicate with each other, but if one party disconnects, call does
not terminate.
Do not
Bridge
Do not bridge the calls, use the Bridge Call function, instead. See Bridge Call.
Bridge
Media &amp;
DTMF
Parties can communicate with and forward DTMF tones to each other, but if one
party disconnects, call does not terminate.
CCSP Designer Help - Tenant - 7.4
221</p><p>UnQueue
VCS only.
This block immediately removes a call from queue.
An example of how this may be used is to unqueue the call in MusicOnHoldWhileInQueue and add a skill that
causes the call to be rejected when requeued. The CallRejected script can send the call to voicemail and remove
the skill just added.
Note
Unqueue and Requeue requests are sent to the Call Matcher only when all of the following criteria are
met:
l
The call is in the appropriate state (waiting for agent ring)
l
The script is in MusicOnHoldInQueue, InqueueTimeout, or PickupTimeout
l
The media is voicecall
l
The Unqueue and Requeue blocks are paired in the script (for each Unqueue there's an appropriate
Requeue in the script)
For any other situation, the VCS log indicates that a particular Unqueue or Requeue request was ignored
due to the given reason, however, the script execution continues to the next block.
See also unQueue and reQueue.
CCSP Designer Help - Tenant - 7.4
222</p><p>VXML (VoiceXML) Transfer Call
This block interfaces with any speech application platform for Speech Recognition and Text-to-Speech services.
The platform must support SIP.
Properties
Values
Description
Server
String
SIP URI server information. For more information on the format of this
property, see the article at: http://www.voip-info.org/wiki-SIP+uri.
VoiceXML URL
String
Location (URI) of VXML application to be used.
Transfer Type
Blind Transfer
This transfer type causes the VCS to access a second line from the
gateway and generate an outbound call to the phone number specified
in the Phone Number property. It then bridges the original caller and
the outbound call together.
Source ID
String
Note
This information is only shown if the Source display property is missing.
When transferring a call, you can optionally set the source address
(CallingPartyNumber) from the script you are using.
If this is left blank, the ANI for the gateway is used, if that is not set, the
ANI for the tenant is used.
This can be either an H323-ID or an E164 number:
l
H323-ID takes the format NAME:ARNIE or NAME:$anyvariable$
l
E164 takes the format TEL:1234 or
TEL:$anyvalidnumberorvariable$
All possible values for this property should be contained in a single
string, such as:
NAME:NJONES,NAME:FSCHMIDT,TEL:123456 7
The source address can be specified as either an H323-ID value denoted
by the NAME: prefix, or as an E164 address denoted by the TEL: prefix.
You do not have to send both types of source address, but sending
both is legal. However, if not blank, the source address must contain
one or the other prefix.
Source Display
String
What to display as a source. This property is also known as CallerID or
CallingPartyName.
CCSP Designer Help - Tenant - 7.4
223</p><p>Properties
Values
Description
Bridge Method
Bridge Calls
Bridges the call control and media stream (the individual calls become a
single call). If either party disconnects, the call terminates.
Bridge Media
Only
Parties can communicate with each other, but if one party disconnects,
call does not terminate.
Do not Bridge
Do not bridge the calls, use the Bridge Call function, instead. See Bridge
Call.
Bridge Media &amp;
DTMF
Parties can communicate with and forward DTMF tones to each other,
but if one party disconnects, call does not terminate.
CCSP Designer Help - Tenant - 7.4
224</p><p>Wait for Events
This block allows the script to continue processing after one of the events described in Set Event occurs.
Properties
Values
Description
Timeout
Milliseconds
The default is 0. This causes the block to wait indefinitely for the event to
occur.
If the event occurs before the timeout, the script automatically passes
control to
the Set Event block.
If the event times out, control passes to the block connected to the Wait for
Event block, and not to the Set Event block.
Wait
VCS only.
This block pauses execution of the script for the specified number of seconds, or until the caller enters the
termination digit.
Properties
Values
Description
Termination Digits
0-9 * and #
Enter digit(s), # or * . These value(s) can be used by the caller to
terminate this command.
For example, to allow any touch tone to be a termination digit, set
this to 1234567890#*
Value
Integer
Number of seconds to pause before continuing.
This block is typically used after a Play Audio block with Async Mode set to Yes to allow the script to wait a
number of seconds until proceeding to the next block.
CCSP Designer Help - Tenant - 7.4
225</p><p>Web Services
This block incorporates information available as a web service into the self-service and call routing logic.
Properties
Values
Description
URL
Web address
Web services URL, for example,
http:// www.abc.com/soap/GetClientinformation.asmx
Namespace
String
Web services namespace,http:// wsdl.use.abc.com
Namespace Prefix
String
A namespace prefix for the xml request to be sent to the web
services, for example, q0.
Method
String
The web services method to be called, for example,
GetClientInformation.
Parameters
String
The key/value parameter pairs for the web services method, for
example, PIN_Number, 123456789, Surname, Doell, GivenName,
John
Parameter Wrapper
String
The nested wrapper parameters, for example,
&lt;Request&gt;&lt;q0:RequestWrapper&gt;%%1&lt;/
q0:RequestWrapper&gt;&lt;/Request&gt;.
Note
%%1 is required for indicating where the required parameters are
being substituted.
Envelope Prefix
String
The soap envelope prefix, for example, SOAP-ENV.
Timeout 
String
Number of seconds to wait for response from web service before
timing out. The default is 15.
If the web service does not respond within the specified timeout, the
operation is aborted and a log entry is created in theDesigner log as
follows:
No response was received
from:http://webserver/webservices/test.asmx. Operation
aborted.
Result Variable
String
A variable name where responses are being prefixed. See XML
response example.
See Web services XML examples.
CCSP Designer Help - Tenant - 7.4
226</p><p>6: Objects
This section describes the CCSP scripting object model.
Note
The new model should only be used on scripts executed by the MCS. The new objects are not valid for VCS
and ICS.
New model for messaging calls describes the scripting object model valid only for email, callbacks, and
voicemail.
CCSP 7.3.x continues to support the following objects for MCS, VCS, and ICS media and scripts:
l
CallData object — for messaging data.
l
CCLEvent object — for the call media type.
l
CosmoCall object — for callbacks.
l
Line object — for VoIP.
l
NewLine object — associated with the outbound call from a call transfer.
l
Session object — available to all call types.
New model for messaging calls
This subsection describes the new scripting object model valid only for email, callbacks, and voicemail.
Note
The new model should only be used on scripts executed by the MCS. The new objects are not valid for VCS
and ICS.
The new model for messaging calls contains the following API, objects, and sub-objects:
l
Common media API — for identifying the call, its type, and common routing and history properties. Has
multiple sub-objects.
l
CallbackCall object — for additional callback-specific information.
l
EmailCall object — for additional email-specific information.
l
OutgoingEmailCall object — for additional outgoing email-specific information.
l
VoicemailCall object — for additional voicemail-specific information.
l
Sub-objects:
o
AgeingInfo object — for additional aging information for email and voicemail.
o
DeferInfo object — for additional defer information for email and voicemail.
o
EmailCall.EmailData object — for additional information about the email data.
o
EmailCall.LastAgentInfo object — for additional information about the last agent to handle the email.
o
EmailCall.RecordingControl object — for additional information about the email recording.
CCSP Designer Help - Tenant - 7.4
227</p><p>o
OutgoingEmailCall.OutgoingEmailData object — for additional information about the outgoing email
data.
o
PullInfo object — for additional pull information for email and voicemail.
o
VoicemailCall.LastAgentInfo object — for additional information about the last agent to handle the
voicemail.
o
VoiceMailCall.RecordingControl object — for additional information about the voicemail recording.
To see which of the new model for MCS media objects are compatible with the CallData object properties, see
Comparison with CallData object.
Common media API
The common media API methods and properties are applicable to the EmailCall object, CallbackCall object, and
the VoicemailCall object.
Property name
Accessibility
Applies to
Description
AccountName
Read/Write
All
Allow to set or get associated account name.
CallDirection
Read
All
Call direction type:
l
0 — Incoming
l
1 — Outgoing
l
4 — Callback Request
CallerInfo
Read
All
Provides access to the CallerInfo object.
CallId
Read
All
The call ID.
CallType
Read
All
Media type of call:
l
2 — Email
l
4 — Callback
l
5 — Voicemail
LastError
Read
All
Gets the last known error code.
Message
Read/Write
All
The caller's message to display to the agent.
Previously known as CallerMessage.
RoutingProperties
Read
ACD calls
Contains ACD-related routing properties.
TenantID
Read
All
The tenant ID.
Terminate
Read/Write
All
Set to true to terminate the call on script
completion.
TtsInfo
Read
Email/Voicemail
Contains TTS-related information.
CCSP Designer Help - Tenant - 7.4
228</p><p>RoutingProperties
RoutingProperties contains ACD-related routing properties. It is applied on all MCS media (email, callbacks, and
voicemail).
Property name
Accessibility
Description
AgentSelectionMode
Read/Write
Defines whether skill weighting is being used (when call arrives)
and how:
l
0 = not used
l
1 = least skilled
l
2 = most skilled
AssignedPriority
Read/Write
Affects HardPriority.
CallRejectedCounter
Read
How many times the call was rejected.
DirectRouteAgentId
Read/Write
AgentID where this call should be routed to.
Maturity
Read/Write
The current arrival time bias. Arrival time bias is used to offset
TQOS by adding bias to the arrival time.
OptionalParameters
Read
Returns Optional Parameters collection.
QueueName
Read/Write
The name of the queue for this call.
RoutingModes
Read
Provides a way to override the default setting for the routing
mechanism in different modes.
Skills
Read
Provides access to the skills collection.
RoutingModes
RoutingProperties.RoutingMode provides a way to override the default setting for the routing mechanism in
different modes:
l
0 = Default
l
1 = Route
l
2 = Queue
l
3 = Reject
Property name
Accessibility
Description
AgentsBusy
Read/Write
Controls routing when all applicable agents are busy.
AgentsLoggedOff
Read/Write
Controls routing when all applicable agents are logged off.
AgentsUnavailable
Read/Write
Controls routing when all applicable agents are unavailable.
CCSP Designer Help - Tenant - 7.4
229</p><p>Skills collection
RoutingProperties.Skills provides access to the skills collection.
Property name
Accessibility
Description
Count
Read
Size of collection.
Item(id)
Read
Gets skill name by index. This method is used internally for collection
traversal.
SetItem(Id, name)
Write
Sets skill name at given index. This method is used internally for
collection traversal.
Add
Write
By name (compressed – case insensitive).
Remove(name)
Write
Removes skill from collection by name.
RemoveByIndex
(index)
Write
Removes skill from collection by index. This method is used
internally.
Clear
Write
Clears container.
Contains
Read
Checks if given item (by name) exists.
CallerInfo object
The CallerInfo object has the following properties.
Property name
Accessibility
Description
Name
Read/Write
Caller's name.
ANI
Read
Caller's address.
DNIS
Read
Designated address used by caller.
IvrDigits
Read
Only for callbacks and voicemail.
ErrorInfo
The ErrorInfo property contains detailed error information.
Property name
Type
Description
ErrorCode
Read
Enumeration varies per script and media.
ErrorMessage
Read
The error message.
CCSP Designer Help - Tenant - 7.4
230</p><p>Property name
Type
Description
ErrorLevel
Read
Error level types:
l
0 = Info
l
1 = Warning
l
2 = Error
Optional parameters collection
The Optional Parameters property provides access to the optional parameters collection.
Property name
Accessibility
Description
Count
Read
Size of collection.
Item(id)
Read
Gets optional parameter name by index. This method is used
internally for collection traversal.
SetItem(Id, name)
Write
Sets optional parameter name at given index. This method is used
internally for collection traversal.
Add
Write
By name (compressed – case insensitive).
Remove(name)
Write
Removes optional parameter from collection by name.
RemoveByIndex
(index)
Write
Removes optional parameter from collection by index. This method is
used internally.
Clear
Write
Clears container.
Contains
Read
Checks if given item (by name) exists.
ItemInfo object
The ItemInfo object is available to email, callback and voicemail call types and includes the following properties.
Property name
Type
Description
ItemId
Read
Returns item’s unique identifier.
FolderInfo
Read
Provides access to the FolderInfo object.
FolderInfo object
The FolderInfo object is available to email, callback and voicemail call types and includes the following
properties.
CCSP Designer Help - Tenant - 7.4
231</p><p>Property name
Type
Description
Name
Read
The folder's name.
Id
Read
The folder's unique identifier.
EmailAddress
Read
The folder's email address.
TtsInfo object
The TtsInfo object is available to transferrable media types (email and voicemail) and includes the following
properties.
Property name
Type
Description
ApplicationId
Read
Returns associated EntryPoint application ID.
BlockName
Read
Returns associated EntryPoint block name.
Parameter
Read
Returns associated EntryPoint parameter name.
ScriptName
Read
Returns associated EntryPoint script name.
CallbackCall object
The CallbackCall object applies to callbacks and includes the following properties.
Property name
Type
Description
ItemInfo
Read
Returns callback’s item information.
OutDialingAddress
Read
Returns designated callback address (usually phone number).
ImmediateDialing
Read
Returns immediate dialing flag. If set to true, when the callback arrives at
the agent, the callback out-dialing starts automatically.
OriginatingAgentID
Read
Returns AgentID of the agent scheduling this callback.
AttachmentUrl
Read
Returns the caller's URL to display to the agent. Previously known as
CallerURL.
RescheduleCount
Read
Returns the callback's current reschedule counter:
l
Value=0 for initial callback
l
Value&gt;0 for continuous callback
MaxRescheduleCount
Read
Returns the callback's maximum allowed reschedule attempts.
CCSP Designer Help - Tenant - 7.4
232</p><p>EmailCall object
The EmailCall object applies to email and includes the following properties.
Property name
Type
Description
ItemInfo
Read
Returns email’s item information.
DeferInfo
Read
Returns email's associated defer information.
PullInfo
Read
Returns email's associated pull information.
AgeingInfo
Read
Returns email's associated ageing information.
OutgoingEmailCall object
The OutgoingEmailCall object applies to an outgoing email, reply, or forward and includes the following
properties.
Property name
Type
Description
OutgoingEmailData
Read
Reference to OutgoingEmailData interface.
OutgoingMsgType
Read
Email message type:
1 — REPLY
2 — FORWARD
3 — NEW (outgoing email)
VoicemailCall object
The VoicemailCall object applies to voicemail and includes the following properties.
Property name
Type
Description
ItemInfo
Read
Returns voicemail’s item information.
DeferInfo
Read
Returns voicemail's associated defer information.
PullInfo
Read
Returns voicemail's associated pull information.
AgeingInfo
Read
Returns voicemail's associated aging information.
AgeingInfo object
The AgeingInfo object applies to email and voicemail and includes the following properties.
CCSP Designer Help - Tenant - 7.4
233</p><p>Property name
Type
Description
AgedRefCount
Read
Number of ageing cycles.
IsDeferAvailable
Read/Write
True or false.
Write is performed through the Assign block.
For email, set Variable Name to
EmailCall.AgeingInfo.IsDeferAvailable and Variable Value to
True.
For voicemail, set Variable Name to
VoiceMailCall.AgeingInfo.IsDeferAvailable and Variable Value
to True.
DeferInfo object
The DeferInfo object applies to email and voicemail and includes the following properties.
Property name
Type
Description
DeferByAgentID
Read
Agent ID of agent that performed the defer action.
DeferByGroupID
Read
Group ID of agent that performed the defer action.
DeferType
Read/Write
Defer type:
0 — Personal
1 — Shared
Write is performed through the Set Defer Type block.
EmailCall.EmailData object
The EmailCall.EmailData object applies to email and includes the following properties.
Property name
Type
Description
From
Read
The sender.
To
Read
The recipients. May be a list of values, separated by comma or semi-colon (;).
To find out the destination of the email, use: $EmailData.To$
Cc
Read
The carbon copy recipients. May be a list of values, separated by comma or
semi-colon (;).
Subject
Read
The subject.
BodyPreview
Read
The first three lines of the body as text.
UrgencyIndicator
Read
Email importance setting:
CCSP Designer Help - Tenant - 7.4
234</p><p>Property name
Type
Description
l
0 — Low
l
1 — Normal
l
2 — High
l
3 — No-change
ReceivedTime
Read
The email arrival time.
SentTime
Read
The email sent time.
Body
Read
The part of the body sent from the MS to the MCS to expose to scripts,
especially the Call Arrival script.
Use the CCSP Admin to disable body fetching, set the body format, and, for
text only, set the maximum size. For details, see Adding a folder in the CCSP
Tenant Administrator Guide.
KeepBody
Read
Whether and when to delete Body:
l
0 (default value) — clear on route. Clear MCS memory upon successful call
routing to MCS.
l
1 — delete immediately. For example, if you only want to use Body in the
Call Arrival script.
l
2 — keep. For example, if you want to use Body in the Call Termination
script, you need to keep it for the entire call lifecycle.
EmailCall.LastAgentInfo object
The EmailCall.LastAgentInfo object applies to email and includes the following properties.
Property name
Type
Description
AgentId
Read
The agent’s ID.
AgentGloibalId
Read
The agent's Global User ID. This is the ID the agent received during a logged on
session.
FirstName
Read
The agent's first name.
LastName
Read
The agent's last name.
EmailCall.RecordingControl object
The EmailCall.RecordingControl object applies to email and includes the following properties.
CCSP Designer Help - Tenant - 7.4
235</p><p>Property name
Type
Description
CallRecording
Read/Write
Controls whether the call will be recorded.
ScreenRecording
Read/Write
Controls whether the screen will be recorded.
AgentControl
Read/Write
Controls whether the agent will be able to stop the screen recording.
ShowIndicator
Read/Write
Controls whether the agent will see indication of the screen recording.
OutgoingEmailCall.OutgoingEmailData object
The OutgoingEmailCall.OutgoingEmailData object applies to applies to an outgoing email, reply, or forward and
includes the following properties.
Property name
Type
Description
From
Read/Write
Email originator's email address.
To
Read/Write
Primary recipient's email address.
CC
Read/Write
Carbon copy - secondary recipient's email address.
BCC
Read/Write
Blind carbon copy – private secondary recipient's email address.
Subject
Read/Write
Email's title.
UrgencyIndicator
Read/Write
Email's priority level.
ReplyTo
Read/Write
If set, the reply to the email is sent to this address.
PullInfo object
The PullInfo object applies to email and voicemail and includes the following properties.
Property name
Type
Description
PullType
Read
Type of the pull action. Possible values are:
l
1 — pull from Deferred folder
l
2 — pull Not-Yet-Queued from ACD folder
l
3 — pull Queued from ACD folder
l
4 — pull from Rejected folder
l
5 — pull from Archived folder
l
6 — pull from Sent-Items folder
l
7 — pull from Outbox folder
l
8 — pull from Drafts folder
CCSP Designer Help - Tenant - 7.4
236</p><p>Property name
Type
Description
IsRestoredFromArchiveMSR
Read
Flag indicating if the pulled item was restored from the Archive
MSR
PulledByAgentID
Read
Agent ID of agent that performed the pull action.
PulledByGroupID
Read
Group ID of agent that performed the pull action.
VoicemailCall.LastAgentInfo object
The VoicemailCall.LastAgentInfo object applies to voicemail and includes the following properties.
Property name
Type
Description
AgentId
Read
The agent’s ID.
AgentGloibalId
Read
The agent's Global User ID. This is the ID the agent received during a logged on
session.
FirstName
Read
The agent's first name.
LastName
Read
The agent's last name.
VoiceMailCall.RecordingControl object
The VoiceMailCall.RecordingControl object applies to voicemail and includes the following properties.
Property name
Type
Description
CallRecording
Read/Write
Controls whether the call will be recorded.
ScreenRecording
Read/Write
Controls whether the screen will be recorded.
AgentControl
Read/Write
Controls whether the agent will be able to stop the screen recording.
This property is used as a toggle to start and then stop recording. Each
start-stop creates a new segment.
ShowIndicator
Read/Write
Controls whether the agent will see indication of the screen recording.
CCSP Designer Help - Tenant - 7.4
237</p><p>Comparison with CallData object
The following table lists the CallData object properties and shows which of the new model for MCS media objects they are compatible with.
CallData property name
Accessibility
Compatible with
Comments
AccountName
Read/Write
CallbackCall.AccountName
EmailCall.AccountName
VoicemailCall.AccountName
Extended to support multiple accounts per call.
AddSkill
Write
CallbackCall.RoutingProperties.Skills.Add
EmailCall.RoutingProperties.Skills.Add
EmailCall.RoutingProperties.Skills.Add
AgentAvailableRoutingMode
Read/Write
N/A
Unsupported
AgentBusyRoutingMode
Read/Write
CallbackCall.RoutingProperties.RoutingMode
EmailCall.RoutingProperties.RoutingMode
EmailCall.RoutingProperties.RoutingMode
AgentLoggedOffRoutingMode
Read/Write
CallbackCall.RoutingProperties.RoutingMode
EmailCall.RoutingProperties.RoutingMode
EmailCall.RoutingProperties.RoutingMode
AgentUnavailableRoutingMode
Read/Write
CallbackCall.RoutingProperties.RoutingMode
EmailCall.RoutingProperties.RoutingMode
EmailCall.RoutingProperties.RoutingMode
AnsweringAgentId
Read
EmailCall.LastAgentInfo.AgentId
VoicemailCall.LastAgentInfo.AgentId
Email and voicemail calls only.
answeringagentfirstname
Read
EmailCall.LastAgentInfo.FirstName
VoicemailCall.LastAgentInfo.FirstName
CCSP Designer Help - Tenant - 7.4
238</p><p>CallData property name
Accessibility
Compatible with
Comments
answeringagentguid
Read
EmailCall.LastAgentInfo.AgentGlobalId
VoicemailCall.LastAgentInfo.AgentGlobalId
answeringagentlastname
Read
EmailCall.LastAgentInfo.LastName
VoicemailCall.LastAgentInfo.LastName
ApplicationId
Read
EmailCall.TtsInfo.ApplicationId
VoicemailCall.TtsInfo.ApplicationId
ArrivalTimeBias
Read/Write
CallbackCall.RoutingProperties.Maturity
EmailCall.RoutingProperties.Maturity
EmailCall.RoutingProperties.Maturity
BlockName
Read
EmailCall.TtsInfo.BlockName
VoicemailCall.TtsInfo.BlockName
BlockParamName
Read
EmailCall.TtsInfo.BlockParamName
VoicemailCall.TtsInfo.BlockParamName
CallAssignedPriority
Read/Write
CallbackCall.RoutingProperties.AssignedPriority
EmailCall.RoutingProperties.AssignedPriority
EmailCall.RoutingProperties.AssignedPriority
CallerMessage
Read/Write
CallbackCall.Message
EmailCall.Message
VoicemailCall.Message
CallerName
Read/Write
CallbackCall.CallerInfo.Name
EmailCall.CallerInfo.Name
VoicemailCall.CallerInfo.Name
CallerURL
Read/Write
Callback.AttachmentURL
CCSP Designer Help - Tenant - 7.4
239</p><p>CallData property name
Accessibility
Compatible with
Comments
CallRejectedCounter
Read
CallbackCall.RoutingProperties.CallRejectedCounter
EmailCall.RoutingProperties.CallRejectedCounter
VoicemailCall.RoutingProperties.CallRejectedCounter
CallSetName
Read/Write
CallbackCall.RoutingProperties.QueueName
EmailCall.RoutingProperties.QueueName
EmailCall.RoutingProperties.QueueName
CampaignName
Read/Write
N/A
Unsupported
DirectRoutAgentId
Read/Write
CallbackCall.RoutingProperties.DirectRouteAgentId
EmailCall.RoutingProperties.DirectRouteAgentId
EmailCall.RoutingProperties.DirectRouteAgentId
Disconnect_Code
Read/Write
N/A
Unsupported
EstimatedWaitTime
Read
N/A
Unsupported
HasSkill
Read
CallbackCall.RoutingProperties.Skills.Contains
EmailCall.RoutingProperties.Skills.Contains
EmailCall.RoutingProperties.Skills.Contains
MediaType
Read
CallbackCall.CallType
EmailCall.CallType
VoicemailCall.CallType
Option
Read/Write
CallbackCall.OptionalParameters.Item
EmailCall.OptionalParameters.Item
VoicemailCall.OptionalParameters.Item
Options
Read
CallbackCall.OptionalParameters
EmailCall.OptionalParameters
VoicemailCall.OptionalParameters
CCSP Designer Help - Tenant - 7.4
240</p><p>CallData property name
Accessibility
Compatible with
Comments
Priority
Read/Write
N/A
Unsupported
Recording
Read/Write
EmailCall.RecordingControl.CallRecording
VoicemailCall.RecordingControl.CallRecording
RemoveSkill
Write
CallbackCall.RoutingProperties.Skills.Remove
EmailCall.RoutingProperties.Skills.Remove
EmailCall.RoutingProperties.Skills.Remove
RoutingPriority
Read/Write
CallbackCall.RoutingProperties.AgentSelectionMode
EmailCall.RoutingProperties.AgentSelectionMode
EmailCall.RoutingProperties.AgentSelectionMode
ScreenRecording
Read/Write
EmailCall.RecordingControl.AgentControl
VoicemailCall.RecordingControl.AgentControl
ScriptName
Read
EmailCall.TtsInfo.ScriptName
VoicemailCall.TtsInfo.ScriptName
SelectiveRecording
Read/Write
EmailCall.RecordingControl.AgentControl
VoicemailCall.RecordingControl.AgentControl
ShowRecording
Read/Write
EmailCall.RecordingControl.ShowIndicator
VoicemailCall.RecordingControl.ShowIndicator
Skill
Read/Write
CallbackCall.RoutingProperties.Skills.Item
EmailCall.RoutingProperties.Skills.Item
EmailCall.RoutingProperties.Skills.Item
Skills
Read
CallbackCall.RoutingProperties.Skills
EmailCall.RoutingProperties.Skills
EmailCall.RoutingProperties.Skills
CCSP Designer Help - Tenant - 7.4
241</p><p>CallData property name
Accessibility
Compatible with
Comments
SkillsCount
Read
CallbackCall.RoutingProperties.Skills.Count
EmailCall.RoutingProperties.Skills.Count
EmailCall.RoutingProperties.Skills.Count
TenantID
Read
CallbackCall.TenantID
EmailCall.TenantID
VoicemailCall.TenantID
Wrapup_Code
Read
N/A
Unsupported
Wrapup_Data
Read
N/A
Unsupported
CCSP Designer Help - Tenant - 7.4
242</p><p>CallData object
For a comparison with the new model for MCS media, see Comparison with CallData object.
This object is available to all call types.
Property name
Type
Description
CallData.AgentDeliveryInitiated
Boolean
Only valid in MusicOnHoldInQueue script for incoming
calls. Indicates whether a current call is already in the
process of being delivered to an agent.
CallData.AnsweringAgentFirstName
String
The agent's first name.
CallData.AnsweringAgentGuid
Integer
The agent's Global User ID. This is the ID the agent
receives during a logged on session.
CallData.AnsweringAgentId
Integer
The agent's ID.
CallData.AnsweringAgentLastName
String
The agent's last name.
CallData.ArrivalTimeBias
Time
The current arrival time bias. Arrival time bias is used to
offset TQOS by adding bias to the arrival time.
CallData.CallAssignedPriority
Integer
A priority in the range from 0 through 99 can be
assigned to a call from a script. A call with priority 99
has the highest priority in its queue. A call with priority
0 has the lowest priority in its queue. The default is 49.
This property can be assigned to calls through the Call
Maturity/Priority and Assign Designer blocks.
Call priority takes precedence over call maturity within a
particular queue.
CallData.CallDirection
Integer
The values are:
l
0 — Incoming
l
1 — Outgoing
l
2 — Internal
l
3 — Agent to agent
l
4 — Callback request - initial ACD callback call (exists
on MCS servers only when the callback reschedule
count == 0)
l
5 — Callback reschedule - continuous ACD callback
call (exists on MCS servers only when the callback
reschedule count &gt; 0)
l
6 — Callback response - outgoing VoIP callback call
(exists on VCS servers only when dialed out as the
CCSP Designer Help - Tenant - 7.4
243</p><p>Property name
Type
Description
result of a callback call)
l
7 — Predictive
l
8 — Predictive preview
l
9 — IVR dialing
CallData.CallerMessage
String
The caller's message to display to the agent.
CallData.CallerName
String
The caller's name to display to the agent.
CallData.CallerURL
String
The caller's URL to display to the agent.
CallData.calloutAgentName
String
The calling agent's user name.
CallData.CallRejectedCounter
Integer
How many times the call was rejected.
CallData.CallSetName
String
The name of the queue for this call.
CallData.CampaignName
String
For outbound dialing campaigns only. Can be used to
display the name of the outbound dialing campaign to
the agent.
CallData.DirectExtension
Integer
The direct extension that was called.
CallData.DirectExtensionCall
Boolean
True if the call is to a direct extension. False if it is not.
CallData.DirectRouteAgentID
Integer
The agent's ID. Allows calls to be directly routed to an
agent via a script.
CallData.Disconnect_Code
Integer
The IVR disconnect reason code logged to the Call Data
Records. If this is non-zero when the IVR completes, the
Call Matcher does not queue the call.
CallData.EstimatedWaitTime
Integer
Estimated time until agent pickup while call is in queue.
Value is equal to the average wait for the queue minus
the time waited so far. If the value is negative, zero is
reported.
The value is in seconds.
The measurement interval for the waiting time is
estimated for at least 5 minutes and at least 10 calls, as
follows:
If there are more than 10 calls during the last 5 min.,
the waiting time is calculated based on all the calls.
If there are less than 10 calls during the last 5 min., the
waiting time is calculated based on 10 calls in a time
interval greater than the last 5 min.
CallData.HasSkill("SkillName")
Boolean
Tests if the supplied skill is attached to the call.
CCSP Designer Help - Tenant - 7.4
244</p><p>Property name
Type
Description
Calldata.HideAniFromAgent
Boolean
Whether the ANI should be hidden from an agent in
response to the network presentation indicator. See
Determining the Calldata.HideAniFromAgent value.
Calldata.IsCallback
Boolean
True if call is callback type. False if it is not.
CallData.MediaType
Integer
The media type for the current call. Possible values are:
l
0 — Chat call
l
1 — Phone call
l
2 — Email call
l
3 — VOIP call
l
4 — Callback call
l
5 — Voicemail call
CallData.Option("Parameter")
String
Parameter is the name of a previously set optional
parameter. This is used to access any optional
parameters that are set using the Optional Parameters
block.
CallData.PickUpFailurescounter
Integer
How many times Pickup Timeout occurred for one call.
CallData.RefusingAgentId
Integer
The ID of the agent refusing to accept the call.
CallData.RefusingAgentName
String
The logon name of the agent refusing to accept the call.
CallData.Skills
String
The skills to display to the agent.
CallData.SkillsCount
Integer
The current number of skills attached to call.
CallData.TenantID
Integer
The CCSP tenant ID for the current call.
CallData.TtsCounter
Integer
How many times the call was transferred to system (all
media).
Properties from SIP headers
Session Initiation Protocol (SIP) is a procedure, called a protocol, used in the setting up of telephone calls
between two systems that serve a caller and the called party. The header provides information used in
managing a call and does not carry content, such as voice signals.
Property name
Type
Description
CallData.line.SIPPhoneContext
String
Phone-context parameter from incoming call P-
Asserted-Identity (PAISIP) header.
The information extracted supplements the phone
CCSP Designer Help - Tenant - 7.4
245</p><p>Property name
Type
Description
URI (tel URI) in the SIP header. The tel URI may have
purely local significance. The context can provide
information about the remote end point of a call so
that the tel URI can be properly interpreted.
For example, if the tel URI is 640-1234, the context can
be 001-631 where the country code of the United
States is followed by a Long Island area code.
CallData.line.SIPPrivacyList
String
Values from incoming call SIP Privacy header.
This data indicates whether the caller identifying
information is to be revealed to the called party. The
list is a string extracted from the INVITE message. For
example, if the Privacy header is present in the INVITE
message and contains "user" or "id," then the caller's
identity is expected to be hidden from the called
party.
The treatment of this information depends on your
system administrator's settings for privacy in your
network. See SIP privacy parameters in the CCSP
Tenant Administrator Guide.
CallData.line.SIPPAISIP
String
Value from incoming call PAISIP header in SIP format.
CallData.line.SIPPAITEL
String
Value from incoming call PAITEL header. It is the PAI
in phone URI format.
CallData.line.SIPPANILocationAreaCode
String
Value from incoming call P-Access-Network-Info
(PANI) header. The PANI supplements the PAITEL or
PAISIP with sending service provider location
information. It is typically used for billing between
service providers and between service providers and
their subscribers.
CallData.line.SIPPANIOperatorCode
String
Value from incoming call PANI header. One of the
components of the PANI header.
CallData.line.SIPPANIAcessType
String
Value from incoming call PANI header. One of the
components of the PANI header.
CallData.line.SIPMediasList
String
List of media selected in the Session Description
Protocol (SDP) part of the SIP INVITE message.
Note
SDP describes multimedia sessions for the purposes
of session announcement, session invitation, and
other forms of multimedia session initiation.
CCSP Designer Help - Tenant - 7.4
246</p><p>Playback-related properties
The properties shown below are only available for Playback-enabled contact centers.
Note
l
For information on how these values are set using the Playback block in Designer, see Playback.
l
CCSP UI was previously called TouchPoint.
Property name
Type
Description
CallData.Recording
Integer
Values can be 0 or 1.
See the table below for an explanation of the effects.
CallData.SelectiveRecording
Integer
Values can be 0 or 1.
See the table below for an explanation of the effects.
CallData.ShowRecording
Integer
Values can be 0 or 1.
See the table below for an explanation of the effects.
The Playback implementation allows the addition of a recording button to CCSP UI to allow the agent to
selectively record a partial call if SelectiveRecording is turned on. If ShowRecording is turned on, this button
shows the current status of the recording. This button is not shown when the agent is not in call unless the
agent is a supervisor and he or she has selected to monitor a call. The state of this button depends on how the
CallData parameters shown below are set for the call. The table below may help to clarify the choices that are
available.
Recording
SelectiveRecording
ShowRecording
Description
0
0
0
Recording is not active for this call. Think
of this scenario as if there is no recording
installed at all on the agent application
machines.
1
0
0
Record the entire call.
0
1
0
Do not record this call. The agent can start
recording and stop recording at any time
during the call.
0
0
1
Do not record this call, but show the
status of the recording button. The status
of the recording button should indicate
that this call is not being recorded.
CCSP Designer Help - Tenant - 7.4
247</p><p>Recording
SelectiveRecording
ShowRecording
Description
1
1
0
Record the entire call and the agent can
play around with the recording button,
but it does not do anything. That is, the
agent thinks that he or she can turn
recording off, but in fact, the entire call is
recorded no matter what the agent does
with the recording button.
0
1
1
Do not record this call. The agent can start
recording at any time during the call. The
status of the recording button should
show whether the call is currently being
recorded or if recording is stopped.
1
0
1
The entire call is recorded. The agent
cannot play around with the recording
button. The recording button shows that
this call is currently being recorded.
1
1
1
The entire call is recorded. The agent can
play around with the recording button,
but it does not do anything. The recording
button shows that this call is currently
being recorded.
Determining the Calldata.HideAniFromAgent value
The value of the HideAniFromAgent property can be verified by checking the $calldata.HideAniFromAgent$
expression, which can be true or false. The value is defined by a combination of two conditions:
l
The VCS DWORD presentationIndicatorSupported registry key
l
The H323 presentation indicator value received from the gateway
The following table displays the value of this property depending upon these two conditions.
presentationIndicatorSupported
H323 presentation
indicator
HideAniFromAgent
0 or absent
clear (no ANI restrict)
false
0 or absent
restricted (ANI restrict)
false
1 or greater
clear (no ANI restrict)
false
1 or greater
restricted (ANI restrict)
true
CCSP Designer Help - Tenant - 7.4
248</p><p>CCLEvent object
This object is available to all call types.
Property name
Type
Description
CCLEvent.CallType
Integer
The media type for the current call. The possible values are:
0 — Chat
2 — Email
3 — VCS
CCLEvent.MediaType
Integer
Same as CallData.MediaType.
CCLEvent.Status
Integer
The call reject value. Possible values are:
0 — Not rejected
3 — No Agents
7 — Invalid queue name
CosmoCall object
This object is available to all call types.
Property name
Type
Description
cosmocall.CallID
String
CosmoCall call identifier
cosmocall.LastError
String
This parameter is available as read only in the CallRejected
Script where it represents the CMS reject reason:
l
0 — Call was queued / call is valid
l
1 — Unknown error
l
2 — Insufficient memory
l
3 — No suitable agent was found
l
4 — Invalid queue
l
5 — Invalid Connection Server address
l
6 — No CallId
l
7 — Invalid external queue ID
l
8 — DID agent is not free
l
9 — CMS got an invalid EXTERNAL_AGENT_ID (ThirdPartyID)
l
10 — CMS failed to locate logged-in agent marked for
external routing
CCSP Designer Help - Tenant - 7.4
249</p><p>Property name
Type
Description
cosmocall.MarkAsAbandoned
String
If true, sets abandoned calls in rejected script to be reported as
abandoned.
If false, sets abandoned calls in rejected script to be reported as
rejected (the default).
CosmoCall.CallbackData object
This object is available only for outgoing VoIP calls. All properties are Read only.
Property name
Type
Description
cosmocall.callBackData.DirectRouteAgentId
Integer
Returns the agent ID where the originating
callback was routed to. Can be 0 if the
originating callback call was routed via ACD
rules.
cosmocall.callBackData.OutDialingAddress
String
Returns the designated callback address
(usually phone number).
cosmocall.callBackData.ImmediateDialing
Boolean
Returns the immediate dialing flag. If set to
true, this callout started automatically when
the originating callback arrived at the
agent.
cosmocall.callBackData.OriginatingCallID
String
Returns the call ID of the originating
callback call.
cosmocall.callBackData.OriginatingAgentID
Integer
Returns the agent ID of the agent
scheduling the originating callback call. Can
be 0 if the callback was scheduled from a
script.
cosmocall.callBackData.AttachmentUrl
String
Returns the attachment's URL of the
originating callback call. Previously known
as CallerURL.
cosmocall.callBackData.Message
String
Returns the message of the originating
callback call. Previously known as
CallerMessage.
cosmocall.callBackData.OriginatingQueueName
String
Returns the name of the queue of the
originating callback call.
cosmocall.callBackData.RescheduleCount
Integer
Returns the reschedule count of the
originating callback call.
cosmocall.callBackData.MaxRescheduleCount
Integer
Returns the maximum reschedule count of
the originating callback call.
CCSP Designer Help - Tenant - 7.4
250</p><p>CosmoCall.TtsInfo object
This object is available only for VoIP and chat calls during TTS (Transfer to System) flow, if the selected
EntryPoint includes a script. All properties are Read only.
Property name
Type
Description
CosmoCall.TtsInfo.blockName
String
Returns the block name used during the TTS (only if set via
selected EntryPoint).
cosmocall.ttsInfo.ParamName
String
Returns the parameter name used during the TTS (only if set
via selected EntryPoint).
cosmocall.ttsInfo.ScriptName
String
Returns the script name used during the TTS (only if set via
selected EntryPoint).
cosmocall.ttsInfo.ApplicationID
Integer
Returns the application ID used during the TTS (only if set via
selected EntryPoint).
cosmocall.ttsInfo.CallType
Integer
Returns the TTS call type - one of the following values:
l
0 - main call (all media)
l
1 - outgoing TTS call (VoIP only)
l
2 - incoming TTS call (VoIP only)
cosmocall.ttsInfo.ParentCallId
String
Returns the TTS parent call ID.
Line object
This object is only available for VCS calls and is destroyed before entering the call termination script.
Property name
Type
Description
line.ANI
String
For incoming calls: the phone number of the caller, if available.
For outgoing to external number calls: the agent ANI as declared
in CCSP Admin on the agent level. If not declared on the agent
level, then the ANI declared on the tenant level. If not declared
on the tenant level, then the tenant name.
line.CallerID
String
The identification of the caller, if available.
line.CallingPartyID
String
The number of the caller, if available.
line.CalledPartyID
String
The number of the VCS if available.
line.CallIdentifier
String
H323 call identifier.
CCSP Designer Help - Tenant - 7.4
251</p><p>Property name
Type
Description
line.DeviceProfileShortName
String
Short name of the recognized device. This variable is applicable
only to H.323 video.
line.DNIS
String
For incoming calls: the phone number that the caller dialed, if
available.
For outgoing to external number calls: DNIS is the original dialed
value before dialing plan processing.
line.UUI
String
Q.931 user-to-user data field. This variable is applicable only to
H.323 and not SIP calls.
line.UUI.ex
String
Q.931 user-to-user data field with specification of language and
code page. This variable is applicable only to H.323 and not SIP
calls.
line.RemoteIpAddressInfo
String
Contains the IP address of caller if the caller calls from IP phone
or gateway if the caller calls from PSTN.
NewLine object
This object is associated with the outbound call from a call transfer. It is similar to the Line Object. It is available
only after a successful Transfer Call  or Supervised Transfer  block has been executed.
Property name
Type
Description
line.lineID
Integer
The VCS line number that the current call is using.
Session object
This object is available to all call types.
Property name
Type
Description
Session.Digits
String
The digits received from the last getDigits block.
Session.CallerID
String
Same as Line.CallingPartyID.
Session.CalledID
String
Same as Line.CalledPartyID.
Session.ID
String
Same as CosmoCall.CallID.
CCSP Designer Help - Tenant - 7.4
252</p><p>7: CallXML
This section contains the following topics:
l
General elements
l
Call control elements
l
Test and debug elements
l
CallXML high level elements
l
Additional Designer elements
This section describes how Designer supports the CallXML standard and explains how to use the additional
Designer elements to customize the scripts.
CallXML is a language based on the Extensible Markup Language (XML). Using CallXML, an organization can
describe an application in terms of how the call will be handled at the Web site and how the organization will
interact with the caller based on voice responses. CallXML is similar to other voice markup languages such as
VoiceXML and Microsoft's WTE.
CallXML is used to describe the user interface of a phone, VoIP, or multimedia application to a CallXML browser.
A CallXML browser then uses that description to control and react to the call itself.
The markup language includes:
l
Media action elements such as &lt;playAudio&gt; and &lt;recordAudio&gt; to describe what to present to the user
during a call.
l
Call action elements such as &lt;answer&gt;, &lt;call&gt;, and &lt;hangup&gt; to describe how to control and route the call
itself.
l
Logic action elements such as &lt;assign&gt;, &lt;clear&gt;, and &lt;goto&gt; to describe how to modify variables and
interact with traditional server-side web logic such as PERL, other CGI languages, PHP, or ASP.
l
Event elements such as &lt;onTermDigit&gt;, &lt;onHangup&gt; to describe how to react to things the user can do
during the call, such as pressing digits or hanging up.
l
Block elements that logically group actions and events together, so that one set of event handling elements
can be used for several sequential actions.
Note
When specifying URLs in Designer or scripts, you must use the forward slash character at all times. This
ensures proper resolution of the URL by the interpreter.
For example:
l
Correct — http://www.somesite.com/default.htm
l
Incorrect — http:\\www.somesite.com\default.htm
Use this Help in conjunction with the CallXML specification. If there is a difference, the information here
supersedes the CallXML specification. Refer to the CallXML specification at
http://community.voxeo.com/cxml/docs/csml_2.0/home.htm.
CCSP Designer Help - Tenant - 7.4
253</p><p>Some elements of the CallXML standard are listed as not supported. Unsupported elements do not cause the
interpreter to fail. If the interpreter processes a CallXML file that includes unsupported elements, it gracefully
ignores them.
General elements
Use the general elements as follows.
assignvar
&lt;assignvar="ttt"_default: ""
value="123"&gt;_default: "" /&gt;
This element follows the CallXML standard.
clear var
&lt;clear var=""ttt" default: none /&gt;
This element follows the CallXML standard.
cleardigits
&lt;cleardigits /&gt;
This element follows the CallXML standard.
getDigits var
&lt;getDigits var="pager_msg"_default: none
maxDigits="9"_ default: "no limit "
termDigits="#*"_default: ""
includeTermDigit="TRUE|FALSE"_default: "false"
clearDigits="TRUE|FALSE"_default: "false"
maxTime="30s" _default: maxSilence* maxDigits
maxSilence="5s"_default: "3s"_ /&gt;
This element follows the CallXML standard.
goto value
&lt;goto value="http://w.v.n/next.voxeo#block"_default: ""
submit="*" default: "*"
method="get" default: "get" /&gt;
CCSP Designer Help - Tenant - 7.4
254</p><p>This element differs from the CallXML standard as follows.
Submit only supports all "*" or no "" variables. You cannot specify a list of variables to send to the goto
destination.
Method only supports "get".
You can go to ASP (Active Server Pages) as well as XML pages provided the ASP pages generate appropriate
CallXML output so that the interpreter knows what to do next.
run value
&lt;run value="http://w.v.n/next.voxeo|#block"_default: ""
submit="*|x,y,z" default: "*"
method="get|post" default: "get"
var="varForReturnedSessionID"_default: "" /&gt;
This element is not supported.
sendEvent value
&lt;sendEvent value="msg_call_answered"_default: ""
session="sss"_ default: "" /&gt;
This element is not supported.
Call control elements
Use the call control elements as follows.
answer
&lt;answer /&gt;
This element is not supported. In the CCSP system the call is already answered before the first script event is
fired. Therefore there a script control to answer a call is not required.
call value
&lt;call value="pstn:18314395130" default: ""
callerID="pstn:1234567890" default: "session.callerID" maxTime="30s" default:
"30s" /&gt;
This element is not supported. Use the transferCall element to dial out.
conference targetSessions
&lt;conference targetSessions="sessionID1, sessionID2" default: ""
CCSP Designer Help - Tenant - 7.4
255</p><p>termDigits="#" default: "" /&gt;
This element is not supported.
hangup
&lt;hangup /&gt;
This element follows the CallXML standard.
playAudioformat
&lt;playAudioformat="audio/wav" default: "audio/wav"
value="http://www.ttt.com/sample.wav" default: ""
termDigits="1234567890*#" default: ""
clearDigits="TRUE|FALSE" default: "false" /&gt;
This element differs from the CallXML standard as follows.
The only supported format is audio/wav. The audio files must be in the format of Microsoft wave file 8kHz-
16bit-mono.
The value attribute can be one of the following formats:
l
A fully qualified file name. This means that the wave file is located on the local hard drive of each VCS (VoIP
Connection Server). The path specified must be accessible to every VCS in the CCSP system.
l
A URL. This means that the wave file is located on a web server. All wave files that are retrieved from a URL
are cached locally on each VCS. This limits the amount of data that needs to be downloaded from the web
servers.
l
A CCSP file descriptor. This means that the wave file is stored in the CCSP database. The file descriptor name
must match the name that is specified in CCSP Admin for the particular file.
playDateformat
&lt;playDateformat="yymmddhhnn" default: as shown below
value="9901111200" default: ""
termDigits="1234567890*#" default: ""
clearDigits="TRUE|FALSE" default: "false" /&gt;
The supported formats are:
l
yyyymmddhhnn
l
yyyymmdd
l
yymmddhhnn
l
yymmdd
l
mmddhhnnss
l
mmddhhnn
CCSP Designer Help - Tenant - 7.4
256</p><p>l
hhmmss
l
hhmm
Where:
l
yyyy is a 4 digit year
l
yy is a 2 digit year
l
mm is a 2 digit month
l
dd is a 2 digit day of the month
l
hh is a 2 digit hour
l
nn is a 2 digit minute
l
ss is a 2 digit seconds
playMoneyformat
&lt;playMoneyformat"us" default: "us"
value="1.25" default: ""
termDigits="1234567890*#" default: ""
clearDigits="TRUE|FALSE" default: "false" /&gt;
The only supported format is US (United States).
playNumber
&lt;playNumber
format="digits|number" default:0 "digits"
value="12345" default: ""
termDigits="1234567890*#" default: ""
clearDigits="TRUE|FALSE" default: "false" /&gt; 
This element follows the CallXML standard.
recordAudioformat
&lt;recordAudioformat="audio/wav" default:"audio/wav"
value="msg.wav" default: ""
termDigits="1234567890*#" default: ""
clearDigits="TRUE|FALSE" default: "FALSE"
maxTime="30s" default: "30s"
maxSilence="5s" default: "3s"
beep="1" default: "0" /&gt;
This element differs from the CallXML standard as follows.
CCSP Designer Help - Tenant - 7.4
257</p><p>The only supported format is audio/wav. The audio files are recorded in the format of Microsoft wave file
8kHz-16bit-mono.
The value attribute can be one of the following values:
l
A fully qualified filename. This means that the file is recorded to the local hard drive of the VCS servicing the
call in the directory specified. In this case the file is not deleted at the end of the call.
l
A non-qualified filename. This means that the file is recorded to the local hard drive of the VCS servicing the
call in the Windows %TEMP% directory. In this case the file is automatically deleted at the end of the current
script.
The beep attribute can be one of the following values:
l
0 — for no beep
l
1 — for a short beep
l
2 — for a normal length beep
l
3 — for a long beep
text format
&lt;text format="? default: "connected"
termDigits="#" default: ""
clearDigits="TRUE|FALSE" default: "false" &gt;
This element is not supported.
waitForConferenceEnd
&lt;waitForConferenceEnd /&gt;
This element is not supported.
Test and debug elements
The simline value element writes to the log file and event log as follows.
&lt;simline value="Any text for the system log" /&gt;
This element writes to a log file on the local hard drive of the CCSP Connection Server servicing the call. The log
files are located in the %TEMP%/CosmoDesigner directory.
If the beginning of the string in the value attribute starts with ERROR: or WARNING:, then the message is also
written to the Windows application Event Log of the Connection Server.
CallXML high level elements
The following high level elements follow the CallXML standard.
CCSP Designer Help - Tenant - 7.4
258</p><p>block label
&lt;block
label="anyname" default: ""
repeat="?"
default: "1"
clearDigits=&gt;"TRUE|FALSE" &gt; default: "false"
menu label
&lt;menu
label="main_menu" default: ""
repeat="3"
default: "1"
format="audio/wav" default: "audio/wav" 
value="http://w.v.n/msg.wav" default: ""
clearDigits="TRUE|FALSE" default: "false"
termDigits="1234567890*#" default: ""
maxTime="15s"
default: "30s" &gt;
inputAudio label
&lt;inputAudio label="leave_message"default: ""
repeat="3** default: "1"
var="myaudio** default: ""
value="http://w.v.n/msg.wav"default: ""
format="audio/wav"default: "audio/wav"
termDigits="1234567890*#"default: ""
clearDigits="TRUE|FALSE"default: "false"
maxTime="15s** default: "30s"
maxSilence="5s"default: "5s"
beep="TRUE|FALSE"default: "true" &gt;
inputDigitslabel
&lt;inputDigitslabel="input_pin" default: ""
repeat="3"
default: "1"
var="pager_msg" default: ""
format="audio/wav" default: "audio/wav" 
value="http://w.v.n.msg.wav" default: ""
termDigits="1234567890#*" default: ""
clearDigits="TRUE|FALSE" default: "false"
includeTermDigit="TRUE|FALSE" default: "true"
CCSP Designer Help - Tenant - 7.4
259</p><p>maxDigits="4"
default: no limit
maxTime="15s"
default: maxSilence * maxDigits
maxSilence="5s" default: "3s" &gt;
Additional Designer elements
Use the additional Designer elements as follows.
addSkillvalue
&lt;addSkillvalue="defaultSkill" default: "" /&gt;
Use this element to add CCSP skills to the current call.
arrivalTimeBiasvalue
&lt;arrivalTimeBiasvalue="30"default: "" /&gt;
Use this element to modify the arrival time bias for the current call. The lower the value, the higher you move
the call in the queue.
callerMessagevalue
&lt;callerMessagevalue="This is a test call."default: ""/&gt;
Use this element to configure a custom message to be displayed to the agent when the caller is connected.
callerNamevalue
&lt;callerNamevalue="John Doe" default: "" /&gt;
Use this element to configure the caller's name.
callSetNamevalue
&lt;callSetNamevalue="defaultQueue" default: "" /&gt;
Use this element to identify the CCSP queue to submit the current call to. If this element is identified multiple
times, it overrides all previous settings. Only the last setting takes effect.
callerURLvalue
&lt;=http://www.cosmocom.com default: "" /&gt;
Use this element to configure the caller's URL. When the caller is connected to the agent, this URL can be
displayed to the agent.
CCSP Designer Help - Tenant - 7.4
260</p><p>conditionalexpr
Use this element to control the flow of the application. It has two forms.
In the following form the expression evaluates to either True or False. Thus the only "Case" sub-elements
specified are True and False. If the expression evaluates to True, then execution jumps to the "value" attribute
specified in the True Case. Similarly, if it evaluates to False, then execution jumps to the "value" attribute
specified in the False Case.
The expression is in the form of a standard VBScript expression. Any variable names referenced in the
expression must have been previously assigned using the "assign" element. The "value" attributes are in the
same form as the value attribute of the "goto" element.
&lt;conditionalexpr="a &gt; 3" default: "" &gt;
value="#nextBlock" default: "" /&gt;
value="Ivr.xml" default: "" /&gt;
In the following form the "conditional" element acts more like a switch/case statement. In this statement the
expression can evaluate to multiple values. It is usually just a variable name.
&lt;conditionalexpr="line.DNIS" default: "" &gt;
value="#nextBlock" default: "" /&gt;
value="Sales.xml" default: "" /&gt;
value="Support.xml" default: "" /&gt;
*...
*value="Info.xml" default: "" /&gt;
optionalParametervar
&lt;optionalParametervar="VarName" default: ""
value="abc123" default: "" /&gt;
Use this element to configure CCSP optional parameters. Optional parameters are variables that are assigned
to the caller and can be accessed at any time during the call, even after it is connected to an agent. Typically
additional information about the caller is set in optional parameters, such as, account number, or phone
number.
removeSkillvalue
&lt;removeSkillvalue="defaultSkill"default: ""/&gt;
Use this element to remove CCSP skills from the current call.
sendEmail server
&lt;sendEmail server="MailServer" default: ""
recipient=you@somewhere.com default: ""
cc=aaa@cosmocom.com default: ""
CCSP Designer Help - Tenant - 7.4
261</p><p>bcc=bbb@yahoo.com default: ""
sender=me@msn.com default: ""
subject="Test email" default: ""
body="Hi, just testing." default: ""
attachment="test.wav" default: "" /&gt;
Use this element to send an email. It uses SMTP (Simple Mail Transport Protocol).
The following table describes the sendEmail server attributes.
Attribute
Description
server
The SMTP mail server name.
recipient
The email address of the person to send the email to. For multiple recipients separate the
address using a semi-colon ( ; ).
cc
The email address of any carbon copy recipients. For multiple recipients separate the
address using a semi-colon ( ; ).
bcc
The email address of any blind carbon copy recipients. For multiple recipients separate the
address using a semi-colon ( ; ).
subject
The subject of the email.
body
The body of the email.
attachment
The names of files to attach to the email. . For multiple files, separate them using a semi-
colon ( ; ).
The files must reside on the local hard drive of the CCSP Connection Server.
unQueue and reQueue
call cosmocall.unqueue
'now that the call is unqueued you can do whatever
'such as 'set cosmocall.terminate = true and let the call be terminated immediately
'or change the skills and do this:
call cosmocall.requeue
'which resubmits the call (possibly rejected or rerouted...)
Use unQueue and requeue in the Music on Hold While in Queue script. These functions allow the script to
remove a call from a queue and re-queue the call if desired. The unQueue function immediately removes a call
from the queue. An example of how this may be used is to unqueue the call and send it to voicemail. The
reQueue function resubmits the call to the system by calling the Call Arrival script. These features may be
applied to any call type. There are no arguments for either the unQueue or reQueue functions.
See also the Note for Unqueue.
CCSP Designer Help - Tenant - 7.4
262</p></section><section><meta content="CCSP UI Help - Agent Part 2 - Section 2: Contact Center:  
Service Provider 
APIs Guide 
Version 7.4" name="description"/><h2>Contact Center:  
Service Provider 
APIs Guide 
Version 7.4</h2><p>CCSP-APIG-74-R2-04/2025 
Contents 
1: Intro .............................................................................................................................................6 
What’s new ................................................................................................................................................. 6 
Legal disclaimer ......................................................................................................................................... 6 
Support ....................................................................................................................................................... 6 
2: Overview .....................................................................................................................................7 
3: CCSP Administrator API .............................................................................................................8 
High level architecture.............................................................................................................................. 9 
ConfigCom_WP.exe......................................................................................................................... 10 
Password encryption .............................................................................................................................. 11 
AdminGUID .............................................................................................................................................. 12 
Parameters ............................................................................................................................................... 13 
Samples ..................................................................................................................................................... 13 
API methods sample ...................................................................................................................... 13 
AJAX sample ..................................................................................................................................... 14 
4: CCSP Agent AJAX API ............................................................................................................... 16 
5: CCSP Agent Proxy Service API ................................................................................................ 17 
Filtering/Sorting by optional parameters ............................................................................................ 18 
Syntax of JSON filter ....................................................................................................................... 18 
Specifying sort field ........................................................................................................................ 27 
6: CCSP Chat API .......................................................................................................................... 28 
Configuration ........................................................................................................................................... 29 
Flow diagrams .......................................................................................................................................... 30 
JoinChat flow .................................................................................................................................... 31 
SendMsg flow .................................................................................................................................. 31 
GetEvents flow ................................................................................................................................. 31 
LeaveChat flow ................................................................................................................................ 31 
JoinChat ..................................................................................................................................................... 32 
Request ............................................................................................................................................. 32 
Response .......................................................................................................................................... 36 
Errors ................................................................................................................................................ 36 
SendMSG .................................................................................................................................................. 38 
Request ............................................................................................................................................. 38 
Response .......................................................................................................................................... 38</p><p>CCSP APIs Guide - 7.4 
3 
Error .................................................................................................................................................. 38 
GetEvents .................................................................................................................................................. 39 
Request ............................................................................................................................................. 39 
Response .......................................................................................................................................... 40 
LeaveChat ................................................................................................................................................. 46 
Request ............................................................................................................................................. 46 
Response .......................................................................................................................................... 46 
FireEvent ................................................................................................................................................... 47 
Request ............................................................................................................................................. 47 
Response .......................................................................................................................................... 48 
Error .................................................................................................................................................. 48 
7: CCSP CIS to Connector API ..................................................................................................... 49 
High-level overview ................................................................................................................................. 50 
Display the HTML web page .................................................................................................................. 51 
Log in ......................................................................................................................................................... 51 
Request body format...................................................................................................................... 51 
Code snapshot................................................................................................................................. 52 
Example of HTTP POST Message being sent .............................................................................. 52 
Example of HTTP POST Message being received ....................................................................... 53 
Connect through WebSocket ................................................................................................................. 54 
Create a GET_EVENTS request ............................................................................................................... 55 
Request body format...................................................................................................................... 55 
Example of HTTP POST Message being sent .............................................................................. 57 
Example of HTTP POST Message being received ....................................................................... 58 
Control the processing rate ................................................................................................................... 59 
Message body format .................................................................................................................... 59 
Code snapshot................................................................................................................................. 60 
Example of message being sent using WebSockets ................................................................. 60 
Example of error message sent from CIS ................................................................................... 60 
Receive messages ................................................................................................................................... 60 
Stop events ............................................................................................................................................... 61 
Request body format...................................................................................................................... 62 
Code snapshot................................................................................................................................. 62 
Example of HTTP POST Message being sent .............................................................................. 62 
Example of HTTP Response Message being received ............................................................... 63 
Log out ...................................................................................................................................................... 63 
Request body format...................................................................................................................... 63 
Code snapshot................................................................................................................................. 63 
Example of HTTP POST Message being sent .............................................................................. 64 
Example of HTTP POST Message being received ....................................................................... 64 
Add events to CISEvents.xml ................................................................................................................. 64 
Structure of CISEvents.xml ............................................................................................................ 64</p><p>CCSP APIs Guide - 7.4 
4 
Add events ....................................................................................................................................... 66 
8: CCSP Realtime API ................................................................................................................... 68 
ACalls ......................................................................................................................................................... 70 
Usage ................................................................................................................................................ 70 
Example ............................................................................................................................................ 70 
Elements and attributes ................................................................................................................ 71 
ACallsDetails ............................................................................................................................................. 74 
Usage ................................................................................................................................................ 74 
Example ............................................................................................................................................ 75 
Elements and attributes ................................................................................................................ 76 
QCalls ........................................................................................................................................................ 79 
Usage ................................................................................................................................................ 79 
Example ............................................................................................................................................ 80 
Elements and attributes ................................................................................................................ 80 
AConfigs .................................................................................................................................................... 83 
Usage ................................................................................................................................................ 83 
Example ............................................................................................................................................ 84 
Elements and attributes ................................................................................................................ 85 
CConfigs .................................................................................................................................................... 87 
Usage ................................................................................................................................................ 87 
Example ............................................................................................................................................ 87 
Elements and attributes ................................................................................................................ 88 
GConfigs ................................................................................................................................................... 89 
Usage ................................................................................................................................................ 89 
Example ............................................................................................................................................ 89 
Elements and attributes ................................................................................................................ 90 
QConfigs ................................................................................................................................................... 91 
Usage ................................................................................................................................................ 91 
Example ............................................................................................................................................ 91 
Elements and attributes ................................................................................................................ 92 
QHistory .................................................................................................................................................... 93 
Usage ................................................................................................................................................ 93 
Example ............................................................................................................................................ 93 
Elements and attributes ................................................................................................................ 96 
SServer ...................................................................................................................................................... 98 
Usage ................................................................................................................................................ 98 
Example ............................................................................................................................................ 98 
9: CCSP TWS integration ........................................................................................................... 103 
Architecture ............................................................................................................................................ 103 
Requirements ......................................................................................................................................... 104 
Web API ................................................................................................................................................... 104</p><p>CCSP APIs Guide - 7.4 
5 
Connect (agent, UPN)................................................................................................................... 104 
Disconnect (agent, UPN) .............................................................................................................. 105 
GetUsersPresences (agent, UPN) ............................................................................................... 105 
GetUsersPresencesSearch (agent, UPN, filter) ........................................................................ 107 
GetMyPresence (agent, UPN) ..................................................................................................... 108 
Error Codes .................................................................................................................................... 109 
SignalR Hub ............................................................................................................................................ 109 
Create connection ......................................................................................................................... 110 
Start ................................................................................................................................................. 110 
AddToGroup .................................................................................................................................. 110 
StatusUpdate ................................................................................................................................. 111 
RemoveAgent ................................................................................................................................ 112 
Client application flows ........................................................................................................................ 113 
Agent login ..................................................................................................................................... 113 
Authentication in TWS with AuthServer .................................................................................... 114 
Search users in Teams directory ................................................................................................ 115 
Agent changes presence ............................................................................................................. 116 
Another agent changes presence .............................................................................................. 116 
Agent logout .................................................................................................................................. 117 
Another agent logs out ................................................................................................................ 117 
10: CCSP UI Connector .............................................................................................................. 118 
A: CCSP Web Support integration ............................................................................................ 119 
Chat call initiation sequence ................................................................................................................ 120 
Web Support package components ................................................................................................... 120 
Configurator .................................................................................................................................. 120 
Quick start ...................................................................................................................................... 122 
Send external callbacks via SMTP ....................................................................................................... 123 
Extended SMTP headers .............................................................................................................. 123 
Sample script ................................................................................................................................. 126 
Chat extension ....................................................................................................................................... 128 
How to use the chat extension ................................................................................................... 128 
Chat extension components ....................................................................................................... 131 
Interfaces to the chat extension ................................................................................................. 135 
Customize the chat window ................................................................................................................. 139 
Increase the user input frame .................................................................................................... 139 
Show caller and agent names ..................................................................................................... 140 
Parameters ............................................................................................................................................. 141 
Options for launching calls .......................................................................................................... 141 
Call parameters ............................................................................................................................. 143 
ASP script parameters .................................................................................................................. 144</p><p>CCSP APIs Guide - 7.4 
6 
1: Intro 
This document is for developers who use the Contact Center: Service Provider (CCSP) APIs.  
What’s new 
• 
5: CCSP Agent Proxy Service API — added Filtering/Sorting by optional parameters (HF74-
67429). 
• 
6: CCSP Chat API — the maximum total length for the optional parameters, including the 
optional parameter names, is 1024 bytes. 
Legal disclaimer 
This document is governed by the terms of the software license agreement and applicable contract 
(including addendums) entered into with Enghouse. 
Support 
To submit comments or questions about the content in this document, please open a case with 
Enghouse Support.</p><p>CCSP APIs Guide - 7.4 
7 
2: Overview 
CCSP provides a complete range of API interfaces using standards such as AJAX, JSON, SOAP Web 
Services, WSDL, XML requests, JS/VBS framework for integration, FTP repository system,  and 
Angular JS framework. 
The interfaces are: 
• 
Agent API — for remote control, customizations, and specific applications, using AJAX, WSDL,  
SOAP, or Angular JS. See 4: CCSP Agent AJAX API and 5: CCSP Agent Proxy Service API. 
• 
CCSP UI Connector — provides a two-way integration hub on the client for integration into 
other desk applications or web applications. See 10: CCSP UI Connector. 
• 
TWS integration — enables a generic client application to integrate with Teams Web Service 
(TWS). See 9: CCSP TWS integration. 
• 
Administrator API — for custom GUI, automated config changes, config customizations, using 
SOAP or WSDL. See 3: CCSP Administrator API.  
• 
Chat API — for custom or mobile applications, using JSON or HTTP. See 6: CCSP Chat API and 
A: CCSP Web Support integration. 
• 
Central Integration Server (CIS) — provides a central integration point for all agent and call 
events. See 7: CCSP CIS to Connector API. 
• 
RTR web dll — for real time statistics pulling, using HTTP or XML. See 8: CCSP Realtime API. 
 
The scripting in the platform is done using XML scripts through the CCSP Designer tool, which 
offers open integration blocks to external integrations with web services or databases. For a 
description of the blocks and the scripting object model, see the CCSP Designer Help. 
The reporting database structure offers customers the ability to integrate directly with the 
historical data. For a description of the stored procedures and database tables, see the CCSP 
Historical Reports Technical Guide.</p><p>CCSP APIs Guide - 7.4 
8 
3: CCSP Administrator API 
Note 
Permission profiles are now enforced. 
 
The CCSP 7.4 Administrator API Library describes the SOAP Administrator methods for custom GUI, 
automated config changes, and config customizations. 
 
This chapter describes the high-level architecture, and configuration of the CCSP Administrator API 
web service. It also describes how to use the working sample of the API methods and the sample 
AJAX.</p><p>CCSP APIs Guide - 7.4 
9 
High level architecture 
The following diagram shows the high-level architecture.</p><p>CCSP APIs Guide - 7.4 
10 
ConfigCom_WP.exe 
Upon successful logon to perform Administrator API operations, each landlord or tenant 
administrator is hosted in a separate out of process COM (ConfigCom_WP.exe).  
The following diagram represents different ConfigCom logons hosted in separate out of process 
COMs.</p><p>CCSP APIs Guide - 7.4 
11 
Password encryption 
All APIs that require a password must be encrypted using RSA encryption. To use the same RSA 
encryption in the client application, the customer must contact Enghouse to obtain the key. 
For examples of how to use the RSA encryption, see the sample code listed in 
Samples\Includes\Crypto and Samples\WebAdminAPIClient directories under the Administrator API 
Web Services main directory.</p><p>CCSP APIs Guide - 7.4 
12 
AdminGUID 
The AdminGUID is the administrator globally unique identifier. 
To maintain the same logon session between API calls, a GUID is generated and passed back to the 
client upon a successful logon. Upon successful logon, this GUID can be obtained via the Login or 
GetLoginInfo API. All subsequent calls from the client must now pass the same AdminGUID as an 
internet header to identify his or her logon session.  
The following example demonstrates retrieving the tenant information.</p><p>CCSP APIs Guide - 7.4 
13 
Parameters 
The tenantId parameter for all APIs is mandatory. For landlord logon, the tenant id for the tenant 
to operate on must be specified. For tenant administrator logon, -1 can be specified as the tenant id 
or id of the tenant that this tenant administrator belongs to. When -1 is used as the tenant id, it is 
always under the assumption that this logon is a tenant administrator, not a landlord.  
Note 
When logging on a tenant administrator, the ID of the tenant that this administrator belongs to 
can be retrieved from the ConfigCom logon session. 
 
In all Create APIs, such as CreateQueue and CreateAgent, the name parameter is mandatory with 
the following exceptions: 
• 
CreateApplication — mandatory url and rule parameters 
• 
CreateAgent — mandatory RSA encrypted password 
 
For all Update APIs, such as UpdateQueue and UpdateAgent: 
• 
String parameters with empty string or null value are not updated. 
• 
All other parameters are updated based on the value provided in the API. For example, if for a 
numeric parameter the value 0 is passed, the parameter is updated to 0. 
Samples 
This section contains the following information: 
• 
API methods sample 
• 
AJAX sample 
API methods sample 
A working sample of the entire API methods can be found in the main folder of the Administrator 
API, under the Samples subfolder. 
This sample is written in html\javascript and is supported by these browsers:    
• 
Chrome — 23.0.1271.97 
• 
Firefox — 17.0.1 
 
To use the sample, update the server name for the sample application.  
To update the server name for the sample application: 
1. 
Navigate to C:\Program Files (86)\CosmoCom\Server Components\CCUWebAdminAPI\ 
Samples\WebAdminAPIClient\WebAdminAPIService\. 
2. 
In a text editor, open WebAdminAPIService.js. 
3. 
Find the line  this.serverName = '@ServerName@';</p><p>CCSP APIs Guide - 7.4 
14 
4. 
Replace @ServerName@ with your FQDN, for example, Server.Domain.com 
5. 
From a client machine browse to 
http://&lt;ServerName&gt;/CCUWebAdminAPI/samples/WebAdminAPIClient/main.htm, replacing 
&lt;ServerName&gt; with your FQDN. 
AJAX sample 
The Administrator API install package includes a sample AJAX (Asynchronous JavaScript and XML). 
The sample AJAX is used for verifying the available APIs in the Administrator API web service and as 
a guide for developing web applications for accessing any of the Administrator APIs.  
To verify the available APIs in the Administrator API web service: 
1. 
Use a supported browser  to navigate to the AJAX sample. For example:  
http://localhost/CCUWebAdminAPI/Samples/WebAdminAPIClient/Main.htm  
If accessing the sample from a different machine, replace localhost with the server name. 
2. 
Log on as a landlord or tenant administrator.  
To access any other APIs, the client application must first successfully log on as a landlord or 
tenant administrator. The password is encrypted before being sent to the Administrator API 
web service. For details, see Password encryption.</p><p>CCSP APIs Guide - 7.4 
15 
3. 
Select the API to operate on from the menu. 
 
4. 
Use the standard CCSP Web Administrator or the API’s corresponding Get API to confirm the 
operation performed in the previous step. For example, if you used CreateApplication to create 
an item, use GetApplicationInfo to obtain the latest updated information for this item.</p><p>CCSP APIs Guide - 7.4 
16 
4: CCSP Agent AJAX API 
The CCSP 7.4 Agent AJAX API Library describes the AJAX Agent methods for remote control, 
customizations, and specific applications. 
You can find the CCSP 7.4 Agent AJAX API Library.zip file in your environment at: 
http://{servername.domain.loc}/TouchPoint/Ajax/CCSPAgentAjaxAPI/index.html</p><p>CCSP APIs Guide - 7.4 
17 
5: CCSP Agent Proxy Service API 
The CCSP 7.4 Agent Proxy Service API Library describes the SOAP Agent methods for remote control, 
customizations, and specific applications.</p><p>CCSP APIs Guide - 7.4 
18 
Note 
To validate the authenticity of the request, most of the AgentWS methods require a session 
based AgentGUID to be supplied as part of the request header. 
Due to the Messaging design, the following methods are unable to supply this parameter as part 
of the header:  
• 
FolderService class: GetAttachmentContent 
• 
FolderService class: GetAttachmentContent 
• 
FolderService class: GetAttachmentContentEmailPart 
• 
FolderService class: AddAttachment 
• 
FolderService class: GetMedia 
 
These methods use the global agent ID supplied as a query parameter. Because the global agent 
ID value is also session based, it can also be used to authenticate the request. 
Filtering/Sorting by optional parameters 
Starting from HF74-67429, the FolderService exposes a new API: GetFolderItemsEx2 with a new 
parameter named advancedFilter.  
This parameter allows you to specify a JSON string that describes a filter expression to allow 
filtering MSR items by optional parameters. See Syntax of JSON filter below. 
In addition, it is possible to sort MSR items by optional parameter value. The name of the optional 
parameter for sorting should be specified in the existing API parameter sortFieldName.  See 
Specifying sort field. 
All other parameters to GetFolderItemsEx2 API have the same meaning and functionality as in 
GetFolderItemsEx API. 
Before continuing reading, we highly recommended that you first read the Managing call optional 
parameters section of the CCSP Operation Guide. 
Syntax of JSON filter 
About filters 
There are two types of filters: 
• 
Basic — filters that run a logical operator on an MSR field. 
• 
Compound — filters that run a logical operator on other filters.</p><p>CCSP APIs Guide - 7.4 
19 
Syntax conventions 
The following conventions are used when describing the JSON syntax. 
Convention 
Description 
&lt;name&gt; 
The &lt;name&gt; should be replaced by a real value according to the context of name.  
| (pipe) 
Only one of the values separated by the pipe should be selected. 
… 
Repeated value 
Basic filters 
ContainsSubstring 
Purpose: Matches item if it contains the specified optional parameter and its value contains the 
string specified in &lt;value&gt;. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "ContainsSubstring",  
    "ComparisonMode": "CaseInsensitive|CaseSensitive", 
    "Value": "&lt;optional-parameter-value&gt;" 
} 
Exists 
Purpose: Matches item if it contains the specified optional parameter. 
Syntax: 
{ 
    "Property": "OptionalParameters",         
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "Exists" 
}</p><p>CCSP APIs Guide - 7.4 
20 
IsBetween 
Purpose: Matches item if it contains the specified optional parameter and its value is between the 
specified &lt;LowerBound&gt; and &lt;UpperBound&gt; values. 
Syntax: 
{ 
    "Property": "OptionalParameters",         
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsBetween", 
    "LowerBound": "&lt;optional-parameter-value&gt;", 
    "UpperBound": "&lt;optional-parameter-value&gt;" 
}       
IsEqualTo 
Purpose: Matches item if it contains the specified optional parameter and its value is equal to the 
specified &lt;value&gt;. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsEqualTo", 
    "Value": "&lt;optional-parameter-value&gt;" 
} 
IsGreaterOrEqual 
Purpose: Matches item if it contains the specified optional parameter and its value is greater or 
equal to the specified &lt;value&gt;. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsGreaterOrEqual", 
    "Value": "&lt;optional-parameter-value&gt;" 
}</p><p>CCSP APIs Guide - 7.4 
21 
IsGreaterThan 
Purpose: Matches item if it contains the specified optional parameter and its value is greater than 
the specified &lt;value&gt;. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsGreaterThan", 
    "Value": "&lt;optional-parameter-value&gt;" 
} 
IsInList 
Purpose: Matches item if it contains the specified optional parameter and its value is one of the 
specified values in &lt;PossibleValues&gt; list. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsInList", 
    "PossibleValues": [&lt;optional-parameter-value &gt;, …]" 
} 
IsLessThan 
Purpose: Matches item if it contains the specified optional parameter and its value is less than the 
specified &lt;value&gt;. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsLessThan", 
    "Value": "&lt;optional-parameter-value&gt;" 
}</p><p>CCSP APIs Guide - 7.4 
22 
IsLessThanOrEqual 
Purpose: Matches item if it contains the specified optional parameter and its value is less than or 
equal to the specified &lt;value&gt;. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsLessThanOrEqual", 
    "Value": "&lt;optional-parameter-value&gt;" 
} 
IsLike 
Purpose: Matches item if it contains the specified optional parameter and its value matches the 
pattern specified in &lt;value&gt;. Pattern must follow the rules of SQL LIKE predicate. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "IsLike",  
    "Value": "&lt;pattern&gt;" 
} 
NotExists 
Purpose: Matches item if it does not contain the specified optional parameter. 
Syntax: 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "&lt;optional-parameter-name&gt;", 
    "Operator": "NotExists" 
}</p><p>CCSP APIs Guide - 7.4 
23 
Compound filters 
Not 
Purpose: Matches item if result of filter specified by &lt;filter&gt; is false. 
Syntax: 
{ 
    "Operator": "Not”, 
    "InnerFilter": &lt;filter&gt; 
} 
SearchFilterGroup 
Purpose: Performs a logical operator on result of multiple filters. When LogicalOperator is OR then 
item is matched if result of any of listed filters is true. When LogicalOperator is AND then item is 
matched if result of all listed filters is true. 
Syntax: 
{ 
    "Operator": "SearchFilterGroup”, 
    “LogicalOperator”: “OR|AND”, 
    "Filters": [ &lt;filter&gt; , &lt;filter&gt;, … ] 
}</p><p>CCSP APIs Guide - 7.4 
24 
Filters support matrix 
The following table lists how each filter supports the various optional parameter data types. The 
entire query will fail if you use an incompatible combination of filter/data type. 
Filter 
Supported for 
String optional 
parameter? 
Supported for 
Integer optional 
parameter? 
Supported for 
Datetime 
optional 
parameter? 
Optional 
parameter 
must be 
indexed? 
ContainsSubstring 
Yes 
No 
No 
Yes 
Exists 
Yes 
Yes 
Yes 
No 
IsBetween 
No 
Yes 
Yes 
Yes 
IsEqualTo 
Yes 
Yes 
Yes 
Yes 
IsGreaterOrEqual 
No 
Yes 
Yes 
Yes 
IsGreaterThan 
No 
Yes 
Yes 
Yes 
IsInList 
Yes 
Yes 
Yes 
Yes 
IsLessThan 
No 
Yes 
Yes 
Yes 
IsLessThanOrEqual 
No 
Yes 
Yes 
Yes 
IsLike 
Yes 
No 
No 
No 
Not 
Yes 
Yes 
Yes 
No 
NotExists 
Yes 
Yes 
Yes 
No 
SearchFilterGroup 
Yes 
Yes 
Yes 
No 
Examples 
Match all items where Optional parameter “CallCounter” = 3 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "CallCounter", 
    "Operator": "IsEqualTo", 
    "Value": "3" 
}</p><p>CCSP APIs Guide - 7.4 
25 
Match all items where Optional parameter “CallCounter” &gt; 3 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "CallCounter", 
    "Operator": "IsGreaterThan", 
    "Value": "3" 
} 
Match all items where Optional parameter “CallCounter” is 3 or 4 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "CallCounter", 
    "Operator": "IsInList", 
    "PossibleValues": [ "3" , “4” ] 
} 
Match all items where Optional parameter “Category” = “Important” 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "Category", 
    "Operator": "IsEqualTo", 
    "Value": " Important " 
} 
Match all items where Optional parameter “Category” contains the word “Important” in 
case-sensitive. 
    "Property": "OptionalParameters", 
    "SubProperty": "Category", 
    "Operator": "ContainsSubstring", 
           "ComparisonMode": " CaseSensitive", 
    "Value": " Important " 
}</p><p>CCSP APIs Guide - 7.4 
26 
Match all items where Optional parameter “CallCounter” != 3 
{ 
    "Operator": "Not”, 
    "InnerFilter": { 
        "Property": "OptionalParameters", 
        "SubProperty": "CallCounter", 
        "Operator": "IsEqualTo", 
        "Value": "3" 
    } 
} 
Match all items where Optional parameter “CallCounter” &gt; 3 AND “Category” = “Important” 
{ 
    "Operator": "SearchFilterGroup”, 
    “LogicalOperator”: “AND”, 
    "Filters": [ 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "CallCounter", 
    "Operator": "IsGreaterThan", 
    "Value": "3" 
}, 
{ 
    "Property": "OptionalParameters", 
    "SubProperty": "Category", 
    "Operator": "IsEqualTo", 
    "Value": " Important " 
} 
    ] 
}</p><p>CCSP APIs Guide - 7.4 
27 
Specifying sort field 
To sort the MSR items list by an optional parameter, specify “OptionalParameters.&lt;optional-
parameter-name&gt;” in the sort field. 
Note 
• 
You can sort  by optional parameter even if that parameter is not part of the JSON filter. 
• 
The optional parameter used for sorting does not have to be configured to allow filtering. 
• 
If an item matches the filter but does not have a value in the optional parameter used for 
sorting, then the item will be ranked at the top of the matched items result set if the sort 
order is ascending, or at the bottom of the result set if the sort order is descending. 
Example 
To sort MSR items by optional parameter “CallCounter”, specify 
"OptionalParameters.CallCounter" in the sortFieldName parameter of GetFolderItemsEx2 
API.</p><p>CCSP APIs Guide - 7.4 
28 
6: CCSP Chat API 
This chapter describes the JSON functions in the ChatExtension.dll. 
This chapter contains the following information: 
• 
Configuration 
• 
Flow diagrams 
• 
JoinChat 
• 
SendMSG 
• 
GetEvents 
• 
LeaveChat 
• 
FireEvent 
 
The CCSP Chat API provides an easy to use API that can be used on mobile and non-mobile devices 
and different html pages.  
The JSON ChatExtension.dll provides just the data which customers can use to implement their own 
solutions.  
The JSON interface gets the requests inside the HTTP request and provides the response in JSON.  
The ChatExtension.dll recognizes the user by connection ID. If the user changes his IP,  the 
ChatExtension.dll knows it is the same connection ID and therefore the same user. 
The original HTML ChatExtension.dll provides only configurable HTML pages. For details, see A: CCSP 
Web Support integration. 
The following table shows which JSON function replaces which HTML page in the original HTML 
ChatExtension.dll. 
JSON 
HTML 
JoinChat 
Connect 
SendMSG 
Write 
GetEvents 
Read and Status 
LeaveChat 
Close</p><p>CCSP APIs Guide - 7.4 
29 
Configuration 
To support cross domains on the API, you need to configure CCSP to support Cross-Origin Resource 
Sharing (CORS). CORS is a web browser technology specification that defines ways for a web server 
to allow its resources to be accessed by a web page from a different domain. 
Note 
The Chat Client host (where the Chat Client SDK runs) and the CCSP host (where chatextension dll 
runs) must be in the same zone.. 
 
To configure CCSP to support CORS: 
1. 
On the CCSP server, where chatextension dll runs, open IIS Manager and add the following 
headers to HTTP Response Headers: 
o 
Access-Control-Allow-Origin: * 
o 
Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, 
AgentGUID, SOAPAction 
o 
Access-Control-Allow-Methods: POST,GET,OPTIONS 
 
2. 
If the chat client uses jQuery, on the server where the Chat Client SDK runs, set the following 
flag: 
jQuery.support.cors = true;</p><p>CCSP APIs Guide - 7.4 
30 
Flow diagrams 
The following diagram shows the flow between the client and the ChatExtension.dll.</p><p>CCSP APIs Guide - 7.4 
31 
JoinChat flow 
The following diagram show the flow between the client and the ChatExtension.dll for JoinChat. 
  
SendMsg flow 
The following diagram show the flow between the client and the ChatExtension.dll for SendMsg. 
 
GetEvents flow 
The following diagram show the flow between the client and the ChatExtension.dll for GetEvents. 
 
LeaveChat flow 
The following diagram show the flow between the client and the ChatExtension.dll for LeaveChat.</p><p>CCSP APIs Guide - 7.4 
32 
JoinChat 
JoinChat makes a new connection to the contact center. See JoinChat flow. 
Request 
The JoinChat POST method URL is: 
[path]/ChatExtension.dll?joinchat 
 
The JSON data in the body is: 
{ 
      "API_Version ":1.0     ,      
      "Call_Center_Address": "", 
      "Call_Center_QueueName": "", 
      "Call_Center_Port": , 
      "Calling_User_Priority": , 
      "Calling_User_URL": "", 
      "Calling_User_FirstName": "", 
      "Calling_User_LastName": "", 
      "TenantID": "", 
      "ApplicationID": ", 
      "AccountID": "", 
      "Calling_User_Skills":"", 
      "Routing_Priority": , 
      "TQOS": , 
      "Calling_User_HardMessage":"" 
      "OptionalParameterCount": [ 
    { 
            "key":””,  
            "value":”” 
        }, 
        { 
            "key":””,  
            "value":”” 
       }, 
        { 
            "key": “”, 
            "value":””</p><p>CCSP APIs Guide - 7.4 
33 
        } 
    ] 
} 
For example: 
{ 
      "API_Version ":"1.0",      
      "Call_Center_Address": "10.116.200.50", 
      "Call_Center_QueueName": "Age", 
      "Call_Center_Port": 2324, 
      "Calling_User_FirstName": "Dana", 
      "Calling_User_LastName": "shimon", 
      "TenantID":"TT" , 
      "ApplicationID": "TTAplication", 
      "Calling_User_Skills":"A+B+C" 
      "Calling_User_HardMessage":"I need help" 
      "OptionalParameterCount": [ 
    { 
             "key": "title", 
             "value":"Mr" 
         }, 
         { 
             "key": "empl_Id", 
             "value":"802431330" 
         }, 
         { 
             "key": "date", 
             "value":"16 Nov 2013" 
         } 
     ] 
 }</p><p>CCSP APIs Guide - 7.4 
34 
The following table describes the variables included in the JSON data. 
Name 
Description 
Required 
Default 
Type 
API_Version 
API version  
Yes 
1.0 
String 
Call_Center_Address 
ACD address or name 
Yes 
Server name 
for the www 
String 
Call_Center_QueueName 
Name of queue to place 
caller in. This name must 
match a queue on the ACD. 
Yes 
DefaultQueue 
String 
Call_Center_Port 
Port for ACD Server 
communication 
Yes 
2324 
Integer 
Calling_User_Priority 
Assign priorities to calls. 
Calls with higher priority will 
always be routed to agents 
before the calls with lower 
priority in the same queue. 
No 
-1 
Integer 
Calling_User_FirstName 
Caller's first name 
No 
Caller 
String 
Calling_User_LastName 
Caller's last name 
No 
Caller 
String 
TenantID 
Tenant name to place the call 
in. This name must match a 
tenant on the ACD. 
Yes 
DefaultTenant 
String 
ApplicationID 
Application name to place 
the call in. This name can 
match an existing application 
name in the ACD. If a match 
is found, the selected 
application is run even if the 
application rule is not 
evaluated to TRUE. If a 
match is not found, the first 
application whose rule 
evaluates to TRUE is 
selected. 
Yes 
DefaultApplic
ation 
String 
Calling_User_Skills 
List of required skills — 
separated by plus (+) signs 
No 
"" 
String  
AccountID 
Associated with the 
customer account 
No 
"0" 
String</p><p>CCSP APIs Guide - 7.4 
35 
Name 
Description 
Required 
Default 
Type 
Routing_Priority 
Dynamic routing. Route each 
call to the most qualified 
agent based on skills and the 
assigned priority (Call 
maturity). 
No 
0 
Integer 
TQOS 
Target Quality of Service — 
the number of seconds 
within which the call should 
be answered.  
No 
0 
Integer 
Calling_User_Hard 
Message 
First message agent will see 
when the caller connects 
No 
I need some 
help 
String 
Calling_User_URL 
URL to pass to agent 
No 
"" 
String 
OptionalParameterCount 
Optional parameter values 
are available for the life of 
the call. 
Optional parameter 
structure in Chat API is:  
"OptionalParameterCount": [ 
    { 
            "key":””,  
            "value":”” 
        }, 
        { 
            "key":””,  
            "value":”” 
       }, 
        { 
            "key": “”, 
            "value":”” 
        } 
    ] 
Note 
The maximum total length 
for the optional parameters, 
including the optional 
parameter names, is 1024 
bytes. 
No 
"" 
String</p><p>CCSP APIs Guide - 7.4 
36 
Response 
The response is 200 OK. 
It contains the new Connection_ID, in the format: XXXXX_YYYYY 
The client must send the same string in every Connection_ID. 
The JSON data in the body is: 
{       
      "Connection_ID":""  
} 
 
For example: 
{       
      "Connection_ID":"6047936_1379917213"  
} 
 
The Available-Connections key specifies the number of currently available simultaneous chat 
connections, that is, the maximum possible minus the number of connections currently in use. The 
maximum possible simultaneous chat connections is 899, because of IPWorks limitations. If the 
simultaneous chat calls limit is reached and a new call arrives, the JSON response to JoinChat is 
error code 18 (MAX_CONNECTIONS_REACHED). 
Errors 
If the server encounters an error, the response is 500 Internal Server Error. 
If a required field is empty, the port is invalid, or the application version is invalid, one of the 
following error codes can be added to the error 200 message, in the following format: 
{“Command”:”Error”, “Error_Code”: X} 
 
Description 
Code 
INVALID_PORT 
4 
INVALID_QUEUE_NAME 
8 
CONNECTION_FAILED 
12 
INVALID_TENANTID 
13 
INVALID_APP_VERSION 
14 
INVALID_APPLICATIONID  
15 
MAX_CONNECTIONS_REACHED 
18</p><p>CCSP APIs Guide - 7.4 
37 
For example: 
{“Command”:”Error”, “Error_Code”: 13} 
 
If a field is missing, the default value is used. For example, if only the following fields are available : 
{ 
      "Call_Center_Address": "10.116.200.50", 
      "Call_Center_QueueName": "Age", 
      "Calling_User_FirstName": "Dana", 
      "Calling_User_LastName": "shimon", 
      "TenantID":"TT" , 
      "ApplicationID": "TTAplication", 
      "Calling_User_Skills":"A+B+C" 
      "Calling_User_HardMessage":"I need help" 
} 
 
Then the missing fields use the default values: 
      "API_Version ":"1.0"      
      "Call_Center_Port": 2324 
      "Calling_User_Priority":-1  
      "Calling_User_URL": "www.gmail.com" 
      "AccountID": "0", 
      "Routing_Priority":0  
      "TQOS":0 
If Call_Center_Address  is missing, the IP address of the ACD server on the WWW server is used.</p><p>CCSP APIs Guide - 7.4 
38 
SendMSG 
SendMSG sends a message to the agent. See SendMsg flow. 
Request 
The SendMSG POST method URL is: 
[path]/ChatExtension.dll?sendmsg 
 
The JSON data in the body is: 
{ 
 
      "Connection_ID ": "", 
      "Message_Text": ""        
} 
 
The Connection_ID format is XXXXX_YYYYY and the client must send the same string in every 
Connection_ID. 
The Message_Text  can be a maximum of 1024 characters.  
For example: 
{ 
 
      "Connection_ID ": "6047936_1379917213", 
      "Message_Text": "I have a question" 
} 
Response 
The response is 200 OK. 
Error 
If the server encounters an error, the response is 500 Internal Server Error.</p><p>CCSP APIs Guide - 7.4 
39 
GetEvents 
GetEvents returns pending requests for a new agent, and error or status messages. See GetEvents 
flow. 
Request 
The GetEvents GET method URL is: 
[path]/ChatExtension.dll? command=getevents&amp; Connection_ID= XXXXX_YYYYY 
&amp;Last_Event_ID=Z&amp;GUID_ID=b42f53a2-1297-4403-b669-a50eb611b7e7 
 
The Connection_ID format is XXXXX_YYYYY and the caller must send the same string in every 
connection ID. 
The Last_Event_ID is used by the client to acknowledge the last event message ID that was 
successfully received. If the last event is not the same as the one the server sent, the server will 
send the conversion again. 
Note 
In the URL, command must be in GET method. 
 
For example, if the last event the client received from the server was 4: 
ChatExtension.DLL? command=getevents&amp; Connection_ID= 
6047936_1379917213&amp;Last_Event_ID=4 
 
The GUID_ID is an optional parameter and must be unique for each GetEvents send. It is used to 
track the GetEvents messages between the client and ChatExtension for debugging purposes.  
If not used, the GetEvents GUID_ID is tracked only at ChatExtension level but not between the client 
and ChatExtension. The GetEvents GET method URL without GUI_ID is: 
[path]/ChatExtension.dll? command=getevents&amp; Connection_ID= XXXXX_YYYYY 
&amp;Last_Event_ID=Z 
 
The user timeout period is configured on the ACD server, in the following registry key: 
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\CosmoCom\Universe 
\CurrentVersion\ChatExtension\Parameters\&lt;tenant name&gt; UserTimeoutPeriod 
The default is 45. 
Each time the ACD server receives GetEvents, the server updates the last access. If last access + 
UserTimeoutPeriod &lt; now, the CosmoCaller Extension deletes the user’s connection.</p><p>CCSP APIs Guide - 7.4 
40 
Response 
The response is 200 OK. 
The JSON data in the body is: 
{       
      "Connection_ID":"", 
       Events: 
       [ 
         {  
           "Command":"status", 
           "Status_Code":, 
           "Additional_Information":"",  wating state (165), discconect  
 
 
 
 
 
 
 
 
(no agent/refused)(107) 
           "Estimated_Time":  ,          wating state(165) 
           "Event_ID": 
         }, 
         {  
          "Command":"read", 
           "Participant_Name":"", 
           "Message_Text":"", 
           “Pushed_Url”:””,               if URL pushed from the agent 
           "Event_ID": 
         }, 
         {  
           "Command":"Participantdisconnected", 
           "Participant_Name":"", 
           "Event_ID": 
         }, 
         {  
           "Command":"Error", 
           "Error_Code":, 
           "Event_ID" : 
         } 
       ] 
}</p><p>CCSP APIs Guide - 7.4 
41 
GetEvents messages are added as follows: 
• 
read − any messages from the agent 
• 
Participantdisconnected − if the agent disconnects 
• 
Error − a wrong Event_ID 
• 
500 Internal Server Error − an internal error 
• 
Event_ID − sequential and bigger from message to message 
• 
Connection_ID only – if the server has nothing to send 
 
The following example shows the Event_ID flow.</p><p>CCSP APIs Guide - 7.4 
42 
Status codes 
The following table describes the status codes. 
Description 
Code 
Calling Call Center 
 
                                                                                             
104 
Waiting for Agent 
                                                                                                           
105 
In Call 
106 
Not Connected                                                                                                                           
107 
Connected to the call center                                                                                                   
133 
Call placed on hold                                                                                                                    
157 
Waiting in queue                                                                                                                       
165 
Call ID parameter 
166  
Chat Connection Server has reached its 
maximum capacity 
167 
 
Waiting in queue additional information status codes 
The following table describes the Waiting in queue additional information status codes. 
Description 
Code 
Less than 
1 
About 
2 
Longer than 
3</p><p>CCSP APIs Guide - 7.4 
43 
Not Connected additional information status codes 
The following table describes the Not Connected additional information status codes. 
Description 
Code 
Unknown reason  
6 
Insufficient memory 
7 
No satisfying agents 
8 
Invalid queue 
9 
No primary connection server address 
10 
No call ID 
11 
Invalid external queue 
12 
Unknown skill name is specified in call 
requirements 
13 
Stream with reference your already exist 
14 
Cannot find the call by your reference 
15 
Call with your reference cannot be accepted 
by the agent 
16 
There is no connection available now 
17 
Agent refused 
18 
Error code 
The following table describes the invalid Event_ID error code. 
Description 
Code 
Invalid Event_ID 
17</p><p>CCSP APIs Guide - 7.4 
44 
Examples 
In the following example, the agent sent a message, was in call, and then disconnected. 
{       
      "Connection_ID":"6047936_1379917213", 
       "Events": 
       [ 
         {  
          "Command":"read", 
           "Participant_Name":"Dana", 
           "Message_Text":"How can I help you", 
           "Event_ID":1 
         }, 
         {  
           "Command":"status", 
           "Status_Code":106, 
           "Event_ID":2 
         }, 
         {  
           "Command":"Participantdisconnected", 
           "Participant_Name":"Dana", 
           "Event_ID":3 
         } 
 
       ] 
}</p><p>CCSP APIs Guide - 7.4 
45 
In the following example, the agent disconnected:  
{       
      "Connection_ID":"6047936_1379917213", 
       "Events": 
       [ 
         {  
           "Command":"Participantdisconnected", 
           "Participant_Name":"Dana", 
           "Event_ID":10 
         }, 
         {  
           "Command":"status", 
           "Status_Code":107, 
           "Event_ID":11 
         } 
       ] 
} 
 
In the following example, the Event_ID is invalid: 
{       
      "Connection_ID":"6047936_1379917213", 
       "Events": 
       [ 
         {  
           "Command":"Error", 
           "Error_Code":17, 
           "Event_ID :20 
         }, 
       ] 
} 
 
In the following example, the server has nothing to send, so only the Connection_ID appears: 
{       
      "Connection_ID":"6047936_1379917213"</p><p>CCSP APIs Guide - 7.4 
46 
LeaveChat 
LeaveChat disconnects the caller from the chat. See LeaveChat flow. 
Request 
The LeaveChat POST method URL is: 
[path]/ChatExtension.dll?leavechat 
 
The JSON data in the body is: 
{       
      "Connection_ID":""  
} 
 
The Connection_ID format is XXXXX_YYYYY and the client must send the same string in every 
Connection_ID. 
For example: 
{ 
 
      "Connection_ID ": "6047936_1379917213", 
} 
Response 
The response is 200 OK.</p><p>CCSP APIs Guide - 7.4 
47 
FireEvent 
The FireEvent sends a general chat message from the customer to the agent. 
Request  
The FireEvent POST method URL is: 
[path]/ChatExtension.dll? fireevent 
 
The JSON data in the body is: 
{ 
"Connection_ID": "", 
" Fire_Event_Name":  
" OptionalParametersCount ":  (not mandatory) 
} 
 
The Connection_ID format is XXXXX_YYYYY and the client must send the same string in every 
Connection_ID. 
The Fire_Event_Name parameter is a mandatory string value and cannot be empty. 
OptionalParametersCount is optional and, if it exists, includes the key and value pairs. 
For example: 
{ 
"Connection_ID": "6047936_1379917213", 
"Fire_Event_Name":"evt_5", 
"OptionalParameterCount":[{"key":"FirstKey","value":"FirstVal"},{"key":"Second
Key","value":"SecondVl"}] } 
CCSP UI 
For CCSP UI, you can send a generic event that can eventually pass everything for chat.  
For example: 
If the Chat API sends the following FireEvent with next payload: 
{"Connection_ID":"474793400_1492938906","Fire_Event_Name":"SC_ATTACHMENT","Opt
ionalParameterCount":[ 
{"key":"SC_URL","value":"__http://google.com"}  
]}</p><p>CCSP APIs Guide - 7.4 
48 
You can subscribe to NewChatEvent and extract parameters as below: 
window.app.PubSub.subscribe('NewChatEvent', null, function(evt){  
 var eventName = evt.EventName; 
 switch(eventName) 
{ case "SC_ATTACHMENT": var scUrl = getValueByKey(evt.chatEvent.OptPar, 
"SC_URL"); default: return; }  
}); 
The following example shows the received object. 
 
Response  
The response is 200 OK (with {} in the body as requested by JSON). 
The following example shows the FireEvent flow. 
 
Error 
If Fire_Event_Name is empty or does not exist, the response is 501 Not Implemented. 
If the server encounters any other error, the response is 500 Internal Server Error.</p><p>CCSP APIs Guide - 7.4 
49 
7: CCSP CIS to Connector API 
Note 
You must work with Enghouse PS to build interfaces to the CIS. Currently, we do not support 
customer calls directly in Development related to CIS API issues. 
 
This chapter describes how to connect to the CCSP Central Integration Server (CIS). 
This chapter contains the following information: 
• 
High-level overview 
• 
Display the HTML web page 
• 
Log in 
• 
Connect through WebSocket 
• 
Create a GET_EVENTS request 
• 
Control the processing rate 
• 
Receive messages 
• 
Stop events 
• 
Log out 
• 
Add events to CISEvents.xml</p><p>CCSP APIs Guide - 7.4 
50 
High-level overview 
The following diagram shows the communication between the CIS and the Connector in high-level 
steps. 
 
The following sections provide a simple connector code snapshot that demonstrates how to 
connect to the CIS. 
The client sample uses WebSocketSharp and Newtonsoft.JSON 3rd party library. 
The communication is based on JSON format. 
In the following example, the CIS configuration is: 
• 
CIS IP — 10.120.30.71 
• 
HTTP IP — 10.120.30.71 , HTTP PORT = 8088 
• 
WS IP — 10.120.30.71, WS PORT = 8089.</p><p>CCSP APIs Guide - 7.4 
51 
Display the HTML web page 
If you connect through a web browser, to display the html web page, browse to: 
http://&lt;CIS HTTP IP&gt;:&lt;HTTP PORT&gt;/cis/test  
Log in 
The first step to connect to the CIS, is the login process. 
To log in, the connector must issue an HTTP POST request to cis\login uri, with the username and 
password parameters represented in string. 
Request body format 
bodyText = {"username":"&lt;user@domain&gt;","password":"&lt;user password&gt;"} 
For example: 
bodyText = "username":"CCUAdmin@ex2010.loc","password":"pw"} 
 
The following table describes the parameters. 
Parameter name 
Type 
Mandatory 
username 
String 
Yes 
password 
String 
Yes 
 
If the request is successful, the CIS sends a reply with the following variables: 
• 
session_id — represents the session ID. Keep this ID to use for further requests to the CIS. 
• 
tenant_id — the tenant that is permitted to be monitored by this user. For the landlord, the 
value is -1. 
• 
assigned_tenants — the tenants that are assigned to the CIS. If no tenants are assigned to 
the CIS, the CIS monitors all tenants, and the value is -1. 
• 
event_providers — the list of event providers that are associated with the CIS. 
• 
supported_messages — the list of messages that CIS can support. 
• 
web_socket_ip — the IP used by the CIS for  web socket communication.  If the value is 0.0.0.0, 
the CIS listens on all IPs assigned to it. 
• 
web_socket_port — the port used by the CIS for web socket connection, for example,  8089. 
• 
correlation_id — is per GET_EVENT request. Use to correlate the messages being received by 
the CIS to the request ID that was made by the connector.</p><p>CCSP APIs Guide - 7.4 
52 
Code snapshot 
 //HttpClient client; 
using (HttpClient client = new HttpClient()) 
{ 
         client.BaseAddress = new Uri(@"http://10.120.30.71:8088/cis/login"); 
         client.DefaultRequestHeaders.Accept.Clear(); 
         client.DefaultRequestHeaders.Accept.Add(new 
MediaTypeWithQualityHeaderValue("application/json")); 
 
 
         var data = new OrderedDictionary(); 
         data["username"] = @"CCUAdmin@ex2010.loc"; 
         data["password"] = @"pw"; 
 
 
         var postDataJson = JsonConvert.SerializeObject(data); 
         var postdataString = new StringContent(postDataJson, new 
UTF8Encoding(), "application/json"); 
 
         var response = await 
client.PostAsync("http://10.120.30.71:8088/cis/login", postdataString); 
 
         var stringContent = await response.Content.ReadAsStringAsync(); 
 
         Console.WriteLine("{0}", stringContent); 
Example of HTTP POST Message being sent 
{"username":"CCUAdmin@ex2010.loc","password":"pw"}</p><p>CCSP APIs Guide - 7.4 
53 
Example of HTTP POST Message being received 
The following examples show the types of HTTP POST Message being received. 
Successful login 
{ 
  "session_id": "SSN6EEV5", 
  "result": "success", 
  "tenant_id": -1, 
  "agent_global_id": 2234049340917612544, 
  "assigned_tenants": -1, 
  "event_providers": [ 
    "VCS,11", 
    "VCS,30" 
  ], 
  "supported_messages": { 
    "555": "CIS_SNAPSHOT_INFO", 
    "164": "CS_CALL_OFFERED", 
    "47": "CS_CALLOUT", 
    "48": "CS_ACK_CALLOUT", 
    "49": "CS_NACK_CALLOUT", 
    "3": "CS_CALLARRIVAL", 
    "5": "CS_SCRIPTCOMPLETED", 
    "4": "CS_ACKCALLARRIVAL", 
    "28": "AGENT_RING", 
    "8": "CS_PICKUPCALL", 
    "120": "CS_AGENTCONNECTED", 
    "37": "CS_NACKPICKUPCALL", 
    "9": "CS_ACKCALLPICKUP", 
    "327": "CS_LOG_MediaData_VCS", 
    "325": "CS_CALL_TERMINATED" 
  }, 
  "https_enabled": false, 
  "http_ip": "10.120.30.71", 
  "http_port": 8088, 
  "https_ip": "10.120.30.71", 
  "https_port": 8443, 
  "web_socket_ip": "0.0.0.0",</p><p>CCSP APIs Guide - 7.4 
54 
  "web_socket_port": 8089, 
  "web_socket_secure_ip": "0.0.0.0", 
  "web_socket_secure_port": 8431 
} 
Invalid user or password 
{ 
  "result": "error", 
  "reason": "Authorization error - check your credentials or contact your 
administrator." 
} 
Invalid parameters 
For example, user instead of username. 
 
   { 
                 "result": "error", 
                 "reason": "Username or password are empty." 
               } 
Connect through WebSocket 
After the login pocess, you need to connect to the CIS through WebSocket. 
The client sample uses the WebSocketSharp library to implement the web socket. 
using (var ws = new 
WebSocketSharp.WebSocket(String.Format(@"ws://{0}:{1}/cis/{2}", 
data.web_socket_ip, data.web_socket_port, data.session_id))) 
 { 
 
   ws.OnMessage += (sender, e) =&gt; Console.WriteLine(" &lt;==== CIS Message  : " + 
e.Data); 
   ws.Connect(); 
} 
 
In the above example: 
• 
data.web_socket_ip — represents the websocket IP that was received in the logon response. 
• 
data.web_socket_port — represents the websocket port that was received in the port 
response.  
• 
data.session_id — represents the session ID that was received in the logon response.</p><p>CCSP APIs Guide - 7.4 
55 
Create a GET_EVENTS request 
After connecting to the CIS, you can create a GET_EVENTS request. 
To send a get request, you need to send an HTTP POST request to cis\getevents. 
Request body format 
bodyText = { 
"session_id":"&lt;sessionId received in login response&gt;", 
"event_descriptors": [ &lt;list of event descriptor&gt; 
  {"groups":[&lt;list of groupIds&gt;],"tenant_id":&lt;requested tenant Id &gt;,"event_type":"&lt; event type&gt;",  
"event_mask":[&lt;list of event id&gt;]}, 
  ] 
} 
For example: 
bodyText = { 
"session_id":"87HL4HAL", 
"event_descriptors":[ 
  
{"groups":[2],"tenant_id":0,"event_type":"both","event_mask":[16,17,43,164]}, 
  {"groups":[3,3],"tenant_id":1,"event_type":"both"} 
] 
} 
The following table describes the parameters. 
Parameter name 
Type 
Mandatory 
session_id 
String 
Yes 
event_descriptors 
Data structure of:  
tenant_id, list of groups, 
event_type, and event_mask 
 
tenant_id 
Int 
Yes. See Restrictions below. 
groups 
Array of int 
Yes. See Restrictions below. 
event_type 
String  
Yes. See Restrictions below. 
event_mask 
Array of int 
Yes. See Restrictions below.</p><p>CCSP APIs Guide - 7.4 
56 
The body format should be in json format. 
Restrictions  
The following parameters have restrictions: 
• 
groups — you cannot request to monitor tenant Id = -1, with list of groups. The group list 
must be empty. 
• 
tenant_id — you cannot request to monitor tenant Id = -1, and an additional tenant.  However, 
you can request to monitor several tenants, represented with a specific tenant ID. 
• 
event_type — can contain the following: "agent", "call", "both". If the event_type is not sent, it 
is interpreted by the CIS as "both". 
• 
event_mask — represents the list of events (messages) that the connector is interested in. If 
it's not sent, it is interpreted by the CIS as all messages. 
 
If the request is successful, the CIS sends the response with a correlation_id,  more messages, 
including the state of all of the event providers, and the snapshot (if it's working in STAND-BY 
mode). 
The correlation_id is per GET_EVENT request, and should be used to correlate the messages being 
received by the CIS to the request ID that was made by the connector.  
Note 
It is important to count the number of events being received. For more information, see Control 
the processing rate.</p><p>CCSP APIs Guide - 7.4 
57 
var getEventsRequest= new OrderedDictionary(); 
getEventsRequest["session_id"] = data.session_id; 
getEventsRequest["event_descriptors"] = new List&lt;EventDescriptor&gt; {new 
EventDescriptor() { tenant_id = data.tenant_id, groups = new List&lt;int&gt;() , 
event_type = "both"}}; 
 
var postGetEventsJson = JsonConvert.SerializeObject(getEventsRequest); 
var postGetEventsString = new StringContent(postGetEventsJson, new 
UTF8Encoding(), "application/json"); 
 
response = client.PostAsync("http://10.120.30.71:8088/cis/getevents", 
postGetEventsString).Result; 
 
stringContent = response.Content.ReadAsStringAsync().Result; 
 
Console.WriteLine("{0}", stringContent); 
try 
{ 
   data = JsonConvert.DeserializeObject&lt;Data&gt;(stringContent); 
} 
catch (Exception e) 
{ 
                 
} 
Example of HTTP POST Message being sent 
bodyText = { 
"session_id":"87HL4HAL", 
"event_descriptors":[ 
  
{"groups":[2],"tenant_id":0,"event_type":"both","event_mask":[16,17,43,164]}, 
  {"groups":[3,3],"tenant_id":1,"event_type":"both"} 
] 
}</p><p>CCSP APIs Guide - 7.4 
58 
Example of HTTP POST Message being received 
{ 
  "session_id": "FRO4678R", 
  "result": "success", 
  "correlation_id": 8 
} 
 
... 
 
  "message": "event_provider_status", 
  "session_id": "W3EPLM9R", 
  "statuses": [ 
    { 
      "event_provider": "VCS,11", 
      "state": "connected" 
    }, 
    { 
      "event_provider": "VCS,30", 
      "state": "connected" 
    } 
  ] 
} 
 
… 
 
  "message": "snapshot", 
  "event_provider": "VCS,11", 
  "infos": [ 
    { 
      "message": "cis_snapshot_info", 
      "call_id": 2236360475703377931, 
      "connection_server_id": 11, 
      "tenant_id": 0, 
      "acount_id": 0, 
      "queue_id": 0, 
      "queue_name": "", 
      "caller_ani": "5010",</p><p>CCSP APIs Guide - 7.4 
59 
      "caller_dnis": "5800", 
      "caller_id": "\"AAAA\"" 
    } 
  ], 
  "session_id": "W3EPLM9R", 
  "correlation_id": 7 
} 
 
… 
 
  "message": "snapshot", 
  "event_provider": "VCS,30", 
  "infos": [], 
  "session_id": "W3EPLM9R", 
  "correlation_id": 7 
} 
Control the processing rate 
Slow processing of the events on the connector side can cause performance issues on the server 
side, because the messages queue grows. 
The CIS implements a simple rate control mechanism, which is based on feedback from the 
connector. 
Every 5 seconds, the connector should send a JSON-formatted message through WebSockets 
notifying how many events it received. 
Message body format 
bodyText = {"session_id":&lt;session_id&gt;,"event_recieved":&lt;number_of_events_recieved&gt;} 
For example: 
bodyText = {"session_id":"MQLHHAQF","event_recieved":238} 
 
If there is a difference of more than 10,000 events, the CIS closes the web socket connection with 
the following notification: 
{ "message" , "connector_rate" } ,  
{ "error" , "connector_not_fast_enough"}</p><p>CCSP APIs Guide - 7.4 
60 
Code snapshot 
var getEventsRequest = new OrderedDictionary(); 
getEventsRequest["session_id"] = data.session_id; 
getEventsRequest["event_recieved"] = NumberOfSamples; 
 
var postGetEventsJson = JsonConvert.SerializeObject(getEventsRequest); 
ws.Send(String.Format("{0}", postGetEventsJson)); 
Example of message being sent using WebSockets 
bodyText = {"session_id":"MQLHHAQF","event_recieved":238} 
Example of error message sent from CIS 
If the messages are not being processed fast enough, the CIS terminates the session and sends the 
following notifiication: 
{ "message" , "connector_rate" } ,  
{ "error" , "connector_not_fast_enough"} 
Receive messages 
After connecting successfully to the CIS using the HTTP and WebSocket connections, and issuing a 
succesful GET_EVENT REQUEST, the CIS starts sending message for the requested tenant, groups, 
event type, and event mask. 
 
  "session_id": "W3EPLM9R", 
  "event_provider": "VCS,11", 
  "correlation_id": 7, 
  "message": { 
    "message": "cs_call_arrival", 
    "queue_id": 1, 
    "queue_name": "DefaultQueue", 
    "connection_server_id": 11, 
    "tenant_id": 0, 
    "acount_id": 0, 
    "routing_priority": 0, 
    "call_id": 2236360475703377931, 
    "ipc_source_address": "VCS,11", 
    "ipc_dst_address": "VCS,11", 
    "optional_parameters": [</p><p>CCSP APIs Guide - 7.4 
61 
      { 
        "Item1": "parameter_name", 
        "Item2": "APPselector_RuleMatch" 
      }, 
      { 
        "Item1": "parameter_value", 
        "Item2": "TRUE with AppID: 1" 
      }, 
      { 
        "Item1": "parameter_name", 
        "Item2": "XMLInterpreter_lineid" 
      }, 
      { 
        "Item1": "parameter_value", 
        "Item2": "3" 
      }, 
      { 
        "Item1": "parameter_name", 
        "Item2": "XMLInterpreter_trunkid" 
      }, 
      { 
        "Item1": "parameter_value", 
        "Item2": "0" 
      } 
    ] 
  } 
} 
Stop events 
To stop getting events, the connector must issue an HTTP POST message to cis\stopevents.</p><p>CCSP APIs Guide - 7.4 
62 
Request body format 
bodyText = {"session_id":&lt;session_Id&gt;,"correlation_id":&lt;correlation id&gt;} 
For example: 
bodyText = {"session_id":"87HL4HAL","correlation_id":3} 
 
The following table describes the parameters. 
Parameter name 
Type 
Mandatory 
session_id 
String 
Yes 
correlation_id 
int 
Yes 
Code snapshot 
var stopEventsRequest = new OrderedDictionary(); 
stopEventsRequest["session_id"] = getEventsData.session_id; 
stopEventsRequest["correlation_id"] = getEventsData.correlation_id; 
 
var postStopEventsJson = JsonConvert.SerializeObject(stopEventsRequest); 
 
var postStopEventsString = new StringContent(postStopEventsJson, new 
UTF8Encoding(), "application/json"); 
 
response = client.PostAsync("http://10.120.30.71:8088/cis/stopevents", 
postStopEventsString).Result; 
 
stringContent = response.Content.ReadAsStringAsync().Result; 
 
Console.WriteLine("{0}", stringContent); 
Example of HTTP POST Message being sent 
bodyText = {"session_id":"90H4RTUL","correlation_id":13}</p><p>CCSP APIs Guide - 7.4 
63 
Example of HTTP Response Message being received 
  "session_id": "90H4RTUL", 
  "message": "$stop_events$", 
  "reason": "user request", 
  "correlation_id": 13 
} 
… 
{ 
  "msg": "stopevents", 
  "reason": "user request", 
  "session_id": "90H4RTUL", 
  "correlation_id": 13 
} 
Log out 
To log out the user, the connector must issue an HTTP POST message to cis\logout. 
Request body format 
bodyText = {"session_id":&lt;session_id&gt;} 
For example: 
bodyText = {"session_id":"MJL12VBK"} 
 
The following table describes the parameter. 
Parameter name 
Type 
Mandatory 
session_id 
String 
Yes 
Code snapshot 
var logoutRequest = new OrderedDictionary(); 
logoutRequest["session_id"] = getEventsData.session_id; 
 
var logoutJson = JsonConvert.SerializeObject(logoutRequest); 
var postLogoutString = new StringContent(logoutJson, new UTF8Encoding(), 
"application/json");</p><p>CCSP APIs Guide - 7.4 
64 
response = client.PostAsync("http://10.120.30.71:8088/cis/logout", 
postLogoutString).Result; 
 
stringContent = response.Content.ReadAsStringAsync().Result; 
 
Console.WriteLine("{0}", stringContent); 
Example of HTTP POST Message being sent 
bodyText = {"session_id":"MJL12VBK"} 
Example of HTTP POST Message being received 
{ 
  "result": "success", 
  "reason": "user logout", 
  "session": " MJL12VBK " 
} 
Add events to CISEvents.xml 
CISEvents.xml is a list of messages (events) that CIS supports and is located under Server 
Components\Configuration. 
In case of verification, the CIS serializes the CIS_EVENT embedded message and forwards it to the 
web session. 
The communication between the CIS and the connector is in JSON format. 
Structure of CISEvents.xml 
CISEvents.xml contains the list of messages and FIDS that CIS will transfer to the web sessions. The 
default CISEvents.xml file appears as follows: 
 
&lt;CISEvents&gt; 
  &lt;IPCMessage type="CS_SCRIPTCOMPLETED" jsonname="script_completed"&gt; 
    &lt;Field fid="FID_CALLID" jsonname="call_id" /&gt; 
    &lt;Field fid="FID_TENANT_ID" jsonname="tenant_id" /&gt; 
    &lt;Field fid="FID_EVENTID" jsonname="event_id" /&gt; 
    &lt;Field fid="ERROR_STATUS" jsonname="error_status" /&gt; 
    &lt;Field fid="IPC_SOURCE_ADDRESS" jsonname="ipc_source_address" /&gt; 
    &lt;Field fid="IPC_DESTINATION_ADDRESS" jsonname="ipc_dst_address" /&gt; 
  &lt;/IPCMessage&gt;</p><p>CCSP APIs Guide - 7.4 
65 
  &lt;IPCMessage type="CS_ACKCALLARRIVAL" jsonname="ack_callarrival"&gt; 
    &lt;Field fid="FID_CALLID" jsonname="call_id" /&gt; 
    &lt;Field fid="FID_TENANT_ID" jsonname="tenant_id" /&gt; 
    &lt;Field fid="IPC_SOURCE_ADDRESS" jsonname="ipc_source_address" /&gt; 
    &lt;Field fid="IPC_DESTINATION_ADDRESS" jsonname="ipc_dst_address" /&gt; 
  &lt;/IPCMessage&gt; 
  &lt;IPCMessage type="AGENT_RING" jsonname="agent_ring"&gt; 
    &lt;Field fid="FID_CALLID" jsonname="call_id" /&gt; 
    &lt;Field fid="FID_TENANT_ID" jsonname="tenant_id" /&gt; 
    &lt;Field fid="AGENT_GLOBAL_ID"  jsonname="agent_global_id"/&gt; 
    &lt;Field fid="AGENT_IPC_CONTROL_ADDRESS" jsonname="agent_ais_id"/&gt; 
    &lt;Field fid="AGENT_PERSONID" jsonname="agent_person_id"/&gt; 
    &lt;Field fid="AGENT_GROUP_GLOBAL_ID" jsonname="agent_group_id"/&gt; 
    &lt;Field fid="FID_ISCIRCUITSWITCHED" jsonname="is_curcuit_switched"/&gt; 
    &lt;Field fid="FID_AGENT_FIRST_NAME" jsonname="agent_first_name"/&gt; 
    &lt;Field fid="FID_AGENT_LAST_NAME" jsonname="agent_last_name"/&gt; 
    &lt;Field fid="FID_COUNTRYCODE" jsonname="agent_country_code"/&gt; 
    &lt;Field fid="FID_AREACODE" jsonname="agent_country_code"/&gt; 
    &lt;Field fid="FID_RECORDING" jsonname="recording_enabled"/&gt; 
    &lt;Field fid="FID_SELECTIVE_RECORDING" jsonname="selective_enabled"/&gt; 
    &lt;Field fid="FID_SHOW_RECORDING" jsonname="show_recording"/&gt; 
    &lt;Field fid="FID_SCREEN_RECORDING" jsonname="screen_recording"/&gt; 
    &lt;Field fid="FID_TRANSFER_RECORDING" jsonname="transfer_recording"/&gt; 
    &lt;Field fid="IPC_SOURCE_ADDRESS" jsonname="ipc_source_address" /&gt; 
    &lt;Field fid="IPC_DESTINATION_ADDRESS" jsonname="ipc_dst_address" /&gt; 
  &lt;/IPCMessage&gt; 
&lt;/CISEvents&gt; 
 
The file structure is as follows: 
• 
The xml file starts with “&lt;CISEvents&gt;“and ends with“ &lt;/CISEvents&gt;“. 
• 
Every IPC message starts with “&lt;IPCMessage&gt;“and ends with “&lt;/IPCMessage&gt;“. 
• 
jsonName is the name of the fid that will be presented by the connector.  
• 
The fid should be the same as the fid in the message: capital letters and underscores.</p><p>CCSP APIs Guide - 7.4 
66 
Add events 
Caution 
If CISEvents.xml is not configured correctly, CIS will not start. 
 
When adding events: 
• 
Every IPC message must start with “&lt;/IPCMessage&gt;“and end with “&lt;/IPCMessage&gt;“. 
• 
Every fid and message type must have jsonName. 
• 
Copy the message type and relevant fids from the message.  
• 
The message type must start with “&lt;IPCMessage type=“and end with “&gt;“.  
For example agent ring: 
&lt;IPCMessage type="AGENT_RING" jsonname="agent_ring"&gt; 
• 
The Field fid must start with “ &lt;Field fid= “ and end with “ /&gt;“.  
For example fid IPC_DESTINATION_ADDRESS: 
&lt;Field fid="IPC_DESTINATION_ADDRESS" jsonname="ipc_dst_address" /&gt; 
 
The following example shows supporting messages that you can see in the login acceptance. 
 
STATUS =200 
---- 
{ 
  "session_id": "LXU9GFL2", 
  "message": "http_login_request", 
  "result": "success", 
  "login_time": "2015-08-17T09:17:32.2390972Z", 
  "tenant_id": 0, 
  "agent_global_id": 2283010091194515456, 
  "assigned_tenants": [ 
    -1 
  ], 
  "event_providers": [ 
    "VCS,26", 
    "DPS,27" 
  ], 
  "supported_messages": { 
    "4171": "CIS_SNAPSHOT_INFO", 
    "4173": "CIS_GET_EVENT_INFO", 
    "164": "CS_CALL_OFFERED", 
    "47": "CS_CALLOUT",</p><p>CCSP APIs Guide - 7.4 
67 
    "48": "CS_ACK_CALLOUT", 
    "49": "CS_NACK_CALLOUT", 
    "3": "CS_CALLARRIVAL", 
    "5": "CS_SCRIPTCOMPLETED", 
    "4": "CS_ACKCALLARRIVAL", 
    "28": "AGENT_RING", 
    "8": "CS_PICKUPCALL", 
    "120": "CS_AGENTCONNECTED", 
    "37": "CS_NACKPICKUPCALL", 
    "9": "CS_ACKCALLPICKUP", 
    "327": "CS_LOG_MediaData_VCS", 
    "325": "CS_CALL_TERMINATED", 
    "721": "DPS_AGENT_MEDIA_CONNECT", 
    "43": "CS_HANGUP", 
    "16": "AGENT_LOGON", 
    "17": "AGENT_LOGOFF", 
    "20": "AGENT_UNAVAILABLE", 
    "21": "AGENT_AVAILABLE", 
    "106": "AGENT_STATE_CHANGE", 
    "377": "CS_CONFERENCE_CALLS", 
    "616": "CS_CONFERENCE_CALLID_INFO" 
  }, 
  "https_enabled": false, 
  "http_ip": "10.120.31.136", 
  "http_port": 8088, 
  "https_ip": "10.120.31.136", 
  "https_port": 8443, 
  "web_socket_ip": "10.120.31.136", 
  "web_socket_port": 8089, 
  "web_socket_secure_ip": "10.120.31.136", 
  "web_socket_secure_port": 8431 
}</p><p>CCSP APIs Guide - 7.4 
68 
8: CCSP Realtime API 
This chapter describes the XML interfaces used to integrate with real-time reports. 
The Realtime API consists of filters used to extract the XML documents from the RTR ISAPI DLL 
(rtrweb.dll). These filters are: 
• 
ACalls − agent statistics and states data 
• 
ACallsDetails − agent statistics and calls data 
• 
QCalls − queue statistics data 
• 
AConfigs − agent configuration 
• 
CConfigs − campaign configuration 
• 
GConfigs − group configuration 
• 
QConfigs − queue configuration 
• 
QHistory − queue statistics historical data (previous 24 hours) 
• 
SServer − Statistics server snapshot data (used for debugging)  
 
Queue and agent filtering filters queue and agent items in accordance with a defined list on the 
RTR server side. The filter list is per RTR Dll (server) instance. 
The Permission Profile filters returned results in accordance with the list of allowed items. 
To extract XML documents for some or all of the filters, with the exception of SServer filter, 
separate the filters with the plus (+) sign. For example, to get data for QConfigs and AConfigs filters, 
use:  
http://localhost/rtrdll/rtrweb.dll?tenant=tnt0&amp;Filter=qconfigs+aconfigs 
Note 
The filter and query attributes are not case sensitive. 
 
From CCSP 7.3, the query interface can include a list of agents, groups, teams, queues and media 
types that should be included in the response. Each attribute can specify a comma separated list of 
IDs. 
The additional query parameters are:  
• 
AgentId  
• 
GroupId  
• 
TeamId  
• 
QueueId  
• 
MediaType  
 
For the AConfigs, ACalls and ACallsDetails filters, you can use the three selection attributes that 
relate to agents, which are AgentId, GroupId and TeamId.</p><p>CCSP APIs Guide - 7.4 
69 
The following example will return a list of agents in groups 1 and 2, and also agents from team 3 
(even if they are not in group 1 or 2).  
http://localhost/rtrdll/rtrweb.dll?Filter=ACalls&amp;GroupId=1,2&amp;TeamId=3 
For the GConfigs filter, you can use the GroupId attribute. 
For the QConfigs filter, you can use the QueueId attribute. 
For the QCalls and QHistory filters, you can use the two selection attributes, QueueId and 
MediaType.  
The QCalls filter limits the output of the queues requested, and can also limit the output of the 
breakdown of media types.  
The media types are: 
• 
0 = Chat  
• 
2 = Email  
• 
3 = Phone  
• 
4 = Callback  
• 
5 = Voicemail 
 
To excude all breakdown of media type, use the value 99. 
The following example shows how to limit the response to queues 10 and 11, and also limit the 
breakdown of media types to just email (type 2) and phone (type 3): 
http://localhost/rtrdll/rtrweb.dll?Filter=QCalls&amp;QueueId=10,11&amp;MediaType=2,3 
 
The following example shows how to excude all breakdown of media type:  
http://localhost/rtrdll/rtrweb.dll?Filter=QHistory&amp;MediaType=99</p><p>CCSP APIs Guide - 7.4 
70 
ACalls 
Note 
• 
The average talk time attributes (inatt, outatt, a2att, and tatt) do not include hold time. 
• 
The average duration attributes (ad, adchat, admail, advoip, advm, and adcb) include all the 
states of the call (preview, ringing, active, hold, and wrap). 
• 
ACallsDetails is a copy of ACalls with additional elements, and some changes. We recommend 
that you move to ACallsDetails because ACalls will be deprecated.  
 
The ACalls filter shows agent state and calls state handled by the agent filtered in accordance with 
the profile. If the supervisor is a tenant-wide supervisor or a landlord, the ACalls filter returns all the 
agents configured for the specified tenant. 
Usage 
 http://&lt;ServerName&gt;/realtimereports/rtrweb.dll? Tenant=&lt;TenantName&gt; 
&amp;Filter=ACalls[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get statistics for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS. 
Example 
http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=ACalls&amp;Username=ekeselman 
 
&lt;ACalls ts="Thu Jan 24 10:57:30 2019 UTC" cts="Thu Jan 24 10:57:27 2019 UTC" 
tzo="-3600" al="false"&gt; 
  &lt;A id="11" tp="28" ldc="28" tl="88764" as="10" cc="2" all="2" aics="6,2;"  
     cid="0" at="88053" gid="6" dir="9" cct="6" cq="[Multiple]" inatt="35"  
     outatt="0" a2aatt="0" tatt="35" ad="49" adchat="0" admail="0"  
     advoip="49" advm="0" adcb="0"/&gt; 
  &lt;A id="3011" tp="158454" ctp="158434" ldc="158454" tl="179114" as="10"  
     cc="1" all="100" aics="5,1;" cid="0" at="179102" gid="6" dir="1"  
     cct="3" cq="DefaultQueue" inatt="0" outatt="0" a2aatt="0" tatt="0"  
     ad="0" adchat="0" admail="0" advoip="0" advm="0" adcb="0"/&gt; 
&lt;/ACalls&gt;</p><p>CCSP APIs Guide - 7.4 
71 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
ACalls  
Element  
This is the top level element and exists once in this document.  
al  
Attribute  
Agent limitation attribute that indicates whether the RTR view is 
filtered or not. False means that the logged in agent/supervisor is 
tenant-wide or landlord and does not have a profile. True means 
the user has a profile.  
cts  
Attribute  
Timestamp of the last configuration update received by the RTR 
web server, in UTC (Universal Time Coordinated)/GMT (Greenwich 
Mean Time).  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
A  
Element  
There is one 'A' element for each agent that has had active 
calls this hour.  
a2aatt 
Attribute 
Agent-to-agent average talk time. 
ad 
Attribute 
Average duration of all media types. 
adchat 
Attribute 
Average duration of chat calls. 
admail 
Attribute 
Average duration of email calls. 
advoip 
Attribute 
Average duration of VoIP calls. 
advm 
Attribute 
Average duration of acd voicemail calls. 
adcb 
Attribute 
Average duration of callbacks. 
aics 
Attribute 
Agent in call state. List showing each state and number of calls in 
this state. Possible values are: 
5 – Wrapup  
6 − InCall  
7 − Ringing  
8 − Preview  
9 − OnHold 
all 
Attribute 
Agent load level. The sum of the weights of all the calls the agent 
is handling.</p><p>CCSP APIs Guide - 7.4 
72 
Name 
Type  
Description 
as  
Attribute  
Agent state. Possible values are:  
3 − Available  
4 − Unavailable 
10 – Available in call 
11 – Unavailable in call 
at 
Attribute 
Available time. How long the agent has been in the Available state. 
Includes Available and Available in call. 
cc 
Attribute 
Call count. The number of calls the agent is currently handling. 
cct  
Attribute  
Current call type. This value is actually the media stream type. 
Possible values are:  
0 − Chat  
2 − Email  
3 – VoIP 
4 − Callback 
5 – Voicemail 
6 – Multiple calls 
cid 
Attribute 
The dialer campaign ID of the agent (Campaign_ID in the 
database). If not logged into a campaign, this value is 0. 
cq  
Attribute  
Current queue. If handling calls from different queues, [Multiple] 
appears. 
ctp 
Attribute 
Call time published. 
If call is active, ctp is the number of seconds since the call first 
became active. 
If call is ringing, on hold, or in wrapup, ctp is the number of 
seconds in that call state. 
Note 
This attribute exists only if the agent is handling a single call.</p><p>CCSP APIs Guide - 7.4 
73 
Name 
Type  
Description 
dir  
Attribute  
Call direction. Possible values are: 
0 − Out 
1 − In 
2 − A2A 
3 − Bridged 
4 − CallbackRequest 
5 − CallbackResponse 
6 − CallOutTypePDS 
7 − CallOutTypePPDS 
8 – CallOutTypeElsbeth 
9 – Multiple calls 
gid  
Attribute  
Group ID (Group_ID in the database). 
id  
Attribute  
Agent ID (Person_ID in the database).  
inatt 
Attribute 
Inbound average talk time. 
outatt 
Attribute 
Outbound average talk time. 
rc  
Attribute  
Release code used for agent released state. For example, if the 
agent selects "Coffee" as their released state, the release code 
"Coffee" is listed in parentheses next to Released as "Released 
(Coffee)."  
Note 
This attribute only appears when the agent is in the released state 
and has chosen a release code. 
tatt 
Attribute 
Total average talk time. 
tl 
Attribute 
Time logged in. The number of seconds that the agent has been 
logged in. 
tp  
Attribute  
Time published. The number of seconds since the agent state 
changed. This is the time in the agent state (as attribute). 
trc 
Attribute 
Time in release code. 
Note 
This attribute only appears when the agent is in the released state 
and has chosen a release code.</p><p>CCSP APIs Guide - 7.4 
74 
ACallsDetails 
Note 
• 
The average talk time attributes (inatt, outatt, a2att, and tatt) do not include hold time. 
• 
The average duration attributes (ad, adchat, admail, advoip, advm, and adcb) include all the 
states of the call (preview, ringing, active, hold, and wrap). 
• 
ACallsDetails is a copy of ACalls with additional elements, and some changes. We recommend 
that you move to ACallsDetails because ACalls will be deprecated. 
 
The ACallsDetails filter shows agent state and calls state handled by the agent filtered in 
accordance with the profile. If the supervisor is a tenant-wide supervisor or a landlord, the ACalls 
filter returns all the agents configured for the specified tenant. 
Usage 
 http://&lt;ServerName&gt;/realtimereports/rtrweb.dll? Tenant=&lt;TenantName&gt; 
&amp;Filter=ACallsDetails[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get statistics for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS.</p><p>CCSP APIs Guide - 7.4 
75 
Example 
http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=ACallsDetails&amp;Username=ekeselman 
 
&lt;ACallsDetails ts="Thu Jan 24 10:58:36 2019 UTC" cts="Thu Jan 24 10:57:27 2019 
UTC" tzo="-3600" al="false"&gt; 
  &lt;A id="11" tp="94" ldc="94" tl="88830" as="10" cc="2" all="2" cid="0"  
     at="88119" gid="6" inatt="35" outatt="0" a2aatt="0" tatt="35" ad="49"  
     adchat="0" admail="0" advoip="49" advm="0" adcb="0"&gt; 
     &lt;C ctp="95" ct="1" mt="0" cq="DefaultQueue" cs="6" tcs="95"  
        cid="2758136424493613063"/&gt; 
     &lt;C ctp="88" ct="1" mt="3" cq="DefaultQueue" cs="6" tcs="88" 
        cid="2758136441674661901"/&gt; 
  &lt;/A&gt; 
  &lt;A id="3011" tp="158520" ldc="158520" tl="179180" as="10" cc="1" all="100"  
     cid="0" at="179168" gid="6" inatt="0" outatt="0" a2aatt="0" tatt="0"  
     ad="0" adchat="0" admail="0" advoip="0" advm="0" adcb="0"&gt; 
     &lt;C ctp="158522" ct="1" mt="3" cq="DefaultQueue" cs="5" tcs="158501"  
        cid="2758136441673482253"/&gt; 
  &lt;/A&gt; 
&lt;/ACallsDetails&gt;</p><p>CCSP APIs Guide - 7.4 
76 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
ACallsDetails  
Element  
This is the top level element and exists once in this 
document.  
al  
Attribute  
Agent limitation attribute that indicates whether the RTR view 
is filtered or not. False means that the logged in 
agent/supervisor is tenant-wide or landlord and does not 
have a profile. True means the user has a profile.  
cts  
Attribute  
Timestamp of the last configuration update received by the 
RTR web server, in UTC (Universal Time Coordinated)/GMT 
(Greenwich Mean Time).  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
A  
Element  
There is one 'A' element for each agent that has had 
active calls this hour.  
a2aatt 
Attribute 
Agent-to-agent average talk time. 
ad 
Attribute 
Average duration of all media types. 
adchat 
Attribute 
Average duration of chat calls. 
admail 
Attribute 
Average duration of email calls. 
advoip 
Attribute 
Average duration of VoIP calls. 
advm 
Attribute 
Average duration of acd voicemail calls. 
adcb 
Attribute 
Average duration of callbacks. 
all 
Attribute 
Agent load level. The sum of the weights of all the calls the 
agent is handling. 
as  
Attribute  
Agent state. Possible values are:  
3 − Available  
4 − Unavailable 
10 – Available in call 
11 – Unavailable in call</p><p>CCSP APIs Guide - 7.4 
77 
Name 
Type  
Description 
at 
Attribute 
Available time. How long the agent has been in the Available 
state. Includes Available and Available in call. 
cc 
Attribute 
Call count. The number of calls the agent is currently 
handling. 
gid  
Attribute  
Group ID (Group_ID in the database). 
inatt 
Attribute 
Inbound average talk time. 
outatt 
Attribute 
Outbound average talk time. 
rc  
Attribute  
Release code used for agent released state. For example, if 
the agent selects "Coffee" as their released state, the release 
code "Coffee" is listed in parentheses next to Released as 
"Released (Coffee)."  
Note 
This attribute only appears when the agent is in the released 
state and has chosen a release code. 
tatt 
Attribute 
Total average talk time. 
tl 
Attribute 
Time logged in. The number of seconds that the agent has 
been logged in. 
tp  
Attribute  
Time published. The number of seconds since the agent state 
changed. This is the time in the agent state (as attribute). 
trc 
Attribute 
Time in release code. 
Note 
This attribute only appears when the agent is in the released 
state and has chosen a release code. 
C  
Element  
There is one 'C' element for each call that the agent has.  
cq  
Attribute  
Call queue name.</p><p>CCSP APIs Guide - 7.4 
78 
Name 
Type  
Description 
ct  
Attribute 
Call type. Possible values are: 
0 − Out 
1 − In 
2 − A2A 
3 − Bridged 
4 − CallbackRequest 
5 − CallbackResponse 
6 − CallOutTypePDS 
7 − CallOutTypePPDS 
8 − CallOutTypeElsbeth 
ctp 
Attribute 
Call time published. 
If call is active, ctp is the number of seconds since the call first 
became active. 
If call is ringing, on hold, or in wrapup, ctp is the number of 
seconds in that call state. 
mt  
Attribute  
Media type. Possible values are:  
0 − Chat  
2 − Email  
3 – VoIP 
4 – Callback 
5 – Voicemail 
cs 
 
Call state. Possible values are: 
5 − Wrapup 
6 − Active 
7 − Ringing 
8 − Preview  
9 − OnHold 
cid 
Attribute 
Call ID (Call_ID in the database). 
tcs 
Attribute 
Time in call duration. The number of seconds since the call 
was first answered. Includes wrapup and onhold time.</p><p>CCSP APIs Guide - 7.4 
79 
QCalls 
Note 
After StatisticServer failover, only the following queue counters are recovered: 
• 
Being Handled 
• 
Handled (only for calls currently in the system) 
• 
Offered (the recovered counter includes the Overflowed In counter values before the 
failover) 
• 
WaitingInQueue 
The counters are recovered only for the calls currently in the system that are not in their 
termination phase. All recovered counters are placed in the current hour slot. Counter recovery 
covers all the connection servers for all tenants. 
 
The QCalls filter displays queue statistics for the current hour in accordance with the profile. At the 
start of each hour, these counters are reset. If the supervisor is a tenant-wide supervisor or a 
landlord, the QCalls filter returns queue statistics for all the queues configured for the specified 
tenant. 
The only limitation is that the queue must have at least one call received in its lifetime otherwise no 
entry will be returned. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll? Tenant=&lt;TenantName&gt; 
&amp;Filter=QCalls[DEV:&amp;Username=&lt;UserName&gt;] 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get statistics for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS.</p><p>CCSP APIs Guide - 7.4 
80 
Example 
 http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=QCalls&amp;Username=ekeselman 
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;  
&lt;QCalls ts="Wed Jul 10 12:33:30 2019 UTC" cts="Wed Jul 10 11:34:28 2019 UTC"  
  tzo="-10800" al="false"&gt; 
  &lt;Q id="2" n="q1" wt="0" ch="2" cwt="920" co="2" cw="0" awt="0" act="5"  
    cbh="0" pfd="1" pfm="1" def="1" cwc="1" tct="5" twt="920"&gt; 
    &lt;internet id="2" n="q1" /&gt;  
    &lt;message id="2" n="q1" wt="0" ch="2" cwt="920" co="2" cw="0" awt="0"  
      act="5" cbh="0" pfd="1" pfm="1" def="1" cwc="1" tct="5" twt="920" /&gt;  
    &lt;phone id="2" n="q1" /&gt;  
    &lt;callback id="2" n="q1" /&gt;  
    &lt;voicemail id="2" n="q1" /&gt;  
  &lt;/Q&gt; 
&lt;/QCalls&gt; 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
QCalls  
Element  
This is the top level element and exists one time in this 
document.  
al  
Attribute  
Agent limitation attribute that indicates whether the RTR view is 
filtered or not. False means that the logged in agent/supervisor is 
tenant-wide or landlord and does not have a profile. True means 
the user has a profile.  
cts  
Attribute  
Timestamp of the last configuration update received by the RTR 
web server, in UTC (Universal Time Coordinated)/GMT (Greenwich 
Mean Time).  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
Q  
Element  
There is one 'Q' element for each queue that has had active 
calls this hour.</p><p>CCSP APIs Guide - 7.4 
81 
Name 
Type  
Description 
act 
Attribute 
Note 
Average call time is now calculated in the CCSP Dashboard client. 
This legacy attribute is inaccurate. 
awt 
Attribute 
Note 
Average wait time is now calculated in the CCSP Dashboard client. 
This legacy attribute is inaccurate. 
avlt  
Attribute  
Cumulative available time of the agents assigned to the campaign 
associated with this queue.  
ca  
Attribute  
Number of calls abandoned.  
catqos 
Attribute 
Calls abandoned within the target quality of service (TQOS). 
ch  
Attribute  
Number of calls handled. This does not include calls being 
handled - not completed.  
cbh  
Attribute  
Number of calls currently being handled (in call) by an agent.  
co  
Attribute  
Number of calls offered.  
cr 
Attribute 
Calls rejected. 
ct  
Attribute  
Number of calls handled and being handled within the TQOS 
threshold.  
cw  
Attribute  
Number of calls currently waiting in queue.  
cwc 
Attribute 
Cumulative waiting calls. The number of calls that waited in the 
queue to be handled. 
cwt  
Attribute  
Cumulative wait time, in seconds. This can be used to calculate the 
average wait time by dividing by calls handled ("ch").  
def 
Attribute 
Counts number of deferred emails within an hour. 
disp  
Attribute  
Number of calls delivered to the agents.  
dlro  
Attribute  
Number of calls terminated with dialer outcome code.  
id  
Attribute  
Queue ID (Queue_ID in the database).  
n  
Attribute  
Queue name.  
ofi  
Attribute  
Number of calls overflowed into this queue.  
ofo  
Attribute  
Number of calls overflowed out of this queue.</p><p>CCSP APIs Guide - 7.4 
82 
Name 
Type  
Description 
rnt  
Attribute  
Campaign run time.  
pfd 
Attribute 
Counts number of items pulled from defer. 
pfm 
Attribute 
Counts number of queued items pulled from public. 
pfu 
Attribute 
Counts number of unqueued items pulled from public. 
stt  
Attribute  
Campaign start time.  
tct 
Attribute 
Total call time. The sum of talk time in the queue. 
tlkt  
Attribute  
Cumulative talk time of the agents assigned to the campaign 
associated with this queue.  
twt 
Attribute 
Total wait time, in seconds. The sum of wait time for all calls in the 
queue that waited to be handled. 
Note 
Average wait time is calculated as twt/cwc. 
wrpt  
Attribute  
Cumulative wrap-up time of the agents assigned to the campaign 
associated with this queue.  
wt  
Attribute  
Longest wait time, in seconds.  
D  
Element  
There is one 'D' element for each disposition code reported by 
an agent.  
cnt  
Attribute  
Number of calls with this disposition code.  
id  
Attribute  
Disposition code ID (DispositionCode_ID in the database).  
tlkt  
Attribute  
Cumulative talk time for the calls with this disposition code.  
O  
Element  
There is one 'O' element for each outcome code reported by 
an agent.  
cnt  
Attribute  
Number of calls with this dialer outcome.  
id  
Attribute  
Dialer outcome code ID.</p><p>CCSP APIs Guide - 7.4 
83 
AConfigs 
The AConfigs filter displays a list of agents in accordance with the profile. If the supervisor is a 
tenant-wide supervisor or a landlord, the AConfigs filter returns all the agents configured for the 
specified tenant. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll? Tenant=&lt;TenantName&gt; 
&amp;Filter=AConfigs[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get stats for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS.</p><p>CCSP APIs Guide - 7.4 
84 
Example 
http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=AConfigs&amp;Username=ekeselman 
 
&lt;AConfigs ts="Thu Jan 24 10:05:33 2019 UTC" tzo="-3600" al="false" 
smtpserver="localhost" loginid="13"&gt; 
   &lt;A id="10" fn="admin" ln="admin" desc="" un="admin" sk="" tm="" 
ipn="Default Profile" bic="False" bldc="False" blc="False" bc="" isag="True" 
isad="True" issu="True"&gt; 
      &lt;G id="-1"/&gt; 
   &lt;/A&gt; 
   &lt;A id="11" fn="Agent" ln="One" desc="" un="agent1" sk="DefaultSkill" 
tm="TeamA" ipn="Default Profile" bic="False" bldc="False" blc="False" bc="" 
isag="True" isad="False" issu="False"&gt; 
      &lt;G id="6" n="DefaultGroup"/&gt; 
   &lt;/A&gt; 
   &lt;A id="12" fn="Agent" ln="Two" desc="" un="agent2" sk="DefaultSkill" 
tm="TeamB" ipn="Default Profile" bic="False" bldc="False" blc="False" bc="" 
isag="True" isad="False" issu="False"&gt; 
      &lt;G id="2011" n="Group2"/&gt; 
   &lt;/A&gt; 
   &lt;A id="13" fn="Supervisor" ln="One" desc="" un="super1" sk="DefaultSkill" 
tm="TeamA" ipn="Default Profile" bic="False" bldc="False" blc="False" bc="" 
isag="True" isad="False" issu="True"&gt; 
      &lt;G id="6" n="DefaultGroup"/&gt; 
   &lt;/A&gt; 
&lt;/AConfigs&gt;</p><p>CCSP APIs Guide - 7.4 
85 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
AConfigs  
Element  
This is the top level element and exists once in this 
document.  
al  
Attribute  
Agent limitation attribute indicates whether the RTR view is 
filtered or not. False means that the logged in agent/supervisor is 
tenant-wide or landlord and does not have a profile. True means 
the user has a profile.  
loginid 
Attribute 
User ID of the person accessing the RTR web service. 
smtpserver 
Attribute 
CosmoDashboard SMTP Server parameter defined in the Tenant 
Properties. 
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
A  
Element  
There is one 'A' element for each agent defined for this 
tenant.  
bc  
Attribute  
Agent's block codes. Multiple block codes are separated by 
commas.  
bic  
Attribute  
Block international calls flag. If it is set to '1', the agent is blocked 
from making international calls.  
blc  
Attribute  
Block local calls flag. If it is set to '1', the agent is blocked from 
making local calls.  
bldc  
Attribute  
Block long distance calls flag. If it is set to '1', the agent is blocked 
from making long distance calls.  
desc  
Attribute  
Agent's description.  
fn  
Attribute  
Agent's first name.  
id  
Attribute  
Agent ID (Person_ID in the database). 
ipn 
Attribute 
Interaction profile name. 
isad  
Attribute  
CCSP administrator flag. If set to '1' then this agent is a CCSP 
administrator.</p><p>CCSP APIs Guide - 7.4 
86 
Name 
Type  
Description 
isag  
Attribute  
CCSP agent flag. If set to '1' then this agent is a CCSP agent.  
issu  
Attribute  
CCSP supervisor flag. If set to '1' then this agent is a CCSP 
supervisor.  
ln  
Attribute  
Agent's last name.  
sk  
Attribute  
Agent's skills. Multiple skills are separated by commas.  
tm  
Attribute  
Agent's teams. Multiple teams are separated by commas.  
un  
Attribute  
Agent's Windows username.  
G  
Element  
The group that this agent is assigned to.  
id  
Attribute  
Group ID (Group_ID in the database).  
n  
Attribute  
Group name.</p><p>CCSP APIs Guide - 7.4 
87 
CConfigs 
The CConfigs filter displays a list of campaigns in accordance with the profile. If the supervisor is a 
tenant-wide supervisor or a landlord, the CConfigs filter returns all the campaigns configured for 
the specified tenant. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll?Tenant=&lt;TenantName&gt; 
&amp;Filter=CConfigs[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get statistics for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS. 
Example 
http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=CConfigs&amp;Username=ekeselman 
 
&lt;?xml version="1.0" encoding="UTF-8" ?&gt; 
&lt;CConfigs ts="Wed Jul 31 13:51:25 2013 UTC" tzo="14400" al="false"&gt; 
 
&lt;C id="1" n="Campaign1" desc=""&gt; 
 
 
&lt;Q id="2" n="Queue1" /&gt; 
 
 
&lt;G id="1" n="DefaultGroup" /&gt; 
 
&lt;/C&gt; 
 
&lt;C id="2" n="Campaign2" desc=""&gt; 
 
 
&lt;Q id="1" n="DefaultQueue" /&gt; 
 
 
&lt;G id="2" n="Group1" /&gt; 
 
&lt;/C&gt; 
 
&lt;C id="3" n="CampaignDefault" desc=""&gt; 
 
 
&lt;Q id="1" n="DefaultQueue" /&gt; 
 
 
&lt;G id="2" n="Group1" /&gt; 
 
&lt;/C&gt; 
&lt;/CConfigs&gt;</p><p>CCSP APIs Guide - 7.4 
88 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
CConfigs  
Element  
This is the top level element and exists one time in this 
document.  
al  
Attribute  
Agent limitation attribute indicates whether the RTR view is 
filtered or not. False means that the logged in agent/supervisor is 
tenant-wide or landlord and does not have a profile. True means 
the user has a profile.  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
C  
Element  
There is one 'C' element for each campaign defined for this 
tenant.  
id  
Attribute  
Campaign ID (Campaign_ID in the database).  
n  
Attribute  
Campaign name.  
desc  
Attribute  
Campaign description.  
G  
Element  
There is one 'G' element for the group assigned to this 
campaign.  
id  
Attribute  
Group ID (Group_ID in the database). 
n  
Attribute  
Group name.  
Q  
Element  
There is one 'Q' element for the queue assigned to this 
campaign.  
id  
Attribute  
Queue ID (Queue_ID in the database).  
n  
Attribute  
Queue name.</p><p>CCSP APIs Guide - 7.4 
89 
GConfigs 
The GConfigs filter displays a list of agent groups in accordance with the profile. If the supervisor is 
a tenant-wide supervisor or landlord, the GConfigs filter returns all the groups configured for the 
specified tenant. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll? Tenant=&lt;TenantName&gt; 
&amp;Filter=GConfigs[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get statistics for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR employs the 
user that authenticated with IIS. 
Example 
 http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=GConfigs&amp;Username=ekeselman 
 
&lt;?xml version="1.0" encoding="UTF-8" ?&gt; 
&lt;GConfigs ts="Fri Jun 28 19:23:57 2013 UTC" tzo="14400" al="false"&gt; 
 
&lt;G id="1" n="DefaultGroup"&gt; 
 
 
&lt;Q id="2" n="Queue1" pq="1" /&gt; 
 
 
&lt;Q id="5" n="Queue4" pq="1" /&gt; 
 
 
&lt;A id="1" fn="S" ln="1" /&gt; 
 
 
&lt;A id="2" fn="S" ln="2" /&gt; 
 
&lt;/G&gt; 
 
&lt;G id="2" n="Group1"&gt; 
 
 
&lt;Q id="1" n="DefaultQueue" pq="1" /&gt; 
 
 
&lt;A id="4" fn="S" ln="4" /&gt; 
 
 
&lt;A id="5" fn="Eugene" ln="Keselman" /&gt; 
 
&lt;/G&gt; 
 
&lt;G id="3" n="Group2"&gt; 
 
 
&lt;Q id="3" n="Queue2" pq="1" /&gt; 
 
&lt;/G&gt; 
&lt;/GConfigs&gt;</p><p>CCSP APIs Guide - 7.4 
90 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
GConfigs  
Element  
This is the top level element and exists once in this 
document.  
al  
Attribute  
Agent limitation attribute indicates whether the RTR view is 
filtered or not. False means that the logged in agent/supervisor is 
tenant-wide or landlord and does not have a profile. True means 
the user has a profile.  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
G  
Element  
There is one 'G' element for each CCSP group defined for this 
tenant.  
id  
Attribute  
Group ID (Group_ID in the database).  
n  
Attribute  
Group name.  
Q  
Element  
There is one 'Q' element for each queue that belongs to this 
group.  
id  
Attribute  
Queue ID (Queue_ID in the database).  
n  
Attribute  
Queue name.  
pq  
Attribute  
Primary queue flag. This is set to '1' if this queue is a primary 
queue in this group. It is set to '0' if it is a secondary queue in this 
group.  
A  
Element  
There is one 'A' element for each agent that belongs to this 
group.  
fn  
Attribute  
Agent's first name.  
id  
Attribute  
Agent ID (Agent_ID in the database).</p><p>CCSP APIs Guide - 7.4 
91 
QConfigs  
The QConfigs filter displays a list of queues in accordance with the profile. If the supervisor is a 
tenant-wide supervisor or landlord, the QConfigs filter returns all the queues configured for the 
specified tenant. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll? Tenant=&lt;TenantName&gt; 
&amp;Filter=QConfigs[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get stats for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is only used if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS. 
Example 
http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=QConfigs&amp;Username=ekeselman 
 
&lt;?xml version="1.0" encoding="UTF-8" ?&gt; 
&lt;QConfigs ts="Fri Jun 28 19:34:40 2013 UTC" tzo="14400" al="false"&gt; 
 
&lt;Q id="1" n="DefaultQueue" as="0" at="0" ap="120" ai="0"&gt; 
 
 
&lt;G id="2" n="Group1" /&gt; 
 
&lt;/Q&gt; 
 
&lt;Q id="2" n="Queue1" as="0" at="0" ap="120" ai="0"&gt; 
 
 
&lt;G id="1" n="DefaultGroup" /&gt; 
 
&lt;/Q&gt; 
 
&lt;Q id="3" n="Queue2" as="0" at="0" ap="120" ai="0"&gt; 
 
 
&lt;G id="3" n="Group2" /&gt; 
 
&lt;/Q&gt; 
 
&lt;Q id="4" n="Queue3" as="0" at="0" ap="120" ai="0" /&gt; 
 
&lt;Q id="5" n="Queue4" as="0" at="0" ap="120" ai="0"&gt; 
 
 
&lt;G id="1" n="DefaultGroup" /&gt; 
 
&lt;/Q&gt; 
 
&lt;Q id="10" n="Queue9" as="0" at="0" ap="120" ai="0" /&gt; 
&lt;/QConfigs&gt;</p><p>CCSP APIs Guide - 7.4 
92 
 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
QConfigs  
Element  
This is the top level element and exists once in this 
document.  
al  
Attribute  
Agent limitation attribute indicates whether the RTR view is 
filtered or not. False means that the logged in agent/supervisor is 
tenant-wide or landlord and does not have a profile. True means 
the user has a profile.  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
Q  
Element  
There is one 'Q' element for each queue defined for this 
tenant.  
ai  
Attribute  
Assigned in queue timeout. The in queue time out assigned to 
this queue.  
ap  
Attribute  
Assigned pickup timeout. The pickup time out assigned to this 
queue.  
as  
Attribute  
Assigned service level. The service level assigned to this queue.  
at  
Attribute  
Assigned TQOS. The target quality of service assigned to this 
queue.  
aw 
Attribute 
Assigned wrap-up timeout in seconds. 
id  
Attribute  
Queue ID (Queue_ID in the database).  
n  
Attribute  
Queue name.  
G  
Element  
The group that this queue is assigned to.  
id  
Attribute  
Group ID (Group_ID in the database).  
n  
Attribute  
Group name.</p><p>CCSP APIs Guide - 7.4 
93 
QHistory 
The QHistory filter shows the queue statistics for the past 24 hours in accordance with the profile. If 
the supervisor is a tenant-wide supervisor or a landlord, the QHistory filter returns all the queues 
configured for the specified tenant. 
Each hourly attribute contains the number of calls for the particular counter from that hour until 
the current hour, not including the current hour. All hours are in UTC/GMT. 
This filter should be used in conjunction with the QCalls document to calculate statistics data from a 
particular hour. For example, the client is in GMT-5 timezone (Eastern USA) and you want to 
calculate the number of calls handled from 1 PM EST (13th hour EST, 18th hour UTC/GMT). You 
would take the value of the "t18" attribute from the "ch" element in QHistory and add it to the "ch" 
attribute of the QCalls document.  
Note 
QHIstory is reinitialized every time Statistics Server is restarted. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll?Tenant=&lt;TenantName&gt; 
&amp;Filter=QHistory[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get statistics for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS. 
Example 
http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=QHistory&amp;Username=ekeselman 
... 
&lt;/message&gt; 
&lt;Q n="q1" id="2"&gt; 
  &lt;ca t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" t3="0" 
t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" t17="0" 
t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;ch t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" t3="0" 
t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" t17="0" 
t16="0" t15="0" t14="0" t13="0" /&gt;</p><p>CCSP APIs Guide - 7.4 
94 
  &lt;co t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" t3="0" 
t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" t17="0" 
t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;cwt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;ct t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" t3="0" 
t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" t17="0" 
t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;ofi t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;ofo t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;catqos t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;cr t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" t3="0" 
t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" t17="0" 
t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;avlt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;tlkt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;wrpt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;rnt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;awt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;act t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;pfd t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;pfu t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;pfm t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;</p><p>CCSP APIs Guide - 7.4 
95 
  &lt;def t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;cwc t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;tct t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt;  
  &lt;twt t12="0" t11="0" t10="0" t9="0" t8="0" t7="0" t6="0" t5="0" t4="0" 
t3="0" t2="0" t1="0" t0="0" t23="0" t22="0" t21="0" t20="0" t19="0" t18="0" 
t17="0" t16="0" t15="0" t14="0" t13="0" /&gt; 
...</p><p>CCSP APIs Guide - 7.4 
96 
Elements and attributes 
The filter contains the following elements and attributes. 
Name 
Type  
Description 
QHistory  
Element  
This is the top level element and exists once in this document.  
ts  
Attribute  
RTR web server time stamp in UTC (Universal Time 
Coordinated)/GMT (Greenwich Mean Time).  
tzo  
Attribute  
Timezone offset of the RTR web server. This is the number of 
seconds that the RTR web server differs from UTC/GMT.  
Q  
Element  
There is one 'Q' element for each queue defined for this 
tenant.  
id  
Attribute  
Queue ID (Queue_ID in the database).  
n  
Attribute  
Queue name.  
pfd 
Attribute 
Counts number of items pulled from defer. 
pfm 
Attribute 
Counts number of queued items pulled from public. 
pfu 
Attribute 
Counts number of unqueued items pulled from public. 
act 
Element 
Note 
Average call time is now calculated in the CCSP Dashboard client. 
This legacy element is inaccurate. 
avlt 
Element 
Cumulative available time of the agents assigned to the 
campaign associated with this queue. Each "tNN" attribute 
contains the count for that hour to the current hour, in UTC/GMT 
format 
awt 
Element 
Note 
Average wait time is now calculated in the CCSP Dashboard client. 
This legacy element is inaccurate. 
ca  
Element  
Calls abandoned. Each "tNN" attribute contains the count for 
that hour to the current hour, in UTC/GMT format.  
catqos 
Element 
Calls abandoned within the target quality of service (TQOS). 
Each "tNN" attribute contains the count for that hour to the 
current hour, in UTC/GMT format. 
ch  
Element  
Calls handled. Each "tNN" attribute contains the count for that 
hour to the current hour, in UTC/GMT format.</p><p>CCSP APIs Guide - 7.4 
97 
Name 
Type  
Description 
co  
Element  
Calls offered. Each "tNN" attribute contains the count for that 
hour to the current hour, in UTC/GMT format.  
cr 
Element 
Calls rejected. Each "tNN" attribute contains the count for that 
hour to the current hour, in UTC/GMT format 
cwc 
Element 
Cumulative waiting calls. The number of calls that waited in the 
queue to be handled. 
ct  
Element  
Calls handled within the target quality of service (TQOS) 
threshold. Each "tNN" attribute contains the count for that hour 
to the current hour, in UTC/GMT format.  
cwt  
Element  
Cumulative waiting time. Each "tNN" attribute contains the 
count for that hour to the current hour, in UTC/GMT format.  
rnt 
Element 
Campaign run time. Each "tNN" attribute contains the count for 
that hour to the current hour, in UTC/GMT format. 
ofi  
Element  
Calls overflowed into this queue. Each "tNN" attribute contains 
the count for that hour to the current hour, in UTC/GMT format.  
tct 
Element 
Total call time. The sum of talk time in the queue. 
ofo  
Element  
Calls overflowed out of this queue. Each "tNN" attribute 
contains the count for that hour to the current hour, in UTC/GMT 
format.  
tlkt 
Element 
Cumulative talk time of the agents assigned to the campaign 
associated with this queue. Each "tNN" attribute contains the 
count for that hour to the current hour, in UTC/GMT format 
twt 
Element 
Total wait time, in seconds. The sum of wait time for all calls in 
the queue that waited to be handled. 
Note 
AWT (Average waiting time) = (twt from QHistory + twt from QCalls) / 
(cwc from QHistory + cwc from QCalls) 
wrpt 
Element 
Cumulative wrap-up time of the agents assigned to the 
campaign associated with this queue. Each "tNN" attribute 
contains the count for that hour to the current hour, in UTC/GMT 
format</p><p>CCSP APIs Guide - 7.4 
98 
SServer 
The SServer filter shows raw data from the Statistics server. This data is internal data and should 
not be used in client application. This data can be used for logging and debugging. 
Usage 
http://&lt;ServerName&gt;/realtimereports/rtrweb.dll?Tenant=&lt;TenantName&gt; 
&amp;Filter=SServer[DEV:&amp;Username=&lt;UserName&gt;] 
 
Where: 
• 
&lt;ServerName&gt; is the IP address or domain name of the server hosting the RTR web site. 
• 
&lt;TenantName&gt; is the name of the tenant that you want to get stats for. Only for landlord 
users. 
• 
&lt;UserName&gt; is the Windows user name of an agent supervisor or CCSP administrator. This 
parameter is used only if IIS is configured for anonymous access. Otherwise, RTR uses the user 
that authenticated with IIS. 
Example 
 http://localhost/rtrdll/rtrweb.dll?Tenant=cosmocom&amp;Filter=SServer&amp;Username=ekeselman 
 
&lt;?xml version="1.0" encoding="UTF-8" ?&gt; 
&lt;StatServer StartTime="1151505627"&gt; 
&lt;Agents&gt; 
 
&lt;Agent PersonId="1" GlobalId="131072" FirstName="S" LastName="1" 
LoginName="s1" TenantId="0" AIS="9" Team="1" Group="1" State="2" 
MaximumNumberOfCalls="1" ReleaseCode="0" TimeInState="740"&gt; 
 
 
&lt;MediaStreams /&gt; 
 
&lt;/Agent&gt; 
&lt;/Agents&gt; 
&lt;Calls /&gt; 
&lt;Servers&gt; 
 
&lt;Server ServerId="6" CCUApplicationType="2" Port="14006" 
IPAddress="1709100711" State="2" TimeInState="595183" /&gt; 
&lt;/Servers&gt; 
&lt;Trunks /&gt; 
&lt;Campaigns /&gt; 
&lt;StatisticCounters&gt; 
 
&lt;CounterTree CounterId="1001"&gt; 
 
 
&lt;Counter&gt;</p><p>CCSP APIs Guide - 7.4 
99 
 
 
 
&lt;Counter GroupBy="7" /&gt; 
 
 
&lt;/Counter&gt; 
 
&lt;/CounterTree&gt; 
 
&lt;CounterTree CounterId="1002"&gt; 
 
 
&lt;Counter&gt; 
 
 
 
&lt;Counter GroupBy="0" /&gt; 
 
 
 
&lt;Counter GroupBy="1" /&gt; 
 
 
&lt;/Counter&gt; 
........................ 
 
&lt;/StatisticCounters&gt; 
&lt;Enums&gt; 
&lt;CallStateEnum&gt; 
 
&lt;EnumMember Id="1" name="CallStateDoesntExist" /&gt; 
 
&lt;EnumMember Id="2" name="CallStateInQueue" /&gt; 
 
&lt;EnumMember Id="3" name="CallStateBeingServiced" /&gt; 
 
&lt;EnumMember Id="4" name="CallStateAliveWithoutActiveStreams" /&gt; 
&lt;/CallStateEnum&gt; 
&lt;AgentStateEnum&gt; 
 
&lt;EnumMember Id="1" name="AgentStateLogout" /&gt; 
 
&lt;EnumMember Id="2" name="AgentStateReleased" /&gt; 
 
&lt;EnumMember Id="4" name="AgentStateUnavailable" /&gt; 
 
&lt;EnumMember Id="5" name="AgentStateWrapUp" /&gt; 
 
&lt;EnumMember Id="6" name="AgentStateInCall" /&gt; 
&lt;/AgentStateEnum&gt; 
&lt;TrunkStatesEnum&gt; 
 
&lt;EnumMember Id="1" name="TrunkStateDown" /&gt; 
 
&lt;EnumMember Id="2" name="TrunkStateAvailable" /&gt; 
 
&lt;EnumMember Id="3" name="TrunkStateInCall" /&gt; 
 
&lt;EnumMember Id="4" name="TrunkStateOutCall" /&gt; 
 
&lt;EnumMember Id="5" name="TrunkStateAgentCircuit" /&gt; 
 
&lt;EnumMember Id="6" name="TrunkStateOutOfService" /&gt; 
&lt;/TrunkStatesEnum&gt; 
&lt;TrunkTypesEnum&gt; 
 
&lt;EnumMember Id="1" name="TrunkIN" /&gt; 
 
&lt;EnumMember Id="2" name="TrunkOUT" /&gt; 
 
&lt;EnumMember Id="3" name="TrunkCIRCUIT" /&gt;</p><p>CCSP APIs Guide - 7.4 
100 
 
&lt;EnumMember Id="4" name="TrunkINOUT" /&gt; 
 
&lt;EnumMember Id="5" name="TrunkOUTOFSERVICE" /&gt; 
&lt;/TrunkTypesEnum&gt; 
&lt;CallTypesEnum&gt; 
 
&lt;EnumMember Id="0" name="CallOut" /&gt; 
 
&lt;EnumMember Id="1" name="CallIn" /&gt; 
 
&lt;EnumMember Id="2" name="CallAgentToAgent" /&gt; 
 
&lt;EnumMember Id="3" name="CallBridgedCall" /&gt; 
 
&lt;EnumMember Id="4" name="CallbackRequest" /&gt; 
 
&lt;EnumMember Id="5" name="CallbackResponse" /&gt; 
&lt;/CallTypesEnum&gt; 
&lt;ServerStatesEnum&gt; 
 
&lt;EnumMember Id="1" name="ServerStateDown" /&gt; 
 
&lt;EnumMember Id="2" name="ServerStateUp" /&gt; 
&lt;/ServerStatesEnum&gt; 
&lt;CampaignStatesEnum&gt; 
 
&lt;EnumMember Id="1" name="CampaignStateDoesntExist" /&gt; 
 
&lt;EnumMember Id="2" name="CampaignStateRunning" /&gt; 
 
&lt;EnumMember Id="3" name="CampaignStateStopped" /&gt; 
 
&lt;EnumMember Id="4" name="CampaignStateSuspended" /&gt; 
&lt;/CampaignStatesEnum&gt; 
&lt;StatisticLevels&gt; 
 
&lt;EnumMember Id="0" name="TENANT_STAT" /&gt; 
 
&lt;EnumMember Id="1" name="CS_STAT" /&gt; 
 
&lt;EnumMember Id="2" name="AIS_STAT" /&gt; 
 
&lt;EnumMember Id="3" name="QUEUE_STAT" /&gt; 
 
&lt;EnumMember Id="4" name="TEAM_STAT" /&gt; 
 
&lt;EnumMember Id="6" name="SKILLSET_STAT" /&gt; 
 
&lt;EnumMember Id="7" name="MEDIATYPE_STAT" /&gt; 
 
&lt;EnumMember Id="8" name="TRUNKGROUP_STAT" /&gt; 
 
&lt;EnumMember Id="9" name="TRUNK_STAT" /&gt; 
 
&lt;EnumMember Id="10" name="IPLINK_STAT" /&gt; 
 
&lt;EnumMember Id="11" name="AGENT_STAT" /&gt; 
 
&lt;EnumMember Id="12" name="CALL_STAT" /&gt; 
 
&lt;EnumMember Id="13" name="APP_STAT" /&gt; 
 
&lt;EnumMember Id="14" name="DISPOSITION_STAT" /&gt; 
 
&lt;EnumMember Id="15" name="DIALEROUTCOME_STAT" /&gt;</p><p>CCSP APIs Guide - 7.4 
101 
 
&lt;EnumMember Id="16" name="CAMPAIGN_STAT" /&gt; 
&lt;/StatisticLevels&gt; 
&lt;StatisticCounters&gt; 
 
&lt;EnumMember Id="1001" name="AvailableForOutDialTrunks" /&gt; 
 
&lt;EnumMember Id="1002" name="TotalTrunkUtilization" /&gt; 
 
&lt;EnumMember Id="1003" name="TotalTimeAllTrunksBusy" /&gt; 
 
&lt;EnumMember Id="1004" name="NumberOfTrunks" /&gt; 
 
&lt;EnumMember Id="1005" name="NumberOfTrunksBusy" /&gt; 
 
&lt;EnumMember Id="1006" name="NumberOfTrunksOutOfService" /&gt; 
 
&lt;EnumMember Id="1007" name="AllTrunksList" /&gt; 
 
&lt;EnumMember Id="2001" name="AllIPLinksList" /&gt; 
 
&lt;EnumMember Id="2002" name="TotalTimeAllIPLinksBusy" /&gt; 
 
&lt;EnumMember Id="2003" name="TotalIPLinkUtilization" /&gt; 
 
&lt;EnumMember Id="3001" name="AllLoggedInAgentsList" /&gt; 
 
&lt;EnumMember Id="3002" name="ListOfAgentsInCall" /&gt; 
 
&lt;EnumMember Id="4001" name="CallsWaiting" /&gt; 
 
&lt;EnumMember Id="4002" name="CallsBeingHandled" /&gt; 
 
&lt;EnumMember Id="4003" name="CallsOverflowedIn" /&gt; 
 
&lt;EnumMember Id="4004" name="CallsOverflowedOut" /&gt; 
 
&lt;EnumMember Id="4005" name="CallsAliveWithoutStreamsList" /&gt; 
 
&lt;EnumMember Id="4006" name="CallsBeingHandledList" /&gt; 
 
&lt;EnumMember Id="4007" name="CallsWaitingList" /&gt; 
 
&lt;EnumMember Id="5001" name="AllServersList" /&gt; 
 
&lt;EnumMember Id="6001" name="PDSNumberOfCallsByDisposition" /&gt; 
 
&lt;EnumMember Id="6002" name="PDSCumulativeCallsLengthByDisposition" /&gt; 
 
&lt;EnumMember Id="6003" name="PDSAvailableTime" /&gt; 
 
&lt;EnumMember Id="6004" name="PDSTalkTime" /&gt; 
 
&lt;EnumMember Id="6005" name="PDSWrapTime" /&gt; 
 
&lt;EnumMember Id="6006" name="CampaignRunTime" /&gt; 
 
&lt;EnumMember Id="6007" name="PDSNumberOfCallsByOutcome" /&gt; 
 
&lt;EnumMember Id="6008" name="AllCampaignsList" /&gt; 
 
&lt;EnumMember Id="33287" name="CallsHandled" /&gt; 
 
&lt;EnumMember Id="33282" name="CallsAbandoned" /&gt; 
 
&lt;EnumMember Id="33288" name="CallsOffered" /&gt; 
 
&lt;EnumMember Id="33306" name="ServiceLevel" /&gt; 
 
&lt;EnumMember Id="4100" name="CallsAbandonedWithinTQOS" /&gt; 
 
&lt;EnumMember Id="4101" name="CallsRejected" /&gt;</p><p>CCSP APIs Guide - 7.4 
102 
 
&lt;EnumMember Id="33304" name="LongestWaitingCall" /&gt; 
 
&lt;EnumMember Id="33299" name="SpeedToAnswerTime" /&gt; 
&lt;/StatisticCounters&gt; 
&lt;/Enums&gt; 
&lt;/StatServer&gt;</p><p>CCSP APIs Guide - 7.4 
103 
9: CCSP TWS integration 
This chapter explains how to use a generic client application to integrate with Teams Web Service 
(TWS). It details the TWS Web API, the SignalR Hub, and includes some code snippets to facilitate 
the integration. Sequence diagrams with the main flows are also included. 
This chapter contains the following information: 
• 
Architecture 
• 
Requirements 
• 
Web API 
• 
SignalR Hub 
• 
Client application flows 
Architecture 
The following diagram shows the TWS integration architecture.</p><p>CCSP APIs Guide - 7.4 
104 
The Teams Web Service (TWS) is a C# .NET Core Application. It can be deployed as a self-hosted 
web application running as a windows service. 
TWS integrates with Microsoft Teams by calling methods on the MS Graph API to get the presence 
of Teams users. 
TWS subscribes to presence change notifications using the Graph API. Whenever a Teams user 
subscribed in TWS changes its presence, a notification is received by TWS.  
A Web API is exposed by TWS so that a client application can use it to integrate with teams. 
TWS provides an ASP.NET Core SignalR Hub to propagate events to a client application. 
Both the TWS Web API and the SignalR Hub are secured using JWT Bearer Authentication. Tokens 
can be obtained from CCSP’s Auth Server or from another token issuer.  
Requirements 
For the integration between CCSP and MS Teams to work correctly, the following requirements 
must be met: 
1. 
The first part of the User Principal Name in teams must match the Login ID in CCSP. Example: 
if a Teams user with userPrincipalName “PattiF@ccspteams2.onmicrosoft.com” is to work as 
an agent in CCSP it must have the Login ID “Pattif” in CCSP. The Teams user must have at least 
one phone number. 
2. 
As the TWS Web API methods are authenticated, the client application must get a bearer token 
before calling the methods and send it in the HTTP Authorization header. For the client 
application to connect to the SignalR Hub it must also send the same token. 
 
The client application may get the bearer token from CCSP’s AuthService or from another token 
issuer. When using a token issuer different from AuthService, the TWS has be configured with token 
parameters Issuer, Audience and OAuthSecretKey to validate the tokens. For more details on 
authentication in TWS with Auth Server, please see the Authentication in TWS with AuthServer flow. 
Web API 
TWS Web API methods are accessible at [TWSBaseAddress]/TeamsPresence/. 
These are the available methods. 
Connect (agent, UPN)  
This method adds the agent to the list of active agents in the TWS. It should be called when the 
agent logs in CCSP. 
Request parameters   
• 
agent – the CCSP agent Login ID. Example “agent01”. 
• 
UPN – the User Principal Name suffix that identifies the tenant. Example “t1.loc”.</p><p>CCSP APIs Guide - 7.4 
105 
Example request URL 
GET https://localhost:6001/TeamsPresence/Connect?agent=agent01&amp;UPN=t1.loc 
Return value 
On success (HTTP 200 OK) the method returns an empty body. 
Note 
This method doesn’t need to be called explicitly by the Client Application as the Get* methods 
already execute the same logic in TWS internally. 
 
Disconnect (agent, UPN)  
This method removes the agent from the list of active agents in TWS. It should be called when the 
agent logs out from CCSP. 
Request parameters   
• 
agent – the CCSP agent Login ID. Example “agent01”. 
• 
UPN – the User Principal Name suffix that identifies the tenant. Example “t1.loc”. 
Example request URL 
GET https://localhost:6001/TeamsPresence/Disconnect?agent=agent01&amp;UPN=t1.loc 
Return value 
On success (HTTP 200 OK) the method returns an empty body. 
GetUsersPresences (agent, UPN) 
This method gets the presences of the currently active agents in the TWS. It should be called only 
when connecting or reconnecting to the server. 
Request parameters   
• 
agent – the CCSP agent Login ID. Example “agent01”. 
• 
UPN – the User Principal Name suffix that identifies the tenant. Example “t1.loc”. 
Example request URL 
GET https://localhost:6001/TeamsPresence/GetUsersPresences?agent=agent01&amp;UPN= 
t1.loc</p><p>CCSP APIs Guide - 7.4 
106 
Return value 
The method returns the presence information for each user. It’s an array of JSON objects. 
As an example, here’s a response body with presence information for 2 users. 
[ 
  { 
    "userPrincipalName": "PattiF@ccspteams2.onmicrosoft.com", 
    "displayName": "Patti Fernandez", 
    "givenName": "Patti", 
    "surname": "Fernandez", 
    "number": "+1 502 555 0144", 
    "mail": "PattiF@ccspteams2.onmicrosoft.com", 
    "department": "Executive Management", 
    "activity": "Available", 
    "availability": "Available", 
    "id": "fe4135db-175b-4149-978e-53c5a947c107" 
  }, 
  { 
    "userPrincipalName": "NestorW@ccspteams2.onmicrosoft.com", 
    "displayName": "Nestor Wilke", 
    "givenName": "Nestor", 
    "surname": "Wilke", 
    "number": "+1 206 555 0105", 
    "mail": "NestorW@ccspteams2.onmicrosoft.com", 
    "department": "Operations", 
    "activity": "Busy", 
    "availability": "Busy", 
    "id": "7c9e9ed7-7761-4688-afc9-0e11086d1301" 
  } 
] 
Note 
The field “activity” has the Teams presence information for the users. In the example above, 
PattiF@ccspteams2.onmicrosoft.com is “Available” and NestorW@ccspteams2.onmicrosoft.com 
is “Busy”.</p><p>CCSP APIs Guide - 7.4 
107 
GetUsersPresencesSearch (agent, UPN, filter) 
This method is used to search for contacts in the Teams directory. Please note that the contacts 
don’t have to be CCSP users. The search will return the teams users that match the filter criteria. 
The number of results is limited by configuration. 
The requests to this method are cached on the server, meaning that every search filter used by an 
agent is stored in a memory cache and then reused for its lifetime (configurable). 
Parameters  
• 
agent – the CCSP agent Login ID. Example “agent01”. 
• 
UPN – the User Principal Name suffix that identifies the tenant. Example “t1.loc”. 
• 
filter – a string to filter the users in the Teams directory. 
Example request URL  
GET https://localhost:6001/TeamsPresence/GetUsersPresencesSearch?agent 
=agent01&amp;UPN=t1.loc&amp;Filter=m 
Return value 
The method returns the presence information for each user. It’s an array of JSON objects. 
As an example, here’s a response body with presence information for 3 users which is the result of 
searching with filter “m”. This will return all users in the Teams directory that have a name or 
surname starting with “m”. 
 [ 
  { 
    "userPrincipalName": "MeganB@ccspteams2.onmicrosoft.com", 
    "displayName": "Megan Bowen", 
    "givenName": "Megan", 
    "surname": "Bowen", 
    "number": "+1 412 555 0109", 
    "mail": "MeganB@ccspteams2.onmicrosoft.com", 
    "department": "Marketing", 
    "activity": "Away", 
    "availability": "Away", 
    "id": "4cd43515-7986-437a-a4e3-fbbd66b74472" 
  }, 
  { 
    "userPrincipalName": "MiriamG@ccspteams2.onmicrosoft.com", 
    "displayName": "Miriam Graham", 
    "givenName": "Miriam",</p><p>CCSP APIs Guide - 7.4 
108 
    "surname": "Graham", 
    "number": "+1 858 555 0109", 
    "mail": "MiriamG@ccspteams2.onmicrosoft.com", 
    "department": "Sales &amp; Marketing", 
    "activity": "Offline", 
    "availability": "Offline", 
    "id": "abe9cc47-ad70-4527-b92a-41e2197456ee" 
  }, 
  { 
    "userPrincipalName": "HenriettaM@ccspteams2.onmicrosoft.com", 
    "displayName": "Henrietta Mueller", 
    "givenName": "Henrietta", 
    "surname": "Mueller", 
    "number": "+1 954 555 0118", 
    "mail": "HenriettaM@ccspteams2.onmicrosoft.com", 
    "department": "R&amp;D", 
    "activity": "BeRightBack", 
    "availability": "BeRightBack", 
    "id": "fe7ae738-f5fe-4134-b1b3-487a2dcfe3ae" 
  } 
] 
GetMyPresence (agent, UPN) 
This method gets the presence of the current user. 
Request parameters   
• 
agent – the CCSP agent Login ID. Example “agent01”. 
• 
UPN – the User Principal Name suffix that identifies the tenant. Example “t1.loc”. 
Example request URL  
GET https://localhost:6001/TeamsPresence/GetMyPresence?agent 
=agent01&amp;UPN=t1.loc</p><p>CCSP APIs Guide - 7.4 
109 
Return value 
The method returns the presence information for the user. It’s a JSON object. 
As an example, here’s a response body with presence information for the user. 
  { 
    "userPrincipalName": "NestorW@ccspteams2.onmicrosoft.com", 
    "displayName": "Nestor Wilke", 
    "givenName": "Nestor", 
    "surname": "Wilke", 
    "number": "+1 206 555 0105", 
    "mail": "NestorW@ccspteams2.onmicrosoft.com", 
    "department": "Operations", 
    "activity": "Available", 
    "availability": "Available", 
    "id": "7c9e9ed7-7761-4688-afc9-0e11086d1301" 
  } 
 
In the example above NestorW@ccspteams2.onmicrosoft.com is “Available”. 
Error Codes 
The error codes returned by the API methods are: 
• 
HTTP 400 Bad Request – when the agent or the UPN Request parameters are empty. 
• 
HTTP 401 Unauthorized – when the methods are called without sending the Bearer token in 
the Authorization header of the HTTP request or when sending a token that has expired. 
• 
HTTP 403 Forbidden – when the claims sent in the Bearer token are not valid. 
• 
HTTP 404 Not Found – when the agent or the UPN Request parameters are not found in the 
server. 
SignalR Hub 
The SignalR Hub is accessible at address [TWSBaseAddress]/hub/teams 
Notifications of Teams presence changes are sent from TWS to a client application using ASP.Net 
Core SignalR. 
The client application subscribes to notifications from TWS by connecting to the SignalR Hub. 
Note 
For information about developing a SignalR client in JavaScript please check 
https://docs.microsoft.com/en-us/aspnet/core/signalr/javascript-client?view=aspnetcore-6.0.</p><p>CCSP APIs Guide - 7.4 
110 
Create connection 
First the client application must create a connection to the TWS SignalR Hub. This depends on the 
programming language in which the client is written but it’s usually done by calling 
HubConnectionBuilder passing the Hub address. As the SignalR Hub is secured using JWT 
authentication, the access_token must be sent in the requests. 
Here’s an example using JavaScript. 
connection = new signalR.HubConnectionBuilder() 
.withUrl(https://localhost:6001/hub/teams, {accessTokenFactory: () =&gt; 
access_token}) 
.build(); 
 
Note 
When creating the SignalR connection it’s possible to configure what happens when the 
connection with the server is lost. For more details check: https://docs.microsoft.com/en-
us/aspnet/core/signalr/javascript-client?view=aspnetcore-6.0&amp;tabs=visual-studio#reconnect-
clients. 
Start 
After having the connection object, the client application must call a method called start or similar. 
For example, in JavaScript: 
connection.start() 
 
At this point the connection with the TWS Hub is established. 
AddToGroup 
After starting the connection, the client application must call method AddToGroup to pass the 
tenant UPN information to TWS. This step is needed for Teams Web Service to notify only the 
agents from the same tenant when a presence update occurs. For example, in JavaScript: 
connection.start().then(function () { 
console.log("SignalR client connected"); 
connection.invoke("AddToGroup", "t1.loc"); 
}</p><p>CCSP APIs Guide - 7.4 
111 
The following notifications are sent by SignalR to the client application. 
StatusUpdate 
Notifies clients that a presence update occurred in one Teams user. 
The StatusUpdate message sends the presence update information of a single Teams user. It’s a 
JSON object. Here’s an example of the StatusUpdate message: 
    { 
      "userPrincipalName": "PattiF@ccspteams2.onmicrosoft.com", 
      "displayName": "Patti Fernandez", 
      "givenName": "Patti", 
      "surname": "Fernandez", 
      "number": "+1 502 555 0144", 
      "mail": null, 
      "department": null, 
      "activity": "Available", 
      "availability": "Available", 
      "id": "fe4135db-175-4149-978e-53c5a947c107" 
    } 
 
Note 
The field “activity” has the Teams presence information for the user. In the example above the 
teams user PattiF@ccspteams2.onmicrosoft.com became “Available”. 
 
 
Here’s the JavaScript sample code to handle the notification. 
connection.on("StatusUpdate", function (message) { 
console.log("Received StatusUpdate:" + message.userPrincipalName + " is " + me
ssage.activity); 
//add additional logic here 
}</p><p>CCSP APIs Guide - 7.4 
112 
RemoveAgent 
Notifies the client application that an agent is no longer active in the Teams Web Service. The 
RemoveAgent message is a JSON object. Here’s an example message: 
    { 
      "userPrincipalName": "NestorW@ccspteams2.onmicrosoft.com", 
      "displayName": "Nestor Wilke", 
      "givenName": "Nestor", 
      "surname": "Wilke", 
      "number": "+1 206 555 0105", 
      "mail": null, 
      "department": null, 
      "activity": "Offline", 
      "availability": "Offline", 
      "id": "7c9e9ed7-7761-4688-afc9-0e11086d1301" 
    } 
 
In this example, the CCSP agent NestorW is no longer active in the Teams Web Service. 
Here’s the JavaScript code to handle the notification: 
connection.on("RemoveAgent", function (message) { 
console.log("Received RemoveAgent:" + message.userPrincipalName); 
//add additional logic here 
});</p><p>CCSP APIs Guide - 7.4 
113 
Client application flows 
In this section the main client application flows are shown as sequence diagrams. 
Agent login 
When the agent clicks the “Start” button, the following flow is executed. The initial step of the flow 
is the authentication of the Client Application with AuthServer as explained in the next flow. 
 
Note 
connection.start() is automatically called by SignalR after the connection with the Hub is 
established.</p><p>CCSP APIs Guide - 7.4 
114 
Authentication in TWS with AuthServer</p><p>CCSP APIs Guide - 7.4 
115 
 
In the above diagram we can see how to call TWS with authenticated requests. These are the steps 
in more detail: 
1. 
The Client Application calls the /init endpoint on AuthServer to get an RSA key pair. 
2. 
The Client Application encrypts the agent password with the RSA key pair. 
3. 
The Client Application sends a request to the /login endpoint of AuthServer with the 
username, encrypted password, teams_client_id (a specific client_id for teams in AuthServer) 
and grant_type = ‘password’. The response to this request will have an access_token and a 
refresh_token. 
4. 
Requests to TWS must include “Bearer “ concatenated with the teams_access_token in the 
HTTP Authorization header to be valid. 
5. 
When a request with an expired access_token is done, TWS replies with “401 Unauthorized” 
and the Client Application must get a new access_token sending a request to the /login 
endpoint of AuthServer with the teams_client_id, refresh_token and grant_type = 
‘refresh_token’. The response to this request will have a new access_token that must be used 
to authenticate the requests to TWS.  
6. 
When a request to AuthServer to refresh the access_token is done with an expired 
refresh_token, AuthServer replies “401 Unauthorized” and the Client Application must 
authenticate again with AuthServer starting in point 1 above. 
 
Note 
AuthServer default lifetime for an access_token is 15 minutes and for a refresh_token is 10 hours. 
 
Search users in Teams directory 
The agent searches users in the Teams directory.</p><p>CCSP APIs Guide - 7.4 
116 
Agent changes presence 
The agent changes presence in the Teams client. 
 
 
Another agent changes presence 
Another agent changes presence in the Teams client.</p><p>CCSP APIs Guide - 7.4 
117 
Agent logout 
The agent logs out. 
 
Another agent logs out 
Another agent logs out.</p><p>CCSP APIs Guide - 7.4 
118 
10: CCSP UI Connector 
The CCSP UI Connector (previously called the CCSP TouchPoint Connector) provides a two-way 
integration hub on the client for integration into other desk applications or web applications.  
For a description of the architecture and .NET API Interface, see the CCSP UI Connector Guide. 
You can find the CCSP UI Connector Guide.pdf in the same location as this guide.</p><p>CCSP APIs Guide - 7.4 
119 
A: CCSP Web Support integration 
Note 
CCSP now has a JSON-based Chat API that can be used on mobile and non-mobile 
devices and different html pages.  
We recommend that you use the JSON-based CCSP Chat API instead of the CCSP Web Support 
package, because the CCSP Chat API: 
• 
Is more flexible and can be customized as required. 
• 
Uses less bandwidth than the html-based CCSP Web Support package that contains extra 
data such as design. 
• 
Will have new features developed for it, such as typing. No new features will be developed for 
the CCSP Web Support package. 
 
For more information, see 6: CCSP Chat API. 
 
This appendix contains the following information: 
• 
Chat call initiation sequence 
• 
Web Support package components 
• 
Send external callbacks via SMTP 
• 
Chat extension 
• 
Chat extension components 
• 
Interfaces to the chat extension 
• 
Customize the chat window 
• 
Parameters 
 
The CCSP Web Support package provides an easily configurable method to enable chat calls and 
callback requests to your contact center. 
Contact-enabling your website involves adding a configured chat button to your website and 
embedding tags to set the parameters that are needed to initiate the call. 
You use the Configurator to set the defaults that should be used for all chat calls. These defaults 
are saved in an Active Server Pages (ASP) script. You can use the ASP components to quickly 
contact-enable your website using these defaults and by gathering actual caller information.</p><p>CCSP APIs Guide - 7.4 
120 
Chat call initiation sequence 
To initiate a chat call, the following sequence must occur: 
1. 
User browses to the contact center's webpage. 
2. 
If cookies are used, a cookie is set with parameters appropriate for the call. 
3. 
User clicks the configured button. 
4. 
The script grabs the parameters from the cookie, URL query, or form. 
5. 
The script creates a query string and redirects to ChatExtension.dll. If any parameters are 
missing, the script uses the defaults set in the Configurator. 
6. 
The HTML chat window is launched on the caller's computer and the chat is initiated. 
Web Support package components 
The Web Support package includes: 
• 
Configurator — used to enter the defaults for all chat calls, including file and directory 
locations, optional parameters, and other information needed by the Web Support package to 
launch chats. See Configurator. 
• 
ASP scripts — the quickest way to contact-enable your website. These scripts are generated 
using Configurator. See Quick start. 
• 
Chat extension — an ISAPI extension DLL that runs on your Microsoft IIS Web Server. The 
extension provides a set of APIs that you can use on a webpage to communicate with the CCSP 
ACD. Parameters can be passed to the APIs as either HTML form fields or a URL query. See 
Chat extension. 
Configurator 
Use the Configurator to create a configuration that contains the defaults to be used for all chat 
calls, including file and directory locations, optional parameters, and other information needed to 
launch chats from a configured webpage. The defaults are used if the associated parameters are 
not passed to the ASP script when the call is initiated. 
The configuration information is stored in ASP scripts. You can create multiple configurations, 
possibly one for each of your webpages. Each configuration that you create must reside in a unique 
directory that has script execute and read privileges. 
To create a new configuration or make changes to an existing configuration: 
1. 
Click Start, point to All programs, click CCSP, and then click CCSP ASP File Configurator. The 
CCSP ASP File Configurator dialog box appears. 
2. 
On the File menu, click New Configuration or to edit an existing one, click Open 
Configuration. 
3. 
Type the new or existing configuration name, and click OK. 
4. 
In Directory (Physical Path), enter the local path to your scripts directory. 
5. 
On the Call Center Information tab, enter defaults for your contact center.</p><p>CCSP APIs Guide - 7.4 
121 
6. 
Click the No Agents Action tab and enter the following information: 
o 
No Agents Action — a webpage that handles rejected chat calls. 
o 
No Agents Message — a continuous string of text. Any hard returns are removed. 
7. 
Click the Caller Information tab and enter the following information: 
o 
Caller Phone Type — chat is always the default for HTML and Java callers. 
o 
Caller URL — the URL to forward to the agent at the start of the chat. 
o 
HTML Caller Initial URL — the URL that should appear in the right frame of the HTML 
chat window. 
o 
Caller Message — the message that the agent should see. 
o 
Caller Name — the name that the agent should see. 
o 
Call Center Queue and Tenant — routing information to use if no customer parameters 
are set. 
o 
Skills Required — use a comma, space, semicolon, or a plus sign (+) to separate multiple 
skills. 
o 
Caller Language — language of the HTML chat window, for example, 1033 for English. 
For other languages, substitute the correct Windows locale ID code. 
8. 
Click the Optional Params tab and enter the optional parameters. You can’t use blank spaces 
in the parameter names. Some optional parameters that you might need to use for integration 
with another application include: application_name, customer_ID, shopping_cart_ID, 
trouble_ticket, order_number, and tracking_number. 
9. 
On the File menu, click Save Configuration. 
When you save a configuration, a number of sample .asp files are created in the directory you 
selected for the configuration. 
File 
Description 
call.asp  
ASP script that contains the default values you want to use for 
all email and chat calls configured to use this script. 
makecall.asp  
Places the call to the ChatExtension.dll using the parameters 
from call.asp.  
call_request_demo.htm  
Sample HTML form for testing purposes. 
cookiecaller.txt  
Inserts button image and link into page on caller's browser. 
Reads parameters from cookie and creates a URL with 
parameters (used for URL query). Included by cosmotest.asp.  
cosmocallasp.asp  
Sample HTML form that can be used to collect caller data. 
cosmotest.asp  
Sample script used for testing the three parameter-gathering 
methods: cookie, URL query, and form. Works with 
call_request_demo.htm.  
talk_to_us4.gif 
Button logo. Requires your \scripts directory to have read 
access privileges.</p><p>CCSP APIs Guide - 7.4 
122 
Quick start 
The quickest way to contact-enable your website is to use the generated ASP scripts. There are 
several ways to use the ASP scripts to initiate a call, however, the simplest way is to include the 
following on your webpage: 
&lt;a href=“&lt;path&gt;/call.asp”&gt;&lt;img src=“&lt;path&gt;/talk_to_us4.gif”&gt;&lt;/a&gt; 
where &lt;path&gt; indicates the fully qualified URL to the ASP script you created. 
When the user clicks this button, call.asp initiates a call using the default values that were set with 
the Configurator. 
This method is suitable for testing or evaluation purposes and very basic websites. In a real 
operation it is likely that you want to use CCSP's intelligent routing and application integration 
features which utilize information about the customer. This information can be gathered from a 
form or from the pages the caller visited on your website, or it can be derived from a server-side 
application such as a shopping cart or help desk application.</p><p>CCSP APIs Guide - 7.4 
123 
Send external callbacks via SMTP 
This section contains the following information: 
• 
Extended SMTP headers 
• 
Sample script 
 
This section describes an open API for sending callback requests into the CCSP platform using the 
SMTP protocol. 
Note 
To be able to use SMTP callbacks with the MSR DB and an external mailbox, the email data store 
must be assigned with an MSR DB in CCSP Admin.  
 
When using the Tenant Exchange Database as the Messaging store: 
• 
Each tenant requires a mail-enabled folder for collecting these callback requests. The folder 
email address is Callback@&lt;tenantSuffix&gt;. The &lt;tenantSuffix&gt; is located in Tenant properties, in 
the CCSP Administrator. 
 
When using the Tenant Messaging Database as the Messaging store: 
• 
Each tenant requires at least one folder associated with an external mailbox. 
• 
The email address of that folder can be used to send callback requests using the SMTP 
protocol. 
 
Application developers include the relevant tenant and routing context data from the defined CCSP 
configuration.  
Extended SMTP headers 
Extended SMTP headers allow for the transmission of extra information along with callback 
requests. This can include such information as the caller's name and a message, and scheduling 
information for callbacks and routing.   
All headers are strings. 
Header field 
Description 
X-CosmoCall-AccountName 
Name of the account to use for generated call, for example, 
"Microsoft Account" 
X-CosmoCall-AgentID 
Designated agent’s configuration ID. 
Note 
If a personal callback is scheduled without the 
SegregationGroupID, the AgentID is removed, an error is 
logged, and the callback is treated as a non-personal callback 
and routed to the next suitable agent.</p><p>CCSP APIs Guide - 7.4 
124 
Header field 
Description 
X-CosmoCall-AttachmentUrl 
URL to send with the call. This URL is used for backward 
compatibility for integration purposes on the client application 
side. 
X-CosmoCall-CallerANI 
Caller's ANI to send with the call. 
X-CosmoCall-CallerDNIS 
Caller's DNIS to send with the call. 
X-CosmoCall-CallerIvrDigits 
Caller's IVR digits to send with the call. 
X-CosmoCall-CallerName 
Caller's name to send with the call. 
X-CosmoCall-
DirectInwardDialing 
Whether direct route to agent specified via X-CosmoCall-
AgentID field. If yes, set to “True” 
X-CosmoCall-ImmediateDialing 
Whether callback outdialing address should be dialed 
immediately without agent intervention when the agent picks 
up the callback call. If yes, set to “True” 
X-CosmoCall-Message 
Text message to send with the call and to present to the agent, 
for example, "This call arrived from auto-callback 
script" 
X-CosmoCall-Option# 
Optional parameters to send with the call, for example,  
"Name&gt;Value" 
Optional parmeters must be sequential and their value must 
be in the form “{key}&gt;{value}” 
For example: 
X-CosmoCallOption1=key1&gt;value1 
X-CosmoCallOption2=key2&gt;value2 
Note 
Out-of-sequence optional parameters are ignored. 
X-CosmoCall-OriginatingCallId 
Originating (linked) call's call ID. 
X-CosmoCall-
OriginatingCallType 
Originating (linked) call's media stream type. 
X-CosmoCall-
OutDialingAddress 
Callback outdialing address, usually a number to dial out 
(required). 
X-CosmoCall-QueueName 
Name of the queue to which call is to be routed 
(recommended). 
If this header is not in the database, MCS routes to the default 
queue. If the default queue is not defined for the tenant, the 
callback is rejected and moved to the Rejected Callback folder.</p><p>CCSP APIs Guide - 7.4 
125 
Header field 
Description 
X-CosmoCall-ScheduleTime 
Callback schedule time, in.NET parseable format (required). 
X-CosmoCall-
SegregationGroupID 
Enables segregation of callback items by group in Message 
View. 
Note 
From CCSP 7.3.x onward, personal callbacks scheduled without 
the SegregationGroupID are treated as non-personal 
callbacks. 
X-CosmoCall-SkillsNames 
List of skills assigned to call, separated by semicolon. 
For example, "s1;s2”</p><p>CCSP APIs Guide - 7.4 
126 
Sample script 
The following script uses some of the headers described above. 
' Reference KB: https://msdn.microsoft.com/en-us/library/ 
  ms526453(v=exchg.10).aspx 
 
Const cdoSendUsingPickup = 1  
Const cdoSendUsingPort = 2 'Must use this to use Delivery Notification 
Const cdoBasic = 1 ' clear text 
Const cdoNTLM = 2 'NTLM 
 
Dim objConf 
Set objConf = CreateObject("CDO.Configuration") 
With objConf 
  .Fields("http://schemas.microsoft.com/cdo/configuration/sendusing") = 
cdoSendUsingPickup 
  .Fields.Update 
End With 
 
Dim objMessage 
Set objMessage = CreateObject("CDO.Message") 
With objMessage 
.Configuration = objConf 
.From = "svccosmocall@pj12.loc" 
.To = "callback@defTenant.net" 
.Fields("urn:schemas:mailheader:X-CosmoCall-Message") = "Callback sent via 
automatic script" 
.Fields("urn:schemas:mailheader:X-CosmoCall-CallerName") = "Customer Name" 
.Fields("urn:schemas:mailheader:X-CosmoCall-AttachmentUrl") = 
"http://global.sales.domain.com/callback" 
.Fields("urn:schemas:mailheader:X-CosmoCall-SkillsNames") = "s1;s2" 
.Fields("urn:schemas:mailheader:X-CosmoCall-QueueName") = "q1" 
.Fields("urn:schemas:mailheader:X-CosmoCall-OutDialingAddress") = "+1-631-940-
4200" 
.Fields("urn:schemas:mailheader:X-CosmoCall-Option1") = "CUSTOMERID&gt;1234" 
.Fields("urn:schemas:mailheader:X-CosmoCall-Option2") = "ACCOUNTID&gt;5678" 
.Fields("urn:schemas:mailheader:X-CosmoCall-ScheduleTime") = "10:00+02:00" 
.Fields.Update 
.Send</p><p>CCSP APIs Guide - 7.4 
127 
End With 
 
Set objMessage = nothing</p><p>CCSP APIs Guide - 7.4 
128 
Chat extension 
This section contains the following information: 
• 
How to use the chat extension 
• 
Chat extension components 
• 
Interfaces to the chat extension 
 
One of the central components of the CCSP Web Support package is the chat extension that 
enables chat calls to be made from websites. 
The chat extension is an ISAPI extension DLL that runs on your Microsoft IIS Web Server. The 
extension provides a set of APIs that you can use on a webpage to communicate with the CCSP 
ACD. Parameters can be passed to the APIs as either HTML form fields or a URL query.  
The extension maintains a chat conversation for each connected caller. Using the APIs exposed as 
URLs, the webpages can connect and disconnect callers, send messages to the agent, and read the 
chat conversation messages and status. A connection ID is used to identify each chat call. 
How to use the chat extension 
The ChatExtension.dll is installed in the IIS scripts directory, normally c:\inetpub\scripts. If there 
are separate physical directories on your virtual web server, the ChatExtension.dll is installed in 
each one. 
The HTML and JavaScript files must be in a real or virtual \CosmoCall directory. If it is a real 
directory, it must be off the root of the web server. The default path for these components is 
c:\inetpub\wwroot\cosmocall\1033\default. The 1033 portion of the path is for English. For other 
languages, substitute the correct Windows locale ID code. 
The chat extension DLL requires that the \scripts directory has execute privileges. 
You may modify the HTML and JavaScript files to meet your implementation requirements. 
Minimum requirements 
To use the chat extension: 
• 
JavaScript needs to be enabled in the caller's browser, for example, Chrome. 
• 
The directory containing ChatExtension.dll must have ISAPI caching enabled. 
Configuration 
The chat extension uses several entries in the system registry for configuration. Default values are 
established when the extension is first used, so it is not necessary to predefine configuration data.</p><p>CCSP APIs Guide - 7.4 
129 
The following keys are stored on the ACD server in the registry: 
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\CosmoCom\Universe\CurrentVersion\ChatExtension\Parameters 
\[tenant name] 
Registry key 
Type 
Default value 
Description 
ChatAgentNameColor 
String 
#0000FF 
(Blue) HTML color code for the agent name in the 
chat window. 
ChatAgentTextColor 
String 
#0000FF 
(Blue) HTML color code for the agent text in the 
chat window. 
ChatCallerName 
String 
Me 
Name that is displayed in the chat window to 
identify the caller. To use the 
Calling_User_FirstName parameter, leave this 
setting blank. 
ChatSystemMsgColor 
String 
#FF0000 
(Red) HTML color code for the system message in 
the chat window. 
ChatSystemTimeColor 
String 
#FF0000 
(Red) HTML color code for the system message 
time stamp in the chat window. 
ChatSystemTimeFormat 
String 
%H:%M 
Format of system time stamp in chat window. You 
can add :%S for seconds. If you do not want the 
time displayed, leave this setting blank 
ChatUserNameColor 
String 
#000000 
(Black) HTML color code for user name in the chat 
window. 
ChatUserTextColor 
String 
#000000 
(Black) HTML color code for the user text in the chat 
window. 
ChatWindowBackground
Color 
String 
#FFFFFF" 
background="/Cosmocall/spiral.jpg 
(White) HTML color code for the chat window 
background.</p><p>CCSP APIs Guide - 7.4 
130 
Registry key 
Type 
Default value 
Description 
ChatWindowRefreshPeri
od 
DWORD 
5 
The number of seconds between automatic 
refreshes of the chat window. 
ChatWindowRowFormat 
String 
&lt;TR&gt;&lt;TD&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 
&amp;nbsp;&amp;nbsp;&lt;/TD&gt;&lt;TD valign="top"&gt; 
&lt;FONT Size="1" COLOR="%s" 
FACE="Verdana, Arial"&gt;%s&lt;/FONT&gt;&lt;/TD&gt; 
&lt;TD valign="top" width="180"&gt;&lt;FONT 
size="1" 
FACE="Verdana, Arial" 
COLOR="%s"&gt;%s&lt;/font&gt; 
&lt;/TD&gt;&lt;/TR&gt;  
Format (font, size) of text in chat window. 
ChatWindowSplit 
DWORD 
80 
Percent of chat table for the text column versus the 
name column. 
DisplayFrame 
String 
_blank 
When the agent pushes a URL to the caller, the 
caller's browser opens that URL in the named 
window. The default name, "_blank", causes the 
browser to always open a new window. Otherwise, 
it always goes to the same named window in 
Netscape browsers. 
StatusBackgroundColor 
String 
#FFFFFF" 
background="/Cosmocall/statusBack.gif 
(Gray) HTML color code for the status window 
background. 
StatusMsgColor 
String 
#000000 
(Black) HTML color code for the status line message 
text. 
StatusRefreshPeriod 
DWORD 
5 
The number of seconds between automatic 
refreshes of the status line window.</p><p>CCSP APIs Guide - 7.4 
131 
Registry key 
Type 
Default value 
Description 
StatusRowFormat 
String 
&lt;TR&gt;&lt;TD valign=\"top\"&gt;&lt;FONT 
Size=\"1\" 
FACE=\"Verdana, Arial\"&amp;nbsp; 
COLOR=\"%s\"&gt;%s&lt;/FONT&gt;&lt;/TD&gt; 
&lt;TD align=\"right\" width=\"25%%\"&gt; 
&lt;FONT Size=\"1\" FACE=\"Verdana, 
Arial\" 
COLOR=\"%s\"&gt;%s&lt;/font&gt;&lt;/TD&gt;&lt;/TR&gt;  
Format (font, size) of text in status line. 
TimeFormat 
String 
hh:mm tt 
  
URLGo 
DWORD 
1 
Displays pushed URLs in URL frame of chat window. 
URLShow 
DWORD 
1 
Shows URL string in chat conversation frame on 
caller's browser. 
UserTimeoutPeriod 
DWORD 
25 
The number of seconds without contact before the 
chat extension deletes a user's connection. 
Chat extension components 
The chat extension consists of these components. 
Component 
File 
Description 
Server 
ChatExtension.dll  
The chat extension DLL that runs on your Microsoft IIS Web Server. 
HTML template file 
used during normal 
operation 
ChatExtensionClose.txt 
This template defines a form for disconnecting from the contact center. The 
Close ISAPI command is used in this form. 
HTML file used to 
report error conditions 
ChatExtensionDefault.htm 
This page is returned when an ISAPI URL name that is not recognized by the 
chat extension DLL is accessed. This does not occur during normal use.</p><p>CCSP APIs Guide - 7.4 
132 
Component 
File 
Description 
HTML template file 
used during normal 
operation 
ChatExtensionFrame.txt 
After a successful connection is made using the chat extension with the 
Connect command, the chat extension sends a dynamically generated page 
to the caller's browser. This page is based on the ChatExtensionFrame.txt 
template file. 
The template file is processed by the chat extension and is delivered with a 
connection ID for the caller. The dynamically generated page is frames-
based and defines a user input frame, a status line frame, and a chat 
conversation frame. Other frames may be added if needed. 
The user input frame initially references the ChatExtensionNoInput.htm 
page. When an agent takes the call, the chat extension changes the 
reference to a dynamically generated page based on the 
ChatExtensionInput.txt template file. 
The status line frame directly references the Status command. The chat 
extension returns a single line with the current status and time. The 
returned data includes an HTML Refresh command, so that the status line 
requests updates as needed. 
The chat conversation frame directly references the Read command. The 
chat extension returns the conversation data. 
The close frame references a dynamically generated page based on the 
ChatExtensionClose.txt template file. 
HTML Template file 
used during normal 
operation 
ChatExtensionInput.txt 
This template defines a form for sending user entered text to the agent and 
another form for closing the connection to the chat extension. The Write 
ISAPI command is used in this frame. 
HTML file used to 
report error conditions 
ChatExtensionInternalError.ht
m 
This page is returned if an internal error is detected in the chat extension. 
Currently, this can only occur during Connect if there is not enough memory 
available to create a connection ID for the user.</p><p>CCSP APIs Guide - 7.4 
133 
Component 
File 
Description 
HTML file used to 
report error conditions 
ChatExtensionInvalidConnecti
onID.htm 
This page is returned when the Write, Escalate, or Close APIs are used, and 
the connection ID is not recognized by the chat extension. This should not 
occur during normal use because the Close API causes the connection ID to 
expire. 
HTML file used during 
normal operation 
ChatExtensionNoInput.htm 
This page defines the user entered text input window before the caller is 
actually connected. There is no Send button. 
HTML file used to 
report error 
conditions   
ChatExtensionNotConnected.
htm 
This page is returned when the Read, Write, Escalate, or Close APIs are used 
when the user is not connected to a chat session using the chat extension. 
Web Server 
ChatExtensionUnsupportedBr
owser.htm 
This page provides notification about an unsupported browser. 
HTML file used during 
normal operation 
ChatExtensionWrapUp.htm 
This page displays a message or URL after the caller closes the connection. 
JS file  
ChatScrollScript.js 
This script is sent during Chat message refreshes. It is used to put new 
messages at the bottom of the chat conversation frame. 
JS file 
DisconnectedScript.js 
This script is sent once, during status message refreshes, when a disconnect 
is detected. It contains two substitutable parameters. The first, %1, sets the 
location of the input window to the NoInput HTML file (alias of 
ChatExtensionNoInput.htm). The second, %2, sets the location of the 
disconnect frame to the Wrapup HTML file (alias of 
ChatExtensionWrapup.htm).</p><p>CCSP APIs Guide - 7.4 
134 
Component 
File 
Description 
JS file 
OpenWindowScript.js 
This script is sent when the user connects. It is used to determine whether 
the chat opens in a new window or in the existing window in which the caller 
placed the call. 
If you want to open a new window, use %1, which provides the reference to 
the method of ChatExtension.dll, which returns the content of the new 
window. 
If you want to use the existing window, use an empty file that just has %2 in 
it. The content of the HTML page is then displayed in the existing window. 
Web Server 
Phrases.txt 
This is the translation file for ChatExtension.dl. 
JS file 
PushUrlScript.js 
This script is sent when the agent pushes a URL to the user. It contains two 
substitutable parameters. The first, %1, is used by the script as the name of 
the window to open, and the second, %2, is used as the URL to direct that 
window to. 
JS file 
RefreshScript.js 
This script is sent during Status message refreshes. It contains no 
substitutable parameters and it causes the main chat window to reload. 
JS file 
RingScript.js 
This script is sent once, during Status message refreshes, when an agent 
has taken the call and the caller needs to be notified. It contains three 
substitutable parameters. The first, %1, and second, %2, are both 
substituted with Ringout.wav so the refresh can audibly signal the browser. 
The third, %3, sets the location of the input frame to the Input HTML file, 
generated from the ChatExtensionInput.txt.</p><p>CCSP APIs Guide - 7.4 
135 
Interfaces to the chat extension 
This section contains the following information: 
• 
Access the interfaces 
• 
Connect 
• 
Read 
• 
Status 
• 
Write 
• 
Close 
• 
Registry entries 
• 
Diagnostic function 
Access the interfaces 
The interfaces to the chat extension are accessed in the same way as standard CGI web server 
scripts. For example, to connect, the browser must reference the URL: 
http://server/scripts/chatextension.dll?Connect? 
This is normally accomplished using the generated ASP script. 
If you are not using the generated ASP scripts and are writing your own forms, you have to do this 
through an HTML form. The required parameters for the Connect function are stored in the form 
fields, like the methods described in Options for launching calls, with one exception: user-defined 
parameters require special formatting. You need to supply the parameter count and values 
described below. If you want to pass optional, user-defined parameters, use the following. 
Parameter 
Description 
OptionalParameterCount 
Defines how many OptionalParameters are included, for example: 
&lt;input type="hidden" name="OptionalParameterCount" 
value="2"&gt; 
OptionalParametern 
(base n = 0) 
Used for custom parameters, for example: 
&lt;input type="hidden" name="OptionalParameterCount" 
value="2"&gt; 
&lt;input type="text" name="OptionalParameter0" 
value="customer_id,123"&gt; 
&lt;input type="text" name="OptionalParameter1" 
value="Ticket,188"&gt;</p><p>CCSP APIs Guide - 7.4 
136 
For example: 
&lt;html&gt; 
&lt;body&gt; 
&lt;form action="/scripts/chatextension.dll?command=connect" method="GET" 
name="ChatForm"&gt; 
&lt;input type="hidden" name="Call_Center_Address" value="ics.yoursite.com"&gt; 
&lt;input type="hidden" name="Call_Center_Name" value="NY Sales Center"&gt; 
&lt;input type="hidden" name="Calling_User_Skills" value="English"&gt; 
&lt;input type="text" name="Calling_User_FirstName" value=""&gt; First Name&lt;BR&gt; 
&lt;input type="text" name="Calling_User_LastName" value=""&gt; Last Name&lt;BR&gt; 
&lt;input type="text" name="Calling_User_HardMessage" value="Sales question"&gt; 
Message&lt;br&gt; 
&lt;input type="hidden" name="OptionalParameterCount" value="2"&gt; 
&lt;input type="text" name="OptionalParameter0" value="customer_id,123"&gt; 
&lt;input type="text" name="OptionalParameter1" value="Ticket,188"&gt; 
&lt;p&gt;&lt;input type="submit" value="Start Chat"&gt;&lt;/p&gt; 
&lt;/form&gt; 
&lt;/body&gt; 
&lt;/html&gt; 
 
This form collects the caller's name and a message to be sent to the agent. The contact center 
address, name, and skill set are established in hidden fields since these are not caller defined. 
If you want to use the POST method, you must change the method and action and add a command 
field as shown below: 
&lt;form method="POST" action="/scripts/ChatExtension.dll"&gt; 
&lt;input type="hidden" name="command" value="connect"&gt; 
Connect 
The Connect URL uses the form fields listed in the Call parameters section: 
• 
For POST method this is 
path/chatextension.dll?connect 
• 
For GET method this is 
path/chatextension.dll?command=connect 
 
When a successful connection is established, the chat extension returns the contents of the file 
dynamically generated from the ChatExtensionFrame.txt template file to the caller and sends an 
HTML page with an embedded connection ID used to maintain a link between the caller and the 
contact center.</p><p>CCSP APIs Guide - 7.4 
137 
Read 
The Read URL is used by the file dynamically generated from the ChatExtensionFrame.txt template 
file to fill in the chat conversation frame. The Read URL uses the connection ID There are no other 
inputs. The chat extension returns an HTML formatted table of the conversation text and a Refresh 
command. 
Status 
The Status URL is dynamically generated from the ChatExtensionFrame.txt template file to fill in the 
status line frame. The Status URL uses the connection ID. There are no other inputs. The chat 
extension returns an HTML formatted table of the status and a Refresh command. This table 
contains a single row. 
Write 
The Write URL uses the connection ID and transmits the content of the form field named text to the 
agent. If there is more than one field named text, both are transmitted. The chat extension returns 
the contents of a file dynamically generated by the ChatExtensionInput.txt template file, which 
effectively clears the caller input. 
Close 
The Close URL is used by a file dynamically generated by the ChatExtensionClose.txt template file 
for the Disconnect button. The Close URL uses the connection ID. There are no other inputs. The 
chat extension returns the contents of the ChatExtensionWrapup.htm file.</p><p>CCSP APIs Guide - 7.4 
138 
Registry entries 
For reference only. 
The first time ChatExtension.dll is loaded, to keep functions with files, it adds the following registry 
entries to HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node \CosmoCom 
\ChatExtension\Files: 
 
"OpenWindowScript"="/CosmoCall/OpenWindowScript.js" 
"MainFrame"="/CosmoCall/ChatExtensionFrame.txt" 
"RefreshScript"="/CosmoCall/RefreshScript.js" 
"DisconnectedScript"="/CosmoCall/DisconnectedScript.js" 
"Wrapup"="/CosmoCall/ChatExtensionWrapup.htm" 
"NoInput"="/CosmoCall/ChatExtensionNoInput.htm" 
"RingScript"="/CosmoCall/RingScript.js" 
"Input"="/CosmoCall/ChatExtensionInput.txt" 
"Ringout"="/CosmoCall/Ringout.wav" 
"NotConnected"="/CosmoCall/ChatExtensionNotConnected.htm" 
"InvalidConnection"="/CosmoCall/ChatExtensionInvalidconnectionID.htm" 
"Default"="/CosmoCall/ChatExtensionDefault.htm" 
"InternalError"="/CosmoCall/ChatExtensionInternalError.htm" 
"PushUrlScript"="/CosmoCall/PushUrlScript.js" 
"ChatScrollScript"="/CosmoCall/ChatScrollScript.js" 
Diagnostic function 
CCSP has a diagnostic function built into the chat extension that: 
• 
Allows you to view key registry entries 
• 
Checks that the required files are readable 
• 
Lists basic information about connected users 
 
To display this information in your browser, type http://&lt;path&gt;/chatextension.dll?diagnose? where 
&lt;path&gt; indicates the path to the ChatExtension.dll.</p><p>CCSP APIs Guide - 7.4 
139 
Customize the chat window 
This section contains the following information: 
• 
Increasing the user input frame 
• 
Showing caller and agent names 
 
The following diagram shows the components of the chat extension frame. 
 
Increase the user input frame 
By default the user input frame contains a single text entry line. This allows the caller to type text 
and press Enter to send the text. The maximum length of this field is 1024 characters. 
Optionally, you can make the input area a multi-line entry. This allows large chunks of text to be 
copied and pasted into the entry field. The caller then has to click Send to send the text. The Enter 
key does not send text because it is used to move to the next line in the text entry area. 
To make the input area a multi-line entry: 
1. 
Change the following line in the ChatExtensionInput.txt and ChatExtensionNoInput.htm files: 
From: 
document.write("&lt;input type="text/" size=/"size=/"",InputLen,"/" 
maxlength=/"1024/" name=/"text/" style=/"background-image: 
url('/CosmoCall/typehere.bmp')/"&gt;");</p><p>CCSP APIs Guide - 7.4 
140 
To: 
document.write("&lt;textarea rows=/"2/" name=/"text/" cols=/"40/" 
style=/"background-image: url('/CosmoCall/typehere.bmp')/"&gt;&lt;/textarea&gt;"); 
The textarea rows parameter can be larger than 2. 
2. 
Increase the value of the InputSize parameter in the ChatExtensionFrame.txt file: 
InputSize = 70; 
if (bAppName.indexOf("Netscape") &gt;= 0) InputSize = 85; 
document.write("&lt;frameset rows=/"*,40,",InputSize,",25/" border=/"0/" 
frameborder=/"no/"&gt;"); 
The frameset rows parameter controls the left-side of the chat window: 
frameset rows=/"*,40,",InputSize,",25/" 
In the above example: 
o 
* = the chat conversation frame 
o 
40 = the Hang Up and Help button frame. 
o 
InputSize = the user input frame (where you type the text to send). 
o 
25 = the status line frame. 
Show caller and agent names 
To configure the chat window to show actual caller and agent names: 
1. 
Open the resource file ..\Inetpub\wwwroot\CosmoCall\&lt;LocaleID&gt;\&lt;TenantName&gt;\Phrases.txt 
The last lines of this file contain the following: 
159 "Caller" 
 Me 
160 "Rep" 
Rep 
2. 
Replace Me and Rep with arbitrary strings that you want to be presented to the caller when a 
chat takes place between the caller and the agent. You can use %1 and %2 to indicate caller or 
agent first and last name. 
The following example displays the full name of the caller but uses Rep instead of the agent 
name: 
159 "Caller" 
%1 %2 
160 "Rep" 
Rep</p><p>CCSP APIs Guide - 7.4 
141 
Parameters 
This section contains the following information: 
• 
Options for launching calls 
• 
Call parameters 
• 
ASP script parameters 
 
To launch email and chat calls, a number of parameters must be sent to the ACD server. These 
parameters are case sensitive and need to match what you are using in your URL query, form, or 
cookie as well as what you entered in the Configurator. 
Options for launching calls 
There are three methods you can use to send parameters to the ACD server to launch a call: 
• 
URL query 
• 
Form 
• 
Cookie 
 
You can also automate most of the process. See Automated method. 
URL query 
The query string must look like the following: 
path/call.asp?ret=query&amp;Callertype=HTML&amp;parameter=value&amp;parameter=value... 
The parameters and values are explained in Call parameters. Be sure to match the case because 
the command is case sensitive. If parameters are not found, the defaults from the ASP script are 
used. 
Form 
The form method uses a form to gather caller information. A form must use an HTTP POST. 
The form should contain the following: 
&lt;form method="POST" action="call.asp?ret=form"&gt; 
&lt;input type="text" name="parameter" value="value"&gt;... 
 
The parameters and values are explained in Call parameters. If parameters are not found, the 
defaults from the ASP script are used.</p><p>CCSP APIs Guide - 7.4 
142 
Here is an example of an HTML page that may be submitted: 
&lt;form action="/scripts/call.asp?ret=form" method="POST" name="ChatForm"&gt; 
&lt;input type="hidden" name="Call_Center_Address" value="ics.yoursite.com"&gt; 
&lt;input type="hidden" name="Call_Center_Name" value="NY Sales Center"&gt; 
&lt;input type="hidden" name="Calling_User_Skills" value="English"&gt; 
&lt;input type="text" name="Calling_User_FirstName" value="&gt; First Name&lt;BR&gt; 
&lt;input type="text" name="Calling_User_HardMessage" value="Sales question"&gt; 
Message&lt;br&gt; 
&lt;p&gt;&lt;input type="submit" value="Start Chat"&gt;&lt;/p&gt; 
&lt;/form&gt; 
Cookie 
The cookie method is best to use when you have customer information already in a database from 
a shopping cart or help desk application or if you can gather information from pages where the 
caller has visited on your website. Cookies can be set on any page of your website. The cookie 
name must be the same as the parameter name. For a complete list of parameter names, see Call 
parameters. 
The cookies can be read by the ASP script: 
call.asp?ret=cookie 
Automated method 
To help you automate much of the process of gathering parameters and passing them to the ACD, 
CCSP provides the following method which can be used on any ASP page: 
1. 
Put the following Include statement on the ASP page where you want to set parameters: 
&lt;!--#Include File="path/setparams.txt"--&gt; 
2. 
Call the Setparams function wherever you want to begin setting a cookie. 
Setparams("parameter","value") 
3. 
Put the following Include statement on your ASP webpage where you want the CCSP logo to 
appear: 
&lt;!--#Include File="path/cookiecaller.txt"--&gt; 
 
This inserts the CCSP logo and link on your webpage, reads the parameters from the cookie, and 
creates a URL query. If parameters are not found, the defaults from the ASP scripts are used.</p><p>CCSP APIs Guide - 7.4 
143 
Call parameters 
Call parameters are case sensitive and need to match what you are using in your URL query, form, 
or cookie as well as what you entered in the Configurator. 
Parameter 
Description 
Required 
Call_Center_Name 
Logical name of contact center. 
Yes 
Call_Center_Address 
ICS IP address or FQDN. 
Yes 
Call_Center_QueueName 
Name of queue to place caller in. This name 
must match a queue on the ACD. 
Yes 
Call_Center_Port 
Port for ACD server communication. 
Yes 
Calling_User_PhoneType 
Phone type (string). Valid values are 
NETMEETING or CHAT. 
Yes 
Calling_User_URL 
URL to pass to agent. 
No 
Calling_User_Skills 
List of required skills, separated by a plus 
sign (+). 
No 
Calling_User_FirstName 
Caller's first name. 
No 
Calling_User_LastName 
Caller's last name. 
No 
Calling_User_IDMode 
Caller identification. 
No 
Calling_User_HardMessage 
Message to send to the agent. 
No 
Calling_User_Initial_URL 
URL to be displayed in the right frame of the 
chat. 
No 
TQoS 
Number of seconds within which the call 
should be answered. Overrides the TQoS 
configured for the queue. 
No 
No_Agents_Msg 
Message to send caller when no agents are 
logged into the ACD. Overrides the default 
message for such an event. 
No 
No_Agents_URL 
URL to push to caller when no agents are 
logged into the ACD. Overrides the default 
URL for such an event. Must be used with the 
No_Agents_Msg field. 
No</p><p>CCSP APIs Guide - 7.4 
144 
Parameter 
Description 
Required 
DisplayFrame 
Determines which frame is used to display a 
URL pushed from an agent. 
Caution 
Do not Use _self, _parent, or _top as they may 
wipe away the caller to put the URL in the 
current frame. 
No. 
OriginalEmail 
The email address of the customer who sent 
an email. 
No. For web-
generated email 
only. 
SupportStaffEmail 
The return address for agents replying to 
emails that come through chats. This field 
overrides the value of the Reply to Address 
field configured in the Message 
Communication System (MCS). 
No. For web-
generated email 
only. 
MailUID 
Unique ID for email message. Stored in log 
database 
No. For email only. 
Optional parameters 
User-defined parameters can also be passed 
to the ACD Server. The easiest way to define 
these parameters is by using the 
Configurator. If you are not using the 
generated ASP scripts, see Chat extension. 
For information about optional parameters 
used in email, see Send external callbacks via 
SMTP. 
No 
ASP script parameters 
You need to use two special parameters with the ASP scripts: 
1. 
ret= is used to indicate the method being used to send parameters to the ACD server. The 
valid inputs are query, form, and cookie. 
2. 
Callertype=HTML</p></section><section><meta content="CCSP UI Help - Agent Part 2 - Section 3: Contact Center:  
Service Provider  
CCSP UI CSS 
Customization Guide 
Version 7.3.5" name="description"/><h2>Contact Center:  
Service Provider  
CCSP UI CSS 
Customization Guide 
Version 7.3.5</h2><p>CCSP-UICCG-735-R2-12/2023 
Contents 
1: Intro .............................................................................................................................................3 
What’s new ................................................................................................................................................. 3 
Legal disclaimer ......................................................................................................................................... 3 
Support ....................................................................................................................................................... 3 
2: CCSP UI CSS structure ................................................................................................................4 
3: CSS customization ......................................................................................................................5 
AdminPoint ................................................................................................................................................. 5 
4: Customization options ...............................................................................................................7 
Complete facelift to the .css files ............................................................................................................ 7 
Customization using custom.less ........................................................................................................... 7 
Specific change to a single CSS property ............................................................................................... 8 
5: Example .......................................................................................................................................9 
Appendix A: Compiling a .less file to a .css file ......................................................................... 10 
Installing the Less compiler ................................................................................................................... 10 
Creating the .css file ................................................................................................................................ 11</p><p>CCSP UI CSS Customization Guide - 7.3 
3 
1: Intro 
This document is for the UI designers responsible for customizing the CCSP UI (previously called 
TouchPoint) look and feel by using custom .css files. 
The UI designer must possess working knowledge and skills to adapt colors and styles in CSS 
format, and to compile .less files to .css files.  
What’s new 
Version 7.3.5 
• 
TouchPoint is now called CCSP UI. 
Legal disclaimer 
This document is governed by the terms of the software license agreement and applicable contract 
(including addendums) entered into with Enghouse. 
Support 
To submit comments or questions about the content in this document, please open a case with 
Enghouse Support.</p><p>CCSP UI CSS Customization Guide - 7.3 
4 
2: CCSP UI CSS structure  
Because CCSP UI  is made up of gadgets, the CSS structure is designed so that each gadget has its 
own .css file.   
The styles folder under Server Components\TouchPoint\Content\styles, contains .less and .css files for 
all the system gadgets and functions, such as callBack.less, chat.less, email.less, assist.less, and 
login.less. 
To enable a common look and feel and make the files simpler to use, some .less files contain 
variables. You can find these variables in custom.less.  
For example, the OK button properties are:  
@okButton-color: #7dbe47; 
@okButton-disabled-color: #cad7e6; 
@okButton-hover-color: #a8df7c; 
@okButton-hover-disabled-color: #E4E4E4; 
@okButton-active-color: #649938; 
 
Changing these properties in the custom.less file changes all the OK buttons in CCSP UI.</p><p>CCSP UI CSS Customization Guide - 7.3 
5 
3: CSS customization  
You customize the CCSP UI look and feel by loading a customized .css file.  
To do this, you copy the styles folder and edit it. You then use AdminPoint to load a single.css file 
that includes all the required changes.  
Note 
• 
The very first time an agent logs on to CCSP UI, it uses the default login.css. CCSP UI saves the 
tenant ID provided by the agent in local storage on the client PC. When the agent logs on 
again, CCSP UI uses the branded login.less. 
• 
Changes to the LookAndFeel path in AdminPoint affect CCSP UI only when the agent logs on 
again. 
• 
If the LookAndFeel path in AdminPoint is invalid, the default CCSP UI .css file is used. 
• 
There is a delay of a few seconds while the loggedout.js and ClientInstaler.js pages load, during 
which the default blue screen appears. 
AdminPoint  
In AdminPoint, on the Gadgets subtab, click Settings. In the Settings dialog box, in Look and Feel, 
point to the customization .css file.  
The .css file has the same classes and overrides the default CCSP UI design.  
As with any AdminPoint definition, the customization .css file can be set on 
Landlord/Tennant/Group/Roll level and be overridden in any lower level.</p><p>CCSP UI CSS Customization Guide - 7.3 
6 
Note 
• 
The path is relative to CosmoCom\Server Components\TouchPoint. To avoid path errors, we 
recommend that you locate your new styles folder under Touchpoint\Content as in the image 
above.  
• 
To import images to your custom stylesheet, copy the folder CosmoCom\Server 
Components\TouchPoint\Content\images to the directory above your work directory. This action 
is required because some of the .less files contain imports from ../images.</p><p>CCSP UI CSS Customization Guide - 7.3 
7 
4: Customization options 
 
Note 
• 
A lookAndFeel.less file is provided in the styles folder. This file contains imports for all CCSP UI 
.less files. Compiling this file generates a .css file containing all the elements. 
• 
The logo appears in the login.css and helpAboutTouchPoint.css files. All references are included 
in the logo.less file. 
 
The customization options are: 
• 
Complete facelift to the .css files — use this option for a large scale customization that involves 
changes in many .css files. 
• 
Customization using custom.less — use this option to change any of the common properties 
defined in the custom.less file that will affect all references to this property. 
• 
Specific change to a single CSS property — use this option for a very specific change to any of 
the properties in one of the .less files used by CCSP UI. 
Complete facelift to the .css files 
To perform a complete facelift to the .css files: 
1. 
Copy all files in the styles folder to a working directory. 
2. 
Change any of the .less files. 
3. 
Compile lookAndFeel.less to a .css file to generate the customization .css file. (See Appendix A: 
Compiling a .less file to a .css file.) 
4. 
Set the LookAndFeel property in AdminPoint to point to the compiled lookAndFeel.css file.   
Customization using custom.less 
To perform a customization using custom.less: 
1. 
Copy all files in the styles folder to a working directory. 
2. 
Change custom.less. For example, change a background color or the OK or Cancel buttons. 
3. 
Compile lookAndFeel.less to a .css file because the variables may be included in various .less files 
that now also require a recompilation. 
4. 
Set the LookAndFeel property in AdminPoint to point to the compiled lookAndFeel.css file.</p><p>CCSP UI CSS Customization Guide - 7.3 
8 
Specific change to a single CSS property 
Note 
Every .less file change requires .css compilation of the changed file and all affected files. For 
example, if you change a Less variable, you must compile all files in which the variable is used. 
 
To perform a specific change to a single CSS property: 
1. 
Copy the .less file you want to modify from the styles folder to a working directory. 
2. 
Modify the .less file as required. 
3. 
Compile the modified .less to .css file to generate the customization .css file. (See Appendix A: 
Compiling a .less file to a .css file.) 
4. 
Set the LookAndFeel property in AdminPoint to point to the compiled .css file.</p><p>CCSP UI CSS Customization Guide - 7.3 
9 
5: Example 
To customize the OK button using custom.less: 
1. 
Copy the styles folder to &lt;cssFolder&gt; under 
 ..\CosmoCom\Server Components\TouchPoint\Content.   
2. 
In custom.less, change @okButton-color to another color, for example: 
@okButton-color: blue; 
3. 
Compile lookAndFeel.less to a .css file.  
4. 
Upload this file to AdminPoint.  
 
Before: 
 
 After:</p><p>CCSP UI CSS Customization Guide - 7.3 
10 
Appendix A: Compiling a .less file to a 
.css file 
You can use the free Less compiler to compile a .less file to a .css file. After installing node.js, you can 
install node.js modules via Node Package Manage (NPM). 
Installing the Less compiler 
To install the Less compiler: 
1. 
Install node.js from https://nodejs.org/en/. 
2. 
Install Less globally by opening a cmd window as administrator and running the following 
command: 
$ npm install –g less</p><p>CCSP UI CSS Customization Guide - 7.3 
11 
Creating the .css file 
To create the .css file: 
1. 
Open npm cmd as administrator on your CSS custom folder. 
2. 
Create the css file by running the following command: 
lessc lookAndFeel.less lookAndFeel.css --relative-urls -–js 
 
A lookAndFeel.css file is created in the same folder.</p></section><section><meta content="CCSP UI Help - Agent Part 2 - Section 4: Contact Centre:  
Service Provider 
CCSP UI Integrations Guide 
Version 7.3 and 7.4" name="description"/><h2>Contact Centre:  
Service Provider 
CCSP UI Integrations Guide 
Version 7.3 and 7.4</h2><p>CCSP-UIIG-73/74-R3-02/2024 
Contents 
1: Intro .............................................................................................................................................7 
What’s new ................................................................................................................................................. 7 
Legal disclaimer ......................................................................................................................................... 7 
Support ....................................................................................................................................................... 7 
2: Overview .....................................................................................................................................8 
3: Events ..........................................................................................................................................9 
Overview ..................................................................................................................................................... 9 
Publishing and subscribing to events .................................................................................................. 10 
window.app.PubSub ....................................................................................................................... 11 
eventServiceWrapper ..................................................................................................................... 13 
subscriberBase ................................................................................................................................ 13 
Event lists .................................................................................................................................................. 14 
Server events ................................................................................................................................... 14 
UI event list ...................................................................................................................................... 14 
UI command list .............................................................................................................................. 18 
Custom events ......................................................................................................................................... 22 
Custom CCSP UI Connector events .............................................................................................. 22 
4: CCSP UI AngularJS services .................................................................................................... 23 
agentServiceWrapper ............................................................................................................................. 23 
Properties ......................................................................................................................................... 23 
Functions .......................................................................................................................................... 23 
customCSSService ................................................................................................................................... 24 
Properties ......................................................................................................................................... 24 
Functions .......................................................................................................................................... 24 
DALService ................................................................................................................................................ 25 
Properties ......................................................................................................................................... 25 
Functions .......................................................................................................................................... 25 
dialogService ............................................................................................................................................ 26 
Properties ......................................................................................................................................... 26 
Functions .......................................................................................................................................... 26 
dialService ................................................................................................................................................. 27 
Properties ......................................................................................................................................... 27 
Functions .......................................................................................................................................... 27 
localSettingsService ................................................................................................................................ 30 
Properties ......................................................................................................................................... 30 
Functions .......................................................................................................................................... 30</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
3 
loggerService ........................................................................................................................................... 32 
Properties ......................................................................................................................................... 32 
Functions .......................................................................................................................................... 32 
oidcService ................................................................................................................................................ 33 
Properties ......................................................................................................................................... 33 
Functions .......................................................................................................................................... 33 
translationService .................................................................................................................................... 38 
Properties ......................................................................................................................................... 38 
Functions .......................................................................................................................................... 38 
viewModelStoreService .......................................................................................................................... 40 
Properties ......................................................................................................................................... 40 
Functions .......................................................................................................................................... 40 
voipService................................................................................................................................................ 41 
Properties ......................................................................................................................................... 41 
Functions .......................................................................................................................................... 41 
5: Gadgets .................................................................................................................................... 44 
Overview ................................................................................................................................................... 44 
Example gadgets ............................................................................................................................ 44 
What is a gadget? ........................................................................................................................... 44 
Gadget capabilities ......................................................................................................................... 44 
Gadget types ................................................................................................................................... 45 
Gadget creation ....................................................................................................................................... 46 
Standard or functional gadget?.................................................................................................... 46 
Demonstration gadgets ................................................................................................................. 46 
CCSP AdminPoint ............................................................................................................................ 47 
Adding the Demo Chat Prompt functional gadget .................................................................... 47 
Adding the Demo CRM standard gadget .................................................................................... 48 
Adding the gadgets to a role ........................................................................................................ 48 
Testing the gadgets ........................................................................................................................ 49 
Gadget refresh ................................................................................................................................ 49 
Gadget properties ................................................................................................................................... 50 
Default properties ........................................................................................................................... 50 
Adding custom properties ............................................................................................................. 53 
Standard gadget development ............................................................................................................. 54 
Standard gadget structure ............................................................................................................ 54 
Standard gadget as an AngularJS module .................................................................................. 55 
Functional gadget development ........................................................................................................... 59 
Functional gadget code structure ................................................................................................ 59 
Using CCSP UI services and objects ...................................................................................................... 61 
Subscribing to events ..................................................................................................................... 61 
Publishing events ............................................................................................................................ 62 
Accessing the Agent object ........................................................................................................... 63</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
4 
Making calls ..................................................................................................................................... 65 
General call handling ..................................................................................................................... 66 
Transferring calls ............................................................................................................................ 70 
Attended transfer and conferencing ........................................................................................... 80 
Multiple call handling ..................................................................................................................... 83 
Chat call handling ........................................................................................................................... 87 
Email call handling .......................................................................................................................... 92 
Wrapping up calls ......................................................................................................................... 107 
Raising alerts and prompts ......................................................................................................... 108 
System gadget customization ............................................................................................................. 110 
AngularJS Directives ..................................................................................................................... 110 
Overriding CCSP UI directives ..................................................................................................... 110 
Overriding CCSP UI HTML only ................................................................................................... 112 
Overriding CCSP UI CSS ............................................................................................................... 113 
Location of CCSP UI directives .................................................................................................... 115 
Managing Release updates to CCSP UI directives ................................................................... 115 
Reading ConfigItem data ..................................................................................................................... 116 
Example ConfigItem ..................................................................................................................... 116 
Helper Functions ........................................................................................................................... 118 
Extracting data from a ConfigItem ............................................................................................ 121 
Standard gadget properties ................................................................................................................ 125 
Accessing properties of a standard gadget .............................................................................. 125 
Adding an example custom property ........................................................................................ 126 
Accessing the custom property in the code ............................................................................. 126 
Overriding a custom property .................................................................................................... 126 
Accessing the custom property object in normal JavaScript .................................................. 126 
windowObject.Gadget properties .............................................................................................. 126 
Gadget instance properties ......................................................................................................... 131 
Standard gadget properties example ....................................................................................... 132 
Changing the default values of the gadget properties ........................................................... 133 
Changing the gadget's default size and position as a floating window .............................. 134 
Changing the gadget's default size and position as a popout window ............................... 135 
Changing the gadget's appearance .......................................................................................... 135 
Changing the title of a gadget instance .................................................................................... 141 
Functional gadget properties .............................................................................................................. 142 
Using custom properties in a functional gadget ..................................................................... 142 
Disabling a functional gadget ..................................................................................................... 144 
Accessing other gadgets and windows .............................................................................................. 145 
Using the GadgetComm object .................................................................................................. 145 
GadgetComm functions ............................................................................................................... 145 
Inter-gadget access example ...................................................................................................... 149 
Using the Controller URL property............................................................................................. 158 
Persisting data between gadgets and logins .................................................................................... 158 
CCSP UI and web storage ............................................................................................................ 159</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
5 
Using viewModelStoreService ..................................................................................................... 159 
Using DALService and localSettingsService .............................................................................. 162 
Saving and loading gadget properties ...................................................................................... 167 
6: Migrating 6.1.X Web Agent integrations ............................................................................. 169 
Legacy Integrations.js in CCSP UI ....................................................................................................... 169 
Integrations gadget structure .................................................................................................... 169 
Adding a 6.1.X integration to CCSP UI ................................................................................................ 171 
Adding the Integrations functional gadget .............................................................................. 171 
Adding the Integrations standard gadget ................................................................................ 172 
6.1.X Integration.js script migration .......................................................................................... 172 
Examples ........................................................................................................................................ 175 
Troubleshooting ............................................................................................................................ 175 
7: Co-browsing integration ...................................................................................................... 176 
Overview ................................................................................................................................................. 176 
Concepts ................................................................................................................................................. 176 
Co-browsing session lifecycle .............................................................................................................. 176 
CCSP co-browsing support .................................................................................................................. 178 
Co-bowsing gadget components ............................................................................................... 179 
CoBrowsingAPI interface ..................................................................................................................... 180 
Session functions .......................................................................................................................... 180 
Gadget controls functions ........................................................................................................... 180 
Initialization functions .................................................................................................................. 181 
Events ............................................................................................................................................. 182 
Writing co-browsing integrations ....................................................................................................... 183 
Configuring the gadget ............................................................................................................... 183 
CoBrowsingImplementation object ........................................................................................... 183 
Implementing the session functions ......................................................................................... 184 
CreateSession implementation .................................................................................................. 184 
Exiting a session ............................................................................................................................ 186 
SwitchController implementation .............................................................................................. 187 
GoToURL implementation ........................................................................................................... 187 
Implementing the gadget control functions ............................................................................ 187 
Raising events ............................................................................................................................... 188 
Co-Browsing gadget properties .......................................................................................................... 189 
Accessing the gadget properties ................................................................................................ 190 
Examples ................................................................................................................................................. 190 
Template ........................................................................................................................................ 190 
Test .................................................................................................................................................. 190 
Surfly ............................................................................................................................................... 191 
Temasys Skylink ............................................................................................................................ 191 
Points to note ......................................................................................................................................... 192</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
6 
8: Screen Recording gadget implementation override ......................................................... 193 
Overview ................................................................................................................................................. 193 
Screen Recording gadget architecture .............................................................................................. 193 
Screen Recording gadget interface .................................................................................................... 195 
Functions ........................................................................................................................................ 195 
Constants ....................................................................................................................................... 196 
Example .......................................................................................................................................... 197 
Screen recording sequence ................................................................................................................. 197 
Screen recording default implementation ........................................................................................ 198 
Overiding the screen recording implementation ............................................................................. 200 
Example .......................................................................................................................................... 201 
Points to note ......................................................................................................................................... 201 
9: Single Sign On Client development ..................................................................................... 202 
Overview ................................................................................................................................................. 202 
Relevance ................................................................................................................................................ 202 
Scope ....................................................................................................................................................... 202 
General SSO concepts ........................................................................................................................... 202 
Single Sign On (SSO) .................................................................................................................... 202 
Auth Server .................................................................................................................................... 202 
Resource Client ............................................................................................................................. 202 
Resource Server ............................................................................................................................ 203 
Access token .................................................................................................................................. 203 
Refresh token ................................................................................................................................ 203 
OpenID Connect (OIDC)............................................................................................................... 203 
Authorization code grant ............................................................................................................. 203 
Refresh token grant ...................................................................................................................... 203 
CCSP UI SSO Concepts .......................................................................................................................... 204 
Basic architecture ......................................................................................................................... 204 
Detailed architecture .................................................................................................................... 205 
CCSP UI Gadget with SSO ..................................................................................................................... 207 
Example gadget with OIDC ......................................................................................................... 208 
Main gadget script (demoSSOGadget.js) .................................................................................. 208 
Gadget OIDC Page (demoOIdc.html) ........................................................................................ 209 
Gadget OIDC Class (demoOidc.js) .............................................................................................. 210</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
7 
1: Intro 
This document is for engineers and developers who need to integrate third-party applications with 
CCSP UI (previously called TouchPoint). A working knowledge of HTML and JavaScript is required. 
Experience with AngularJS is also beneficial. 
What’s new 
Version 7.4 
• 
TouchPoint is now called CCSP UI. 
• 
dialService — changed communicatorContacts description to Teams or your custom 
application. 
• 
oidcService — added this service. 
• 
9: Single Sign On Client development — added this chapter. 
Version 7.3 
• 
Removed references to Internet Explorer. 
• 
Replaced window.onload with angular.element(document).ready. 
• 
8: Screen Recording gadget implementation override — added new chapter. 
Legal disclaimer 
This document is governed by the terms of the software license agreement and applicable contract 
(including addendums) entered into with Enghouse. 
Support 
To submit comments or questions about the content in this document, please open a case with 
Enghouse Support.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
8 
2: Overview 
CCSP UI provides customization features that allow it to be greatly extended and modified by third 
parties. The available integration methods are: 
• 
Integration.js (legacy) 
• 
Ajax API 
• 
Gadgets 
• 
CCSP UI Connector 
 
The following table summarizes the integration methods. 
 
Integration.js 
Ajax API 
Gadgets 
Connector 
Language 
JavaScript 
JavaScript 
JavaScript 
C#/(JavaScript) 
AngularJS 
Yes 
Yes 
Yes 
No 
UI Events 
Yes 
No 
Yes 
No 
AngularJS 
Services access 
Yes 
No 
Yes 
No 
Access to Agent 
object 
Yes 
Yes 
Yes 
No 
Access to Call 
object 
Yes 
Yes 
Yes 
No 
Documentation 
CCSP UI 
Integrations 
Guide 
CCSP APIs Guide 
/CCSP Agent Ajax 
API Reference 
CCSP UI 
Integrations 
Guide 
CCSP UI 
Connector Guide 
 
Table 1: Integration methods summary 
This document provides a reference point for Professional Services, Customer Services, third-party 
engineers and other interested parties who need to add business logic, custom functionality, and 
displays to CCSP UI to integrate it with other applications.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
9 
3: Events 
This chapter contains the following information: 
• 
Overview 
• 
Publishing and subscribing to events 
• 
Event lists 
• 
Custom events 
Overview 
CCSP UI is an Agent GUI written as an AngularJS web app application. It uses the CCSP AJAX API to 
communicate with the Agent Web Server to log in to the Contact Center as an agent or supervisor, 
make and receive calls, view reports, and perform other tasks as required. The interaction between 
CCSP UI, the AJAX API, and Agent WS is driven by requests and events as shown in a simplified form 
in the following diagram. 
 
Figure 1: Interaction between CCSP UI, AJAX, and AgentWS 
CCSP UI uses the AJAX API to make requests to the AgentWS Web Services. Responses to these 
requests are received from AgentWS either synchronously or more typically asynchronously in the 
form of events. The events are distributed to the CCSP UI implementations of the AJAX API 
EventsHandlers and broadcast to the rest of the CCSP UI application using eventServiceWrapper.  
Some events may be handled directly by the Interface classes themselves. For example, the Agent 
class defines default implementations of the LoginSuccessHandler and LoginErrorHandler to</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
10 
process the LoginSuccess and LoginError events respectively. However, the event is still passed to 
the CCSP UI implementation of the LoginSuccessHandler and LoginErrorHandler. 
Publishing and subscribing to events 
There are two objects that can be used to publish and subscribe to events and one higher-level 
object that can be used to manage event subscriptions: 
• 
window.app.PubSub: this is the lowest level object and provides the core functions for 
publishing and subscribing to events. The event-handling functionality is pure JavaScript for it 
to be included in non-AngularJS pages. The CCSP UI app creates one instance of this object. 
• 
eventServiceWrapper: this is an AngularJS service that wraps and abstracts the 
window.app.PubSub object. It is designed to be injected as a service into controllers and 
directives and provides no functionality over and above the window.app.PubSub functions. 
• 
SubscriberBase: this is a JavaScript object that provides simplified management of 
subscriptions. Each subscription to an event should be unsubscribed when it is no longer 
required, otherwise a callback function can be erroneously invoked multiple times. The 
SubscriberBase object keeps a record of all subscriptions and provides a convenience function 
to clear them all in one call.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
11 
window.app.PubSub 
This object contains the following functions. 
clearSubscriptions 
Stop 
This function must never be called by customer integrations. 
 
Purpose 
Removes all subscriptions. Not for use by integrations 
Signature 
clearSubscriptions() 
Parameter 
Type 
Description 
- 
- 
- 
Returns 
- 
- 
getSubscriptionsForEvent 
Purpose 
Returns an array of subscription Ids for the given event and if specified the 
given context 
Signature 
getSubscriptionsForEvent(event, context) 
Parameter 
Type 
Description 
event 
string 
Event name 
context 
string 
Context, for example, call Id or null if not required 
Returns 
Array 
List of subscription Ids for the given event or null if none found 
NewEvent 
Purpose 
Publishes an event with the given context and data and automatically 
outputs a message using the loggerService 
Signature 
NewEvent(event, severity, logMessage, parameters, context) 
Parameter 
Type 
Description 
event 
string 
Event name 
severity 
string 
Warning level of the output. Possible values are defined in Global.js 
in the CCSP APIs Guide 
logMessage 
string 
Text to be output 
parameters 
Any 
Null or any valid JavaScript type or object 
context 
string 
Context, for example, call Id or null if not required 
Returns 
- 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
12 
publish 
Purpose 
Publishes an event with the given context and data 
Signature 
publish(event, context, data) 
Parameter 
Type 
Description 
event 
string 
Event name 
context 
string 
Context, for example, call Id or null if not required 
data 
Any 
Null or any valid JavaScript type or object 
Returns 
- 
- 
subscribe 
Purpose 
Subscribes to a given event name with optional context 
Signature 
subscribe(event, context, callback, priority) 
Parameter 
Type 
Description 
event 
string 
Event name 
context 
string 
Context, for example, call Id or null if not required 
callback 
function 
Callback to invoke when the event is raised. Cannot be null 
priority 
integer 
Priority of this subscriber when event raised with 0 being 
highest 
Returns 
string 
GUID string 
unsubscribe 
Purpose 
Unsubscribes from a given event name with optional context 
Signature 
unsubscribe(subscriptionId) 
Parameter 
Type 
Description 
event 
string 
Event name 
context 
string 
Context, for example, call Id or null if not required 
Returns 
- 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
13 
eventServiceWrapper 
See window.app.PubSub for functions.  
subscriberBase 
This object contains the following functions. 
addSubscription 
Purpose 
Subscribes to a given event name with optional context and stores the 
subscription Id 
Signature 
addSubscription(event, context, callback, priority) 
Parameter 
Type 
Description 
event 
string 
Event name 
context 
string 
Context, for example, call Id or null if not required 
callback 
function 
Callback to invoke when the event is raised. Cannot be null 
priority 
integer 
Priority of this subscriber when event raised with 0 being 
highest 
Returns 
- 
- 
clearSubscriptions 
Purpose 
Removes all subscriptions held by this object. If a context is supplied, removes 
only those subscriptions for that context  
Signature 
clearSubscriptions(context) 
Parameter 
Type 
Description 
context 
string 
Context, for example, call Id or null if not required 
Returns 
- 
- 
removeSubscription 
Purpose 
Unsubscribes from the given event with the optional context 
Signature 
removeSubscription(event, context) 
Parameter 
Type 
Description 
event 
string 
Event name 
context 
string 
Context, for example, call Id or null if not required 
Returns 
- 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
14 
Event lists 
CCSP UI works with three types of events: Server events, UI events, and Client Services events. 
Server events are events that have been received from the AgentWS through the Ajax API. See the 
CCSP APIs Guide for a description of each event and its parameters.  
Note 
Each event is published within CCSP UI using eventServiceWrapper and the parameters are the 
properties of the event object, except where stated. 
 
UI events and commands are raised and consumed by the CCSP UI functionality in response to 
user action or triggered by a server event. They can be used to open and close window. These are 
mainly for internal use. 
Connector events are raised and consumed by Client Services applications such as Client Tray App, 
Communicator App, and Screen Recording. These are received and sent by CCSP UI through the 
CCSP UI Connector and control specific functionality within CCSP UI. 
Server events 
All events received from the server are described in the CCSP Agent Ajax API Reference. 
Stop 
These events must not be published by integrations or custom gadgets. 
UI event list 
The following events are available for integrations to subscribe to. 
Stop 
These events must not be published by integrations or custom gadgets. 
callMenuOpenOrClose 
Trigger 
The call menu has been opened or closed 
Context 
null 
Data 
Object: 
{ 
callMenuVisible (Boolean) 
callMenuWidth (integer) 
gadgetoryWidth (integer) 
}</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
15 
ChatEnded 
Trigger 
A chat call is destructed 
Context 
null 
Data 
Call object 
ChatStarted 
Trigger 
A chat call goes to the "InCall" state or when monitoring of a chat call begins 
Context 
null 
Data 
Call object 
Boolean: indicates that the new chat window grabs the focus 
focusCall 
Trigger 
Call has been selected as the active call card.  
Context 
Call Type 
Data 
Call Id 
popoutWindow_Close 
Trigger 
A pop-out window has been closed 
Context 
null 
Data 
Window Id 
popoutWindow_CloseOnRemoteLogout 
Trigger 
A pop-out window is closed due to a remote logout 
Context 
null 
Data 
Window Id 
popoutWindow_Open 
Trigger 
A pop-out window is opened 
Context 
null 
Data 
Window Id</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
16 
popoutWindow_Popin 
Trigger 
A pop-out window is docked into the main window 
Context 
null 
Data 
Window Id 
windowClosing 
Trigger 
A window is being closed 
Context 
null 
Data 
Window Id 
wrapupWindowClosing 
Trigger 
The WrapUp window is closed 
Context 
Call Id 
Data 
null 
wrapupWindowEnded 
Trigger 
The WrapUp window is closed and its data is being submitted 
Context 
Call Id 
Data 
Object: 
{ 
selectedWrapupCode (integer), 
note (string), 
PDCallbackTime (Date object), 
scheduleCallback (Boolean) 
} 
WrapupWindowIsOpened 
Trigger 
The WrapUp window is being opened 
Context 
Call Id 
Data 
null</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
17 
wrapupWindowSaving 
Trigger 
The WrapUp information is being submitted to the server 
Context 
Call Id 
Data 
Object: 
{ 
selectedWrapupCode (integer), 
note (string), 
PDCallbackTime (Date object), 
scheduleCallback (flag) 
}</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
18 
UI command list 
The following events are available for publishing by integrations 
closeChatApp 
Description  
Closes the Chat window 
Context 
null 
Data 
null 
GetTranslations 
Purpose 
Requests the translation data for the language currently loaded for CCSP UI 
Context 
null 
Data 
null 
GoCallBack 
Purpose 
Displays the Schedule Callback window 
Context 
Call Id 
Data 
null 
GoCallTransfer 
Purpose 
Displays the Call Transfer window 
Context 
Call Id 
Data 
null 
GoRecord 
Purpose 
Toggles the call recording 
Context 
Call Id 
Data 
null 
GoWebCollab 
Purpose 
Starts the Web Collaboration 
Context 
Call Id 
Data 
null</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
19 
GoWrapUp 
Purpose 
Displays the WrapUp window 
Context 
Call Id 
Data 
null 
LogoutAgent 
Purpose 
Starts the Logout process 
Context 
null 
Data 
null 
openAboutTouchPoint 
Purpose 
Opens the About CCSP UI window 
Context 
null 
Data 
null 
openAssistApp 
Purpose 
Displays the Assist window 
Context 
null 
Data 
null 
openChangePassword 
Purpose  
Displays the Change Password window 
Context 
null 
Data 
null 
openChatApp 
Purpose 
Displays the Chat window 
Context 
null 
Data 
null</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
20 
openDefer 
Description  
Opens the Defer window 
Context 
null 
Data 
data 
{ 
  call: Call object 
} 
OpenNewCallDialog 
Description  
Displays the Outgoing Call window 
Context 
null 
Data 
null 
openPreferences 
Description  
Displays the Preferences window 
Context 
null 
Data 
null 
openReportProblem 
Description  
Displays the Report Problem window 
Context 
null 
Data 
null 
openSupervisorApp 
Description  
Displays the Supervisor window. If the Supervisor window is already open, 
specifying an agent Id causes the window to display the page that contains 
the given agent 
Context 
null 
Data 
null 
OR 
Object 
{ 
Id : Agent Config Id 
}</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
21 
openTouchPointHelp 
Description  
Displays the CCSP UI Help window 
Context 
null 
Data 
null 
ShowEmailCall 
Description  
Displays an email call in a new window 
Context 
null 
Data 
data 
{ 
call: Call object 
windowId: GUID string 
} 
showReplayPlayerWindow 
Description  
Displays the Replayer/Player window 
Parameters:  
null</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
22 
Custom events 
The events that are subscribed to and published by third-party integrations are not limited to those 
in the above lists or the ones raised by the AgentWS. Any integration or gadget can raise its own set 
of events, simply by using the publish function. Conversely, an integration or gadget can subscribe 
to any of these custom events. This can enable, for example, a third-party application running on 
the user's desktop to publish an event to CCSP UI that only a custom gadget within CCSP UI is 
subscribed to. Within CCSP UI, third-party gadgets can communicate with each other using custom 
events. 
Custom CCSP UI Connector events 
To add a cusom event that is published to or received over the CCSP UI Connector, edit the file 
C:\Program Files (x86)\CosmoCom\Server Components\TouchPoint\Connector\ 
api\connectorapi.events.js.  
This file contains two arrays: 
• 
ConnectorToTouchPointEvents for events received from the CCSP UI Connector. 
• 
TouchPointToConnectorEvents for events published to the CCSP UI Connector.  
 
Add the names of the custom events to the appropriate array.  
Note 
You don’t need to specify the additional null element, unless the event can be specific to an 
instance of CCSP UI in a terminal services context.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
23 
4: CCSP UI AngularJS services 
This chapter describes key AngularJS services that are available in CCSP UI to perform day-to-day 
tasks such as dialing numbers, transferring calls, and publishing and subscribing to events. There 
are many more services used by CCSP UI than those documented here, however the majority are 
for internal use and should not be used by integrations without specific guidance from CCSP 
Customer Service. 
agentServiceWrapper 
This service contains the Agent object representing the logged-in user. Injecting this service into a 
controller or directive provides access to all the properties and functions of the Agent class that are 
described in the CCSP Agent AJAX API Reference. 
Properties 
agent 
Type: Object 
Description: Represents the logged in agent and implements the AJAX API Agent interface class. 
For details of properties and methods, see the web page in the CCSP Agent AJAX API Reference. 
Functions 
None</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
24 
customCSSService 
This service enables additional and modified CSS files to be loaded and applied to the CCSP UI. It is 
used internally by the CCSP UI application to load the file defined for the Settings gadget Look and 
Feel property that contains customized CSS styles. However, you can use it to load additional or 
modified CSS files at any point. 
Properties 
None 
Functions 
reloadCustomCSS 
Purpose 
Load styles contained in a given file and apply to the CCSP UI application 
Signature 
reloadCustomCSS(customCssPath) 
Parameter 
Type 
Description 
customCssPath 
String 
URL of the CSS file to load. Can be relative to the server 
(/TouchPoint/newCSS/newStyles.css) or absolute</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
25 
DALService 
DAL is for Data Access Layer and the service is used to write data to and retrieve data from the 
browser's web storage (see CCSP UI and web storage). Data is stored as a key-value pair, so the key 
used must be unique. The data stored can be in any form including objects and arrays. 
Properties 
None 
Functions 
DeleteValue 
Purpose 
Deletes the data referenced by the given key from local storage 
Signature 
DeleteValue(key) 
Parameter 
Type 
Description 
key 
String 
Unique identifier of the data value to be deleted 
GetValue 
Purpose 
Retrieves the data referenced by the given key from local storage 
Signature 
GetValue(key) 
Parameter 
Type 
Description 
key 
String 
Unique identifier of the data to be retrieved 
SetValue 
Purpose 
Saves the data with the given key in local storage 
Note 
Calling this function with a null data value is the same as calling DeleteValue. 
 
Signature 
SetValue(key, value) 
Parameter 
Type 
Description 
key 
String 
Unique identifier of the data value to be stored 
value 
Any 
The data to be stored</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
26 
dialogService 
This service is used to output messages, alerts and prompts to the user. 
Properties 
None 
Functions 
closeModal 
Purpose 
Closes the dialog box 
Signature 
closeModal() 
Parameter 
Type 
Description 
- 
- 
- 
showMessageBox 
Purpose 
Displays an alert box to the user with the title and message specified. 
Can be modified on display to present different button configurations 
and accepts a callback function for these buttons 
Signature 
showMessageBox(title, message, messageBoxButtons, resultAction, 
opts) 
Parameter 
Type 
Description 
title 
string 
Text to be displayed in the message box title bar 
message 
string 
Text to be output in the main area of the message box 
messageBoxButtons 
enum 
Button configuration to display. Enum is 
window.enghouse.enums.MessageBoxButtons which has 
the values: 
• 
OK 
• 
OKCancel 
• 
YesNo 
• 
YesNoCancel 
resultAction 
function 
Function to call when a button is pressed. The signature 
must match function(result) where result is a string with the 
possible values: 
• 
"ok" 
• 
"cancel" 
• 
"yes" 
• 
"no"</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
27 
opts 
obj
ect 
Further options 
dialService 
This service is used to dial out or transfer a voice call to a given number, agent, or system entry 
point. 
Properties 
None 
Functions 
Dial 
Purpose 
Makes a new voice call to the given target entity 
Signature 
Dial(type, name, target, needParam, parameterValue, configId, attendable, 
call) 
Parameter 
Type 
Description 
type 
string 
Call destination type. Possible values: 
• 
"callback" — callback 
• 
"communicatorContacts" — Teams or your custom application 
• 
"dialpad" — number 
• 
"incoming" — equivalent to "dialpad" 
• 
"speedDial" — speed dial entry 
• 
"system" — system entry point 
• 
"users" — agent 
• 
"voicemail" — dial agent's voicemail 
name 
string 
Display name of the destination. For dial type: 
• 
"callback" — use caller name, if available 
• 
"communicatorContacts" — use contact display name 
• 
"dialpad" — use callee name 
• 
"incoming" — use "" 
• 
"speedDial" — use speed dial name 
• 
"system" — use entry point 
• 
"users" — use agent name 
• 
"voicemail" — use "Voicemail" 
target 
string 
The value to be dialed: For dial type: 
• 
"callback" — use callback number</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
28 
• 
"communicatorContacts" — use SIP URI 
• 
"dialpad" — use number 
• 
"incoming" — use number 
• 
"speedDial" — use speed dial number 
• 
"system" — use system entry point config Id 
• 
"users" — use Agent Config Id 
• 
"voicemail" — use agent's private voicemail number 
needParam 
string 
Indicates that a parameter can be specified. This applies to the 
"system" dial type only  
parameterValue 
string 
Extra data that can be associated with the call. For dial type: 
• 
"communicatorContacts"  — the contact Skye for Business 
presence 
• 
"system"  — the parameter accepted by the destination script 
• 
"users" — the destination agent's state 
attendable 
string 
Call is attendable. Only applies for "system" dial type 
call 
object 
If non-null, the dialing action is performed from this object instead 
of the agent object 
Transfer 
Purpose 
Performs a blind transfer of a chat or email call to the given target. Do not 
use this for VoIP calls.  
Note 
This only supports blind transfers to another agent or to System. The only 
parameters that are used are type, target, parameterValue, and call. All 
other values should be null. 
 
Signature 
Dial(type, name, target, needParam, parameterValue, configId, attendable, 
call) 
Parameter 
Type 
Description 
type 
string 
Call destination type. Possible values: 
• 
"callback" — Callback 
• 
"communicatorContacts" — Teams or your custom application 
• 
"dialpad" — number 
• 
"incoming" — equivalent to "dialpad" 
• 
"speedDial" — speed dial entry 
• 
"system" — system entry point 
• 
"users" — agent 
• 
"voicemail" — dial agent's voicemail</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
29 
name 
string 
Display name of the destination. For dial type: 
• 
"callback" — use caller name, if available 
• 
"communicatorContacts" — use contact display name 
• 
"dialpad" — use "" 
• 
"incoming" — use "" 
• 
"speedDial" — use speed dial name 
• 
"system" — use entry point 
• 
"users" — use agent name 
• 
"voicemail" — use "Voicemail" 
target 
string 
The value to be dialed: For dial type: 
• 
"callback" — use callback number 
• 
"communicatorContacts" — use SIP URI 
• 
"dialpad" — use number in tel: format 
• 
"incoming" — use number in tel: format 
• 
"speedDial" — use speed dial number 
• 
"system" — use system entry point config Id 
• 
"users" — use Agent Config Id 
• 
"voicemail" — use agent's private voicemail number 
needParam 
string 
Indicates that a parameter can be specified. This applies to the 
"system" dial type only  
parameterValue 
string 
Extra data that can be associated with the call. For dial type: 
• 
"communicatorContacts" — the contact Skye for Business 
presence 
• 
"system" — the parameter accepted by the destination script 
• 
"users" — the destination agent's state 
attendable 
string 
Call is attendable. Only applies for "system" dial type 
call 
object 
The dialing action is performed from this object</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
30 
localSettingsService 
This service provides a means of storing data within CCSP UI so that is retrievable by a user-
supplied key. Data can be stored only for the current login session or saved to web storage using 
DALService for subsequent login sessions. Data is stored as a key-value pair, so the key used must 
be unique. The data stored can be in any form including objects and arrays.  
Properties 
None 
Functions 
DeleteValue 
Purpose 
Deletes the data referenced by the given key from current login session and 
from the local store, if specified 
Signature 
DeleteValue(key, removeFromDAL) 
Parameter 
Type 
Description 
key 
String 
Unique identifier of the data value to be deleted 
removeFromDAL 
Boolean 
Flag indicating that the data is to be deleted from local storage if 
present 
GetValue 
Purpose 
Retrieves the data referenced by the given key. Retrieves it from local 
storage, if specified by the given flag 
Signature 
GetValue(key, getFromDAL) 
Parameter 
Type 
Description 
key 
String 
Unique identifier of the data to be retrieved 
getFromDAL 
Boolean 
Flag indicating that the data is to be retrieved from local storage 
if present</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
31 
SetValue 
Purpose 
Saves the data with the given key. This is saved to local storage if specified by 
the given flag 
Note 
Calling this function with a null data value is the same as calling DeleteValue. 
 
Signature 
SetValue(key, value, saveToDAL) 
Parameter 
Type 
Description 
key 
String 
Unique identifier of the data value to be stored 
value 
Any 
The data to be stored 
saveToDAL 
Boolean 
Flag indicating that the data is also to be saved to local storage</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
32 
loggerService 
This service is used to output debugging information to the browser console and/or file log. 
Properties 
None 
Functions 
SetUserName 
Purpose 
Sets the user name to the value given to indicate the source of the logging 
Signature 
SetUserName(username) 
Parameter 
Type 
Description 
username 
string 
Username to be set 
Returns 
- 
WriteLine 
Purpose 
Writes a line of text to the selected outputs with the given log severity and 
identifying caller 
Signature 
WriteLine(message, severity, callerName) 
Parameter 
Type 
Description 
message 
string 
Text to be output 
severity 
string 
Warning level of the output. Possible values are defined in Global.js 
in the CCSP APIs Guide 
callerName 
string 
Used to indicate where the text originated from, typically the name 
of the calling function or class 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
33 
oidcService 
This service provides an API to the Javascript object used to initiate and mange authentication and 
authorization of named clients with the CCSP Auth Server according to the OpenID Connect 
Authorization flow. The OpenID Connect Authorization flow and the use of this service is explained 
in 9: Single Sign On Client development. 
Properties 
None 
Functions 
addClient 
Purpose 
Adds an oidcClient object to its internal collection for performing 
authentication and authorization requests on behalf of a named 
client 
Signature 
addClient({client, clientId, redirectUri, redirectUriLogout, 
refreshTokenRequired, responseModePostRequired, 
refreshSlidingTime, refreshTokenCallback}) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
clientId 
string 
The ID by which the client is known in the OIDC Clients 
table and is presented as the identifier for the client 
when making requests to the CCSP Auth Server 
redirectUri 
string 
Location that is used by the CCSP Auth Server to help 
identify the client and where the CCSP Auth Server 
directs the browser with an authorization code if the 
user is authenticated 
redirectUriLogout 
string 
Location that is used by the CCSP Auth Server to help 
validate the client’s request and where the CCSP Auth 
Server directs the browser with an authorization code 
if the user is authenticated 
refreshSlidingTime 
int 
Time in milliseconds before the current access token 
expires that a new access token will be requested 
when refreshTokenRequired is true 
refreshTokenCallback 
string 
Function to be called when the result of an access 
token request using the refresh token is received 
refreshTokenRequired 
Boolean 
Flag indicating that a refresh token is also required 
when requesting an access token and that the access 
token should be automatically renewed using the 
OIDC Refresh flow</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
34 
responseModePostRequired 
Boolean 
Not currently used 
Returns 
Array of Translation objects defined as {Key, Value} 
getAccessToken 
Purpose 
Gets the current access token for the named client 
Signature 
getAccessToken(client) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Returns 
Access token, or null if no token defined 
getUserData 
Purpose 
Gets data from the CCSP Auth Server for the currently authenticated user 
Signature 
async getUserData(client)  
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Returns 
Object defined as {dataReceived, data} where: 
• 
dataReceived is Boolean indicating the success of the operation 
• 
data is the user data returned by the CCSP Auth Server. If dataReceived 
is false, this object is null; 
When defined, data contains: 
o 
FirstName – string - user’s first name 
o 
FullName – string - user’s combined first and last name 
o 
LastName – string - user’s last name 
o 
Name – string - user’s login name 
o 
PersonClaimType - int - type of user: 0 (Landlord), 1 (Reseller), 2 
(Tenant) 
o 
PersonId – int – user’s unique ID in Configuration Database  
o 
Profile_ID – string – Profile ID or null if not defined 
o 
Role – int – user’s Role ID or null if not defined 
o 
SystemParameters { 
 
 
InitialDC – Domain controller being used 
 
 
UseRootOU – Boolean – indicates that CCSPRoot is being 
 
 
used 
 
} 
o 
TenantId – string – Tenant’s unique ID in Configiration Database 
or null if not a tenant user 
TenantInfo – not currently defined</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
35 
o 
upnSuffix – string – tenant or domain suffix (note lowercase ‘u’) 
o 
UserName – string – full login id with suffix 
hasClient 
Purpose 
Checks if the oidcService contains the named client 
Signature 
hasClient(client) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Returns 
Boolean that is true if client exists 
isRedirectCallbackCode 
Purpose 
Checks if the current or given window location contains an authorization 
code in the query 
Signature 
async isRedirectCallbackCode(client, location) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Location 
object 
Window location object defining the URL to be checked. If this is 
null, the current window location object will be used 
Returns 
Boolean that is true if the authorizatrion code has been found 
login 
Purpose 
Initiates the OIDC authorization code flow to authenticate the user and 
client 
Signature 
async login(client, basePath, language, locationObj) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
basePath 
string 
Redirect URL for the authorizatioin code response. This will replace 
the redirect URL specified when the client was added to the 
oidcService. If the original redirect URI is to be used, set this 
parameter to null  
language 
string 
Language code to be used by the CCSP Auth Server login pages. 
This should always be null when the oidcService is used by gadgets 
as user will aready have been authenticated 
locationObj 
object 
Window location object defining the URL to be checked. If this is 
null, the current window location object will be used</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
36 
Returns 
Empty object if the login request is successful, or object containing: 
• 
error – string – Error message 
• 
status – Request status code 
Note that when function is successful, the window location will change to 
the requested redirect URI. 
logout 
Purpose 
Logs out the user from the CCSP Auth Server.  
Stop 
This method should never be called from a gadget within CCSP UI. 
  
Signature 
async logout(client) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Returns 
“ok” if logout was successful, else the error code in the event of failure 
processCodeCallback 
Purpose 
Makes a request to the CCSP Auth Server for an access token and optionally 
a refresh token 
Signature 
getAccessToken(client) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
basePath 
string 
Redirect URL for the authorizatioin code response. This will replace 
the redirect URL specified when the client was added to the 
oidcService. If the original redirect URI is to be used, set this 
parameter to null  
language 
string 
Language code to be used by the CCSP Auth Server login pages. 
This should always be null when the oidcService is used by gadgets 
as user will aready have been authenticated 
locationObj 
object 
Window location object defining the URL to be checked. If this is 
null, the current window location object will be used</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
37 
Returns 
Object defined as {tokenReceived, error} where: 
• 
tokenReceived is Boolean indicating the success of the operation 
• 
error is the error message returned by the CCSP Auth Server if the 
operation failed. It the operation succeeded, this object is not defined 
Note 
This function does not return the access token itself. Client gadgets must 
use the getAccessToken method and should not store the access token 
locally. They should only get the token when they need to send it to the 
Resouce Server in a request. 
 
removeClient 
Purpose 
For the named client, cancels any ongoing token refresh, deletes any tokens, 
and removes the client from the oidcService 
Signature 
removeClient(client) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Returns 
- 
stopRefreshingToken 
Purpose 
For the named client, cancels any ongoing token refresh and deletes any 
tokens 
Signature 
stopRefreshingToken(client) 
Parameter 
Type 
Description 
client 
string 
Unique name to identify the client within the CCSP UI 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
38 
translationService 
This service is used to load default and custom xml translation files and provide functions to 
translate text into the required language according to the information provided in those files. 
Properties 
None 
Functions 
getAllTranlsations 
Purpose 
Gets all the loaded translations 
Signature 
getAllTranslations() 
Parameter 
Type 
Description 
- 
- 
- 
Returns 
Array of Translation objects defined as {Key, Value} 
getLanguagesList 
Purpose 
Gets the names of the language files available in the system 
Signature 
getLanguagesList() 
Parameter 
Type 
Description 
- 
- 
- 
Returns 
Array of Language file objects defined as {filename, NativeName}  
where: 
• 
filename is the name of the translation file without the extension 
• 
NativeName is the full language name, full region/country name and the 
optional script 
getTranlsation 
Purpose 
Gets the translated text for the given key in the set  
Signature 
getTranslation(key) 
Parameter 
Type 
Description 
key 
string 
Key phrase to translate. See relevant translations xml file for 
possible values 
Returns 
string translation or null if no translation found</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
39 
getTranlsationAsync 
Purpose 
Gets the translated text for the given key in the set language 
asynchronously. Returns a promise object 
Signature 
getTranslationAsync(key) 
Parameter 
Type 
Description 
key 
string 
Key phrase to translate. See relevant translations xml file for 
possible values 
Returns 
Promise object where the then function returns the translated string or null 
if no translation found 
 initTranslationObject 
Purpose 
Initializes the translation service to use the given language 
Signature 
initTranlsationObject(language) 
Parameter 
Type 
Description 
language 
string 
Language key. Currently supported values are: 
• 
"de" — German 
• 
"en-us" — English-United States 
• 
"fr" —  French 
• 
"ja" —  Japanese 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
40 
viewModelStoreService 
This service is used to store and retrieve single instances of objects that are global to the CCSP UI 
application. As the name suggests, these are typically ViewModels that may each represent an 
email, or a window that can be referenced by different parts of CCSP UI, but of which only one 
instance must exist. Integrations can use this to store data that needs to be available to different 
gadgets.  
Properties 
None 
Functions 
checkIn 
Purpose 
Adds a ViewModel to the store that is referenced by the given name 
Signature 
checkIn(name, vm) 
Parameter 
Type 
Description 
name 
String 
Name of the ViewModel by which it is referenced 
vm 
Object 
ViewModel to store 
Returns 
- 
checkOut 
Purpose 
Retrieves a ViewModel from the store that is referenced by the given name 
Signature 
checkOut(name) 
Parameter 
Type 
Description 
name 
String 
Name of the ViewModel to retrieve 
Returns 
ViewModel that is referenced by the given name or null if it is not found 
Remove 
Purpose 
Removes the ViewModel from the store that is referenced by the given 
name 
Signature 
remove(name) 
Parameter 
Type 
Description 
name 
String 
Name of the ViewModel to delete 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
41 
voipService 
This service provides the high level interface to the media devices on the agent's desktop or the 
agent's alternative voice device if selected. 
Properties 
isMicMuted 
Type: Boolean 
Description: Flag that indicates if the currently selected audio input device is muted. 
isSpeakerMuted 
Type: Boolean 
Description: Flag that indicates if the currently selected audio output device is muted. 
micSliderVal 
Type: integer 
Description: Audio level of the currently selected input device on a scale of 0 to 100. 
speakerSliderVal 
Type: integer 
Description: Audio level of the currently selected output device on a scale of 0 to 100. 
Functions 
Connect 
Purpose 
Establishes a media connection for a given Call object using the selected 
audio devices on the agent's desktop 
Signature 
Connect(call) 
Parameter 
Type 
Description 
call 
Object 
Call object to establish the connection for 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
42 
ConnectAlternateDeliveryCall 
Purpose 
Establishes a media connection for a given Call object using the agent's 
alternative voice device 
Signature 
ConnectAlternateDeliveryCall(call) 
Parameter 
Type 
Description 
call 
 
Object 
Call object to establish the connection for 
Returns 
- 
MicrophoneMute 
Purpose 
Mutes or unmutes the selected audio input device according to the input 
Note 
Changes in the microphone mute status can be caused by different parts of 
CCSP UI so the current value of isMicMuted should always be checked 
before using this function. 
 
Signature 
MicrophoneMute(newStatus) 
Parameter 
Type 
Description 
newStatus 
Boolean 
Flag indicating whether or not microphone is to be muted 
Returns 
- 
PreConnect 
Purpose 
Establishes a media connection for the given Call object using the selected 
audio devices on the agent's desktop when the call is incoming 
Signature 
PreConnect(call) 
Parameter 
Type 
Description 
call 
 
Object 
Call object to establish the connection for 
Returns 
- 
PreConnectAlternativeDelivery 
Purpose 
Establishes a media connection for the given Call object using the agent's 
alternative voice device when the call is incoming 
Signature 
PreConnectAlternativeDelivery(call) 
Parameter 
Type 
Description 
call 
 
Object 
Call object to establish the connection for 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
43 
SpeakerMute 
Purpose 
Mutes or unmutes the selected audio output device according to the input 
Note 
Changes in the speaker mute status can be caused by different parts of 
CCSP UI so the current value of isSpeakerMuted should always be checked 
before using this function. 
 
Signature 
SpeakerMute(newStatus) 
Parameter 
Type 
Description 
newStatus 
Boolean 
Flag indicating whether or not speaker is to be muted 
Returns 
-</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
44 
5: Gadgets 
Overview 
This section describes the CCSP UI gadget capability, what gadgets are, how they are created, and 
how they can be written to greatly extend the capabilities of CCSP UI and integrate it with a wider 
set of customer applications and websites. 
Note 
This guide uses AngularJS in the example gadgets and we recommend that you familiarize 
yourself with the basic concepts of this framework. 
Example gadgets 
The full versions of all example gadgets given in this guide are available in the installed CCSP UI 
folder under Server Components\TouchPoint\App\gadgets\Examples in their respective folder. When 
creating the example gadgets as part of the walkthrough, create a folder under Server 
Components\TouchPoint\App\gadgets for each example gadget for your own work. 
Note 
The code walkthroughs in this guide purposely provide very little in the way of CSS styling to 
avoid cluttering the HTML. This does mean that the gadgets produced during the walkthroughs 
do not look very polished and it is up to you to introduce styles as you see fit. 
What is a gadget? 
A gadget is a facility in CCSP UI that can be added, removed, or customized to help build bespoke 
GUIs designed to meet the particular needs of a tenant group or role. CCSP UI comes with its own 
set of customizable default gadgets and it enables the addition of third-party gadgets, to extend 
the functionality and integrate CCSP UI with other applications. 
Gadget capabilities 
Some of the capabilities and benefits of using gadgets are: 
• 
Ability to listen to all UI and AgentWS events raised in CCSP UI and perform bespoke actions as 
a result. 
• 
Ability to raise their own events that can be subscribed to by other gadgets or other 
applications that are listening through CCSP UI Connector. 
• 
Ability to manipulate calls held in the Agent. 
• 
Ability to manipulate the agent status and settings.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
45 
Gadget types 
CCSP UI gadgets fall into three categories: system, standard, and functional. 
System gadgets 
These are the default gadgets that are developed and packaged as part of the CCSP UI application 
itself. Certain aspects of these gadgets can be customized for each tenant, group, or role. 
Standard gadgets 
Standard gadgets are custom windows that can host HTML or ASP pages that are as simple or 
complex as necessary, or provide access to different websites within the CCSP UI window. The 
content of a standard gadget is limited only by the normal restrictions for iframes (that is, certain 
public websites such as Google or BBC do not allow their content to be displayed in an iframe) and 
can be used to display information from a CRM application or to activate an application on the 
client desktop. 
Standard gadgets can be opened from the gadgetory bar in CCSP UI and can be opened as a 
tabbed, floating, or separate window and resized and repositioned. They have a range of properties 
that can be used to control their appearance and position and can be assigned a stylesheet. 
Functional gadgets 
Functional gadgets are scripts that are added to the CCSP UI application on agent login. They have 
no UI and usually just sit in the background listening for specific CCSP UI events and execute the 
required business logic. An example use for a functional gadget is to open a website in a new 
browser window when the agent receives a specific kind of call. The functional gadget can pass 
information from that call to the new web page. 
Standard vs. functional gadgets 
The main difference between standard and functional gadgets from a user perspective is that a 
standard gadget has a window and can be activated from the gadgetory, while a functional gadget 
for all intents and purposes is invisible. From a development point of view there are the following 
important differences: 
• 
Standard gadgets are registered for events for the duration of their lifetime (from being 
opened to being closed), whereas functional gadgets are registered for the entirety of the 
agent's login session. 
• 
Standard gadgets are refreshed each time they are closed and then re-opened. This means 
that when developing a gadget, it is not necessary for a test agent to log out and back into 
CCSP UI every time a change is made. Functional gadgets are loaded on agent login, so a 
change made to the script code requires a relogin. 
• 
A standard gadget can be written as an AngularJS module and utilize the CCSP UI services 
using service injection. Functional gadgets can only access these services using the AngularJS 
injector.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
46 
Note 
A standard gadget does not have to be written as an AngularJS module as it also can use the 
injector. 
Combining standard and functional gadgets 
A functional gadget can be used to display a standard gadget and pass arguments to it. An 
example of this to ensure that a standard gadget is always displayed on a new call. Standard 
gadgets can also use functions and objects that have been defined in a functional gadget (see 
Inter-gadget access example). 
Gadget creation 
Standard or functional gadget? 
Before starting to create a gadget, you need to know the purpose of the gadget because this 
determines the type of gadget to be created. Ask the following questions: 
• 
Does the gadget need to display any information to the agent? 
• 
Does the gadget need to register for events on agent login? 
• 
What does the gadget do? For example, does it open a web page, run an application, pop up a 
window, or raise an event? 
 
If the gadget needs to present a page to the agent that can be used to manipulate the agent's 
login session or a call, then you need a standard gadget. If the gadget just needs to send data to a 
CRM database every time a certain event occurs, a functional gadget is sufficient.  
Demonstration gadgets 
In this document, we develop the following gadgets to illustrate the various concepts and 
capabilities of custom gadgets in CCSP UI: 
• 
Chat Prompt — standard gadget 
• 
Chat Prompt Func — functional gadget 
• 
Custom Email — standard gadget 
• 
Demo CRM — standard gadget 
• 
Demo Chat Prompt — functional and standard gadgets 
• 
Simple Gadget — standard gadget 
 
The Demo CRM gadget is loosely based on the MiniCRM and demonstrates access to and 
manipulation of the Agent and Call objects, advanced call handling, and how to access and use 
various AngularJS services provided within the CCSP UI application.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
47 
The Demo Chat Prompt example starts off as a simple functional gadget to answer a chat call and 
extract information from the caller. It is later extended into a standard gadget that pops up on a 
new call and demonstrates the addition and customization of gadget properties. 
CCSP AdminPoint 
You administer CCSP UI integrations and gadgets using the CCSP AdminPoint application. Before 
any custom gadget can be used in CCSP UI, it must be added first to the system repository of 
gadgets and secondly to the available gadgets for a tenant, group, or role. For full details about 
using CCSP AdminPoint, see CCSP AdminPont Help.  
The basic steps to add the two demonstration gadgets are as follows. 
Adding the Demo Chat Prompt functional gadget 
To add the Demo Chat Prompt functional gadget: 
1. 
Log in to CCSP AdminPoint using the appropriate credentials. 
2. 
Select the Gadgetory tab, select the Gadgets subtab, click the Add + button and select 
Functional Gadget. 
3. 
Type Demo Chat Prompt for the name of the new gadget. 
4. 
In Script Url, type the following URL: 
app/gadgets/DemoChatPrompt/DemoChatPromptFunc.js 
5. 
Click Save. 
 
Create the folder app/gadgets/DemoChatPrompt underneath the physical TouchPoint folder on the 
server and inside it, create the first version of the DemoChatPromptFunc.js file with the following 
code. 
function StartUpDemoChatPrompt() { 
    alert("The Demo Chat Prompt gadget has been loaded"); 
} 
 
StartUpDemoChatPrompt();</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
48 
Adding the Demo CRM standard gadget 
To add the Demo CRM standard gadget: 
1. 
Log in to CCSP AdminPoint using the appropriate credentials. 
2. 
Select the Gadgetory tab, select the Gadgets subtab, click the Add Gadget + button and select 
Standard Gadget. 
3. 
Type Demo CRM for the name of the new gadget. 
4. 
In Target URL (HTML), type the following URL: app/gadgets/DemoCRM/DemoCRM.html.  
5. 
Leave all the other properties at their default values for now. 
6. 
Click Save. 
 
Create the folder app/gadgets/DemoCRM underneath the physical TouchPoint folder on the server 
and inside it, create the first version of the DemoCRM.html file with the following code. 
&lt;!DOCTYPE html&gt; 
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt; 
&lt;head&gt; 
    &lt;title&gt;Demo CRM&lt;/title&gt; 
&lt;/head&gt; 
&lt;body&gt; 
    &lt;h1&gt;Hello, welcome to Demo CRM&lt;/h1&gt; 
&lt;/body&gt; 
&lt;/html&gt; 
Adding the gadgets to a role 
When the gadgets are in the system, you can add them to any of the tenants or their contained 
groups or roles. To minimize the visibility of the two demo gadgets just added, we recommend that 
you create a specific Testing role for the tenant using CCSP Web Administrator and the two gadgets 
added to this role in CCSP AdminPoint. However, you can add the gadgets at the group or tenant 
level if required. 
For details about adding a group or role to a tenant and customizing it to add the two demo 
gadgets, see CCSP AdminPoint Help.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
49 
Testing the gadgets 
After you add the gadgets at the appropriate level, they are available for use within that level in the 
next login session. Log on to CCSP UI using an agent belonging to the role that contains the 
gadget. A normal browser alert should be displayed with the message The Demo Chat Prompt 
gadget has been loaded. Acknowledge this alert and check the Gadgetory tool bar. This should have 
an additional icon as below. 
 
Clicking on this icon shows the new Demo CRM gadget as a tabbed window in CCSP UI. 
Gadget refresh 
During gadget development, adding any gadget and modifying it in the system and at the different 
customization levels within CCSP AdminPoint, requires a new login session for the changes to take 
effect in CCSP UI, that is, a currently logged on user must log out and back on again.  
Changes to a standard gadget's code and files, however, do not require a new login session 
provided the file specified as the Target URL (HTML) remains the same. To reload a standard 
gadget with the changes, close the gadget in CCSP UI and re-open it. This does not apply to 
functional gadgets because CCSP loads them at login, so a new login session is required for any 
code changes to take effect. 
This can be demonstrated by logging onto the user with access to the DemoCRM gadget, adding 
the following line to the DemoCRM.html in the body section and saving the updated file. 
&lt;h2&gt;This is the gadget used for the standard gadget development 
walkthrough&lt;/h2&gt; 
 
While still logged on, open the Demo CRM and it displays with the new text. 
Conversely, changing the alert message displayed in the Demo Chat Prompt functional gadget, 
while the user is logged on has no effect.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
50 
Gadget properties 
Standard gadgets are created with a number of default properties and these can be supplemented 
with custom properties that are available for access from within the gadget itself. 
Default properties 
The table below lists the default properties for a standard gadget.  
Name 
Usage 
Notes 
Disabled 
When selected, the gadget is no 
longer part of the customization 
level and does not appear in CCSP 
UI. 
 
Can Maximize 
NOT USED 
DO NOT USE 
Can Hide 
When selected, the Minimize option 
is added to the gadget's window 
menu so that it can be removed 
from display while still running. 
 
Can Close 
When selected, a close (
) button 
is added to the gadget's window 
menu if the gadget is displayed as a 
window in CCSP UI. 
A close button is always added if 
the gadget is being displayed as a 
tab or pop out window. 
Can Popout 
When selected, a Pop out button is 
added to the gadget's tool bar or 
window menu when that displays 
the gadget in its own browser 
window when activated. 
This property must be enabled 
when the Default State property is 
set to Popout. 
Can Tab 
When selected, a maximize (
) 
button is added to the gadget's tool 
bar when it is displayed as a 
floating or pop out window. This 
docks the gadget as a tab page in 
CCSP UI when activated. 
This property must be enabled 
when the Default State property is 
set to Tab. 
Can Float 
When selected, a Float button is 
added to the gadget's window 
menu when it is displayed as a tab 
page. This changes the gadget to a 
floating window within CCSP UI 
when activated. 
This property must be enabled 
when the Default State property is 
set to Float.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
51 
Name 
Usage 
Notes 
Can Fold 
When selected, the gadget's icon in 
the gadgetory is removed if the 
CCSP UI window height is 
decreased beyond a point where all 
gadgets can be displayed. The 
gadget is placed in a subgadgetory 
window, accessible by hovering 
over the plus icon in the gadgetory 
as below. 
 
 
When this property is not enabled, 
the gadget remains in the main 
gadgetory. If the CCSP UI height 
shrinks below a certain value, the 
gadget is not shown. 
Is Supervisor 
Gadget 
When selected, the gadget is only 
available in the Gadgetory if the 
logged on user is a supervisor. 
 
Is Bottom 
When selected, the gadget appears 
at the bottom of the gadgetory 
below the Settings gadget. 
 
Can Expand 
When selected, a toggle (
) button 
is added to the gadget's window 
when it is displayed as a floating 
window. When activated, the 
"popoutWindow_Expand" event is 
raised and the button changes to 
. When activated again, the 
"popoutWindow_Contract" event is 
raised. 
The gadget implementation must 
subscribe to this event and perform 
any actions required. 
No Icon in 
Gadgetory 
When selected, no icon is displayed 
in the gadgetory for the gadget, 
therefore it can only be displayed 
programmatically, for example, in 
response to an event. 
 
Float Default 
Position 
Specifies the initial X and Y co-
ordinates of the gadget when 
displayed as a floating window. 
X increases the value from left to 
right and Y increases it from top to 
bottom.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
52 
Name 
Usage 
Notes 
Float Default Size 
Specifies the initial width and 
height of the gadget when 
displayed as a floating window. 
 
Popout Default 
Position 
Specifies the initial X and Y co-
ordinates of the gadget when 
displayed in a separate browser 
window. 
X increases the value from left to 
right and Y increases it from top to 
bottom. 
Popout Default 
Size 
Specifies the initial height and 
width of the gadget when displayed 
in a separate browser window. 
 
Default State 
Specifies the default layout of the 
gadget when it is opened. Can be 
Float, Popout or Tab. 
The corresponding property flag 
must be enabled for the gadget to 
appear in the selected state, for 
example, Can Tab must be enabled 
if Tab is selected. 
Allowed Instances 
Specifies the number of separate 
instances of the gadget that can be 
opened. 
 
Target URL (HTML) 
 
Specifies the HTML file that 
represents the gadget. 
This file must be in a location 
relative to the TouchPoint virtual 
folder. 
Controller URL 
 
Specifies a JavaScript file to load for 
the gadget on login. 
This file must be in a location 
relative to the TouchPoint virtual 
folder. 
Icon 
Enables a custom image file to be 
used to represent the gadget in the 
gadgetory. 
The image file is loaded into the 
Configuration Database, so the file 
can be located anywhere. 
SelectedIcon 
Enables a custom image file to be 
used to represent the highlighted 
gadget in the gadgetory. 
The image file is loaded into the 
Configuration Database, so the file 
can be located anywhere. 
Stylesheet 
Specifies a CSS file to be used for 
the gadget. 
This file must be in a location 
relative to the TouchPoint virtual 
folder. 
 
Table 2: Standard gadget default properties</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
53 
In CCSP AdminPoint, go to the Gadgets subtab and edit the Demo CRM gadget. Experiment with 
changing the different property values and relogin to see the effects on the gadget. 
The table below lists the default properties for a functional gadget.  
Name 
Usage 
Notes 
Disabled 
When enabled, the gadget is not 
loaded in CCSP UI 
 
Script URL 
Specifies the JavaScript file that 
represents the gadget. 
This file must be in a location 
relative to the TouchPoint virtual 
folder. 
 
Table 3: Functional gadget default properties 
Adding custom properties 
Custom properties can be added to both standard and functional gadgets. The following types of 
properties can be added: 
• 
Boolean 
• 
Integer 
• 
String 
• 
Coordinates 
• 
Dimension 
• 
ValuesList 
 
Custom properties can only be added to a gadget at the system level, not at the different 
customization levels. In each case, the name of the property must be specified and an optional 
default value. For the ValuesList, which is simply an array of integer and/or string values, a Default 
value must be specified from those added. 
The name of a custom property can contain spaces. In the code, the space is removed from the 
name. 
The addition and usage of Custom Properties is explored in further detail with examples in Adding 
an example custom property.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
54 
Standard gadget development 
Customized standard gadgets are HTML-based pages that contain UI and business logic to extend 
the CCSP UI functionality. Because CCSP UI is an AngularJS –based application, standard gadgets 
can be written as AngularJS modules and use the services provided by CCSP UI through the normal 
injection into the module. This section describes how to write such a gadget. 
This guide provides the minimum information on AngularJS to produce a usable gadget that 
demonstrates how services and objects from the main CCSP UI application are used to extend its 
functionality. AngularJS is a powerful development framework and it can be used to create gadgets 
with a rich UI and complex business logic. Such usage is beyond the scope of the document and for 
further information, see the official AngularJS website: https://angularjs.org/. 
Standard gadget structure 
HTML file 
This is the file that must be used as the Target URL (HTML) parameter for the gadget in CCSP 
AdminPoint. This file may be all that is needed if the gadget is very simple, for example, if it just 
displays a non-interactive web page. 
CSS file 
This file can be specified in the Stylesheet property of the gadget in CCSP AdminPoint or it can be 
one of the links within the HTML file. 
Code files 
This file is the source code that is included by the HTML file. This file can be anything but access to 
the essential objects such as Agent and Call and the various services is provided using JavaScript. If 
the gadget is written as an AngularJS module, this file should contain the page's controller. 
Depending on the complexity of the gadget, multiple code files may be required, which can all be 
included by the HTML file.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
55 
Standard gadget as an AngularJS module 
The Demo CRM gadget created for this guide currently contains only the following lines in the 
HTML file. 
&lt;!DOCTYPE html&gt; 
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt; 
&lt;head&gt; 
    &lt;title&gt;Demo CRM&lt;/title&gt; 
&lt;/head&gt; 
&lt;body&gt; 
    &lt;h1&gt;Hello, welcome to Demo CRM&lt;/h1&gt; 
&lt;/body&gt; 
&lt;/html&gt; 
 
To convert this to an AngularJS module, you need to provide as a minimum the following: 
• 
Includes for the AngularJS code 
• 
An AngularJS module for the page ("demoCRMApp") 
• 
An AngularJS controller for the body ("demoCRMController") 
• 
The module definition and the controller code 
Converting the Demo CRM HTML to AngularJS 
Add the following script includes to the DemoCRM.html file. 
&lt;script type="text/javascript" src="/TouchPoint/Scripts/jquery-
2.0.1.js"&gt;&lt;/script&gt; 
&lt;script type="text/javascript" src="/TouchPoint/Scripts/angular.js"&gt;&lt;/script&gt; 
&lt;script type="text/javascript" 
src="/TouchPoint/App/common/gadgetInit.js"&gt;&lt;/script&gt; 
&lt;script type="text/javascript" src="/TouchPoint/Ajax/helpers.js"&gt;&lt;/script&gt; 
&lt;script type="text/javascript" src="DemoCRM.js"&gt;&lt;/script&gt; 
 
The list of includes covers the AngularJS source and other useful files: 
• 
jquery.js facilitates the selection and manipulation of the HTML elements that are added later. 
• 
angular.js provides the necessary objects and functions for creating the module and controller. 
• 
gadgetInit.js defines functions for accessing global functions such as GetRootWindow(). 
• 
helpers.js includes various utility functions for extracting data from the Agent and Call objects. 
• 
DemoCRM.js is the code file for the gadget and contains the controller that is added later.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
56 
The demoCRMApp module is added to the html declaration and the demoCRMController as an 
attribute of the body as below. 
&lt;html ng-app="demoCRMApp" xmlns="http://www.w3.org/1999/xhtml"&gt; 
… 
&lt;body ng-controller="demoCRMController"&gt; 
The html should now look like this. 
&lt;!DOCTYPE html&gt; 
&lt;html ng-app="demoCRMApp" xmlns="http://www.w3.org/1999/xhtml"&gt; 
&lt;head&gt; 
    &lt;title&gt;Demo CRM&lt;/title&gt; 
    &lt;script type="text/javascript" src="/TouchPoint/Scripts/jquery-
2.0.1.js"&gt;&lt;/script&gt; 
    &lt;script type="text/javascript" 
src="/TouchPoint/Scripts/angular.js"&gt;&lt;/script&gt; 
    &lt;script type="text/javascript" 
src="/TouchPoint/App/common/gadgetInit.js"&gt;&lt;/script&gt; 
    &lt;script type="text/javascript" src="/TouchPoint/Ajax/helpers.js"&gt;&lt;/script&gt; 
    &lt;script type="text/javascript" src="DemoCRM.js"&gt;&lt;/script&gt; 
&lt;/head&gt; 
&lt;body ng-controller="demoCRMController"&gt; 
    &lt;h1&gt;Hello, welcome to Demo CRM&lt;/h1&gt; 
 
&lt;h2&gt;This is the gadget used for the standard gadget development 
walkthrough&lt;/h2&gt; 
&lt;/body&gt; 
&lt;/html&gt;</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
57 
Defining the Demo CRM module and controller 
The demoCRMApp and demoCRMController are defined in a separate DemoCRM.js file. It could 
actually all be defined in the HTML file, but for clarity and best practice, we use a separate file. 
1. 
Create the DemoCRM.js file in the same DemoCRM folder as the HTML file and open for editing. 
2. 
Get a reference to the root CCSP UI window, which has visibility of the modules and AngularJS 
services. 
//get reference to root window - the one containing our main modules and 
services 
var _root = GetRootWindow(); 
3. 
Create the demoCRMApp application module. 
//create module 
var mainModule = angular.module("demoCRMApp", []); 
4. 
Access the required services. For now, only loggerService is used to write some debug output 
to the Client log file on the agent's machine. 
var directServices = ["loggerService"]; 
//use this method to inject all the services above to your module 
_root.appendServiceProxiesToModule(mainModule, directServices); 
5. 
Create the controller for the DemoCRM page as part of the demoCRMApp application module, 
with the loggerService as an injected service. 
mainMoule.controller("demoCRMController", ["$scope", "loggerService", 
"eventServiceWrapper",  
    function ($scope, loggerService, eventServiceWrapper) { 
 loggerService.WriteLine("Demo CRM has been opened", 
_root.enghouse.enums.Severity.Debug, "demoCRM"); 
 }]); 
6. 
Optionally define the ready event handler for the document, which should call the 
GadgetComm.windowReady() function. This is actually only required when the gadget is 
expected to be opened by another gadget such as a functional gadget (see Accessing other 
gadgets and windows). 
angular.element(document).ready(function ()  
{_root.app.GadgetComm.windowReady(window);} 
);</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
58 
The complete code should be as follows. 
//get reference to root window - the one containing our main modules and 
services 
var _root = GetRootWindow(); 
 
//create module 
var mainModule = angular.module("demoCRMApp", []); 
 
//declare the services you wish to inject to your module 
var directServices = ["loggerService"]; 
 
//use this method to inject all the services above to your module 
_root.appendServiceProxiesToModule(mainModule, directServices); 
 
//declare your controller with its dependencies - angular or custom ones. 
mainModule.controller("demoCRMController", ["$scope", "loggerService", 
    function ($scope, loggerService) { 
        loggerService.WriteLine("Demo CRM has been opened", 
_root.enghouse.enums.Severity.Debug, "demoCRM"); 
    }]); 
 
angular.element(document).ready(function ()  
{_root.app.GadgetComm.windowReady(window);} 
); 
 
On closing the DemoCRM gadget and re-opening it, an entry is written into the current ClientLog 
file indicating that the DemoCRM gadget has been opened. 
 
Note 
Every major browser provides the ability to debug javascript code using F12 or a menu option to 
invoke the Developer Tools. This includes the ability to examine and set breakpoints in source 
code and we highly recommend its use in developing gadgets.  
Because gadget files are dynamically loaded, you may have a problem seeing this code in the 
debugger applications of some browsers, such as Chrome. To ensure that the code is accessible 
in the debugger by the given name, add the following line at the end of a gadget’s javascript file: 
//# sourceURL=&lt;filename&gt;.js 
 
Replace &lt;filename.js&gt; with the name of your file (full path is not necessary).</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
59 
Functional gadget development 
Functional gadgets comprise a single script file that is the value of the Script URL for the gadget in 
CCSP AdminPoint. The script is loaded on user login by appending it to the main document of the 
CCSP UI web page, so it has access to all the functions defined in the scripts included by the main 
application. Although it has no associated HTML, it can still make use of AngularJS services and 
scopes by using an AngularJS injector. This section show how to achieve this. 
Note 
You can have multiple code files for a functional gadget by adding the files dynamically. The 
IntegrationsFunc.js file that is part of the framework to migrate legacy integrations to CCSP UI 
uses this technique. For an example of this, see the code in the IntegrationsFunc.js that is part of 
the Integrations.js gadget. 
Functional gadget code structure 
The Demo Chat Prompt functional gadget code currently looks like this. 
function StartUpDemoChatPrompt() { 
    alert("The Demo Chat Prompt gadget has been loaded"); 
} 
StartUpDemoChatPrompt(); 
 
Note 
Wrapping the functional gadget code in its own function or object is considered good practice 
and strongly recommended to prevent declared variables and functions from the gadget 
unnecessarily being made part of the global scope. 
 
To convert this code to a more useful function using AngularJS: 
1. 
As with the standard gadget, get a reference to the root CCSP UI window. 
//get reference to root window - the one containing our main modules and 
services 
var _root = GetRootWindow(); 
 
2. 
Get the AngularJS injector that provides access to the main application's services and objects. 
var localInjector = _root.angular.element("[ng-app]").injector(); 
 
3. 
To demonstrate that you can now access any of the CCSP UI services, as for the standard 
gadget, use the loggerService to output a line of text to the client log in the file system. 
var loggerService = localInjector.get('loggerService'); 
 
 loggerService.WriteLine("Demo Chat Prompt Functional Gadget has been 
loaded", _root.enghouse.enums.Severity.Debug, "demoChatPromptFunc");</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
60 
The complete code should look like this. 
function StartUpDemoChatPrompt() { 
 
    //get reference to root window - the one containing our main modules and 
services 
    var _root = GetRootWindow(); 
 
    //This line obtains the TouchPoint application's angularJS injector which 
provides access to all services and directives 
    var localInjector = _root.angular.element("[ng-app]").injector(); 
 
    //Can now get any service required 
    var loggerService = localInjector.get('loggerService'); 
 
    loggerService.WriteLine("Demo Chat Prompt Functional Gadget has been 
loaded", _root.enghouse.enums.Severity.Debug, "demoChatPromptFunc"); 
} 
StartUpDemoChatPrompt(); 
 
To see this output, relogin to the user and then check the client log file.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
61 
Using CCSP UI services and objects 
Subscribing to events 
For the DemoCRM, we use eventServiceWrapper to subscribe to the AgentStateChange event. 
The signature for the eventServiceWrapper subscribe() function is as follows. 
eventServiceWrapper.subscribe(event, context, callback, priority) 
In this case, the event is "AgentStateChange", the context is always null and no priority needs to be 
specified. In the callback, the current state of the agent is displayed on the HTML page. 
In the body element of the DemoCRM page, add the following. 
&lt;p&gt; 
    Current Agent State is: &lt;label id="agentState" /&gt; 
&lt;/p&gt; 
 
The "agentState" label displays the state from the AgentStateChange event. 
In the DemoCRM.js add the subscription to the AgentStateChange event as follows. 
var agentStateChangeId = eventServiceWrapper.subscribe("AgentStateChange", 
null, function (newState) { 
    document.getElementById("agentState").innerHTML = newState; 
}); 
 
Note 
The subscribe() function returns an id for that subscription, which should be stored so that it can 
be unsubscribed from later. 
 
The unsubscribe action should be done when the window is unloaded. It is good practice in 
AngularJS to use an injection of the window object rather than the window directly, so add this to 
the controller definition, as follows. 
mainModule.controller("demoCRMController", ["$scope", "$window", 
"loggerService", "eventServiceWrapper", 
    function ($scope, $window, loggerService, eventServiceWrapper) { 
 
Then add a handler for the unload() function. 
$window.onunload = function () { 
     loggerService.WriteLine("Demo CRM has been closed", 
_root.enghouse.enums.Severity.Debug, "demoCRM"); 
    eventServiceWrapper.unsubscribe(agentStateChangeId); 
}; 
 
To test the DemoCRM, reload the DemoCRM and change the availability of the agent a few times.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
62 
Publishing events 
Stop 
In general, user interface commands such as opening and closing windows can safely be 
published by custom gadgets. Any event that is received from the Agent Web Service must not be 
published by custom gadgets as this could seriously compromise the stability of CCSP UI. 
 
Events can be published using the publish() method of eventServiceWrapper, which has the 
following signature. 
eventServiceWrapper.publish(event, context, data) 
 
The event to open the Preferences dialog is openPreferences and it has no context or data. To 
demonstrate this event, add a button to the DemoCRM to display the Preferences dialog. 
Add the button to the HTML as below. 
&lt;p&gt; 
    &lt;button id="openPreferencesButton" ng-
click="openPreferences()"&gt;Preferences&lt;/button&gt; 
&lt;/p&gt; 
 
The ng-click attribute is the AngularJS equivalent of "onclick". The openPreferences() method is 
defined in the DemoCRM.js as below. 
$scope.openPreferences = function(){ 
 
eventServiceWrapper.publish("openPreferences", null, null); 
}; 
 
Reload the updated gadget and click the Preferences button that is now on the page. The 
Preferences dialog appears. 
You can display various other windows using this method. For example, you can display the 
Outgoing Call window by publishing the event OpenNewCallDialog. Add the following code to the 
HTML. 
&lt;form id="callForm" submit="callNumber()"&gt; 
&lt;label for="numberToCall"&gt;Number to call&lt;/label&gt; 
   &lt;input type="number" placeholder="e.g. 12345" id="numberToCall" /&gt;&lt;input 
type="submit" ng-click="callNumber()" value="Call"/&gt; 
&lt;/form&gt; 
 
This code creates a simple form on the page with an input for a number and button to click to call. 
This step is actually in preparation for a later stage in the walkthrough, but for now all this form 
does is open the Outgoing Call dialog.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
63 
In the DemoCRM.js, add the callNumber() function. 
$scope.callNumber = function () { 
    eventServiceWrapper.publish("OpenNewCallDialog", null, null); 
}; 
 
Reload the updated gadget and click the Call button. The Outgoing Call dialog now appears with 
the dialpad selected. 
For more examples of publishing simple UI commands, see the MiniCRM code in Server 
Components\TouchPoint\App\gadgets\MiniCRM\MiniCRM.js. 
Accessing the Agent object 
The DemoCRM shows blank for the agent state when it is first loaded and a value only appears 
when the state is changed in the availability gadget. To show the state on loading the page, you 
need to access the Agent object. 
In the DemoCRM.js file, add the agentServiceWrapper to the list of services available to the 
DemoCRM gadget, as follows. 
//declare the services you wish to inject to your module 
var directServices = ["loggerService", "eventServiceWrapper", 
"agentServiceWrapper"]; 
 
Also add it to the demoCRMController definition, as follows. 
mainModule.controller("demoCRMController", ["$scope", "$window", 
"loggerService", "eventServiceWrapper", "agentServiceWrapper",  
    function ($scope, $window, loggerService, eventServiceWrapper, 
agentServiceWrapper) { 
 
The agentServiceWrapper contains only one object, which is agent, but this encapsulates all the 
properties and actions associated with the logged in agent. To show the initial state of the agent on 
display of the DemoCRM, add the following. 
document.getElementById("agentState").innerHTML = 
agentServiceWrapper.agent.State; 
 
Caution 
The agentServiceWrapper provides the same Agent object that is used throughout CCSP UI. It is 
not a clone and it is not read-only, so any operations performed on this object is global. It is 
therefore imperative that customizations do not directly change properties on the Agent object 
(for example, never use agent.State = "Available").  
To avoid introducing errors such as the one above, use the constant-first method in 
comparisons, for example: 
if ("Available" == agent.State)…</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
64 
Use the Agent class methods to access properties and manipulate the Agent. The methods and 
properties are described in the Agent AJAX API Reference. 
Manipulating the Agent 
The Agent class provides methods for manipulating the Agent object from changing the agent state 
to logging out the agent. To demonstrate changing the agent state, add the following include to 
the HTML. 
&lt;script type="text/javascript" 
src="/TouchPoint/Ajax/Interface/Agent.js"&gt;&lt;/script&gt; 
 
This include is required to access the AgentState enumerate values. 
In the body, add a button to toggle the agent state. 
&lt;p&gt; 
    &lt;input type="button" ng-click="toggleAgentState()" value="Toggle Agent 
Availability" /&gt; 
&lt;/p&gt; 
 
Implement the toggleAgentState() function in DemoCRM.js as below. 
$scope.toggleAgentState = function () { 
    if ("Available" == agentServiceWrapper.agent.State) { 
        agentServiceWrapper.agent.GoReleased(AgentState.GenericReleased) 
    } else { 
       agentServiceWrapper.agent.GoAvailable(); 
    } 
}; 
 
Now when you reload the DemoCRM, clicking on the toggle button switches the agent state 
between Available and Released. 
As a further exercise, you can use the property agent.ReleaseCodesList to obtain the Release codes 
allocated to the Agent. Use this data to populate a drop down list of release codes that can be 
selected.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
65 
Making calls 
Making calls using the Agent 
There are two general methods of making outgoing calls. One is to use the dial service, the other is 
to use the AJAX API method on the Agent class. Using the latter, you can replace the publish 
OpenNewCallDialog event with the use of the agent.CallOutPhone() method to directly initiate the 
call. 
Comment out the existing code in the callNumber() method and add the following. 
agentServiceWrapper.agent.CallOutPhone(document.getElementById("numberToCall")
.value); 
 
Reload the DemoCRM and enter a valid phone number in the Number to Call text input and press 
Return or click Call. An outgoing call is now made to this number. 
Making calls using the dialService 
To use the dialService, it needs to be added to the list of injected services for the demoCRMApp 
module and the demoCRMController. The dialing action is then completed by using the Dial() 
function of the service, which has the following signature. 
Dial(type, name, target, needParam, parameterValue, configId, attendable, 
call) 
 
See the function description in the dialService Section for a full explanation of all the parameters, 
but for the purposes of replacing the use of the current CallOutPhone() call, only the type, name 
and target parameters need to be specified. 
Create another form on the web page by copying and pasting the current one, as follows. 
&lt;form id="dialForm" submit="dialNumber()"&gt; 
    &lt;label for="numberToDial"&gt;Number to dial&lt;/label&gt; 
    &lt;input type="number" placeholder="e.g. 12345" id="numberToDial" /&gt;   
    &lt;label for="calleeName"&gt;Callee name&lt;/label&gt; 
    &lt;input type="text" placeholder="e.g. A Customer" id="calleeName" /&gt;&lt;input 
type="submit" ng-click="dialNumber()" value="Dial" /&gt; 
&lt;/form&gt; 
 
There are two inputs here, one for the number itself and the other for the callee name. In the 
DemoCRM.js, define the $scope.dialNumber() function and include the following single statement. 
dialService.Dial("dialpad", document.getElementById("calleeName").value, 
document.getElementById("numberToDial").value, "", "", "", "", null); 
 
When you reload the DemoCRM gadget, the Number to dial form appears. Input a valid number 
and a name for the Callee, and then click Dial. The outgoing call is now made to this number, as 
with the CallOutPhone() method on the Agent.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
66 
dialService.Dial vs. Agent.CallOutPhone 
The Dial() function is the higher-level CCSP UI method of making calls, whereas the CallOutPhone() 
function is part of the low-level AJAX interface. The Dial() function actually uses CallOutPhone and 
its sibling functions (CallToSystem(), CallToAgent()), thereby providing a single, versatile dialing 
interface.  
The other important aspect is due to the dialService being part of the CCSP UI GUI. Calls made 
using the dialService are logged in the Recent calls list, whereas calls using the lower level functions 
are not. To see this difference, make calls to two different numbers using the "Call" and "Dial" 
forms in the DemoCRM gadget and then opening the Outgoing Call window. The call made using 
the Dial form is present in the Recent Calls list but the call made using the "Call" form is not. 
 
Note 
The value specified for the callee name (the "name" parameter in the Dial() function call) is not 
passed through the AJAX API to the server. It is purely for use within the CCSP UI as an extra 
identifier on the Recent Calls tab. 
General call handling 
The DemoCRM can currently make calls, but the call card needs to be used to hold and transfer, 
and hang up the call that has been made. To perform these functions from the DemoCRM, you 
need to obtain the Call object. 
Getting the Call object 
The most direct way of obtaining the Call object is to subscribe to the NewCall event as below. 
var newCallId = eventServiceWrapper.subscribe("NewCall", null, function 
(callEvent) { 
}); 
 
Note 
The parameter passed to the NewCall event callback function is an object containing the Call 
object, not the call object itself. 
 
When the NewCall event is received, the gadget must first decide if this is a call that it is interested 
in. An important point to note is that NewCall events are raised for all calls, including voice, email, 
outgoing and incoming calls, agent to agent calls, and monitoring calls. There are therefore a 
number of criteria that a gadget must consider before doing any further processing on the call. 
When the gadget decides that this is a call of interest, the gadget must do the following: 
• 
Store a reference to the Call object 
• 
Subscribe to the Call object's state changes 
Storing a reference to the call is crucial, because subsequent events that are raised against the call 
do not include the Call object in the callback function data, only its call Id.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
67 
Caution 
As with the Agent object, there is only one instance of each Call object in the CCSP UI application, 
so it must be handled with care by gadgets and integrations. Any manipulation of the Call object 
should be done through its exposed methods, and its properties should only be used for 
examination and never assigned to. 
 
To be notified of the call's state changes, the CallStateChange event is subscribed to using the 
context of the call's CallId, as in the following example. 
eventServiceWrapper.subscribe("CallStateChange", callEvent.call.CallId, 
$scope.OnCallStateChange); 
 
For the DemoCRM, the gadget is initially only interested in new voice calls that it has originated. So 
the criteria to check here is for the call type being "VOIP", the direction being outgoing, and the 
called number matching the input in the forms as below. 
var dialledNumber = ""; 
 
var newCallId = eventServiceWrapper.subscribe("NewCall", null, function 
(callEvent) { 
    if ("VOIP" == callEvent.call.CallInfo.Type.toUpperCase() &amp;&amp; "Outgoing" == 
callEvent.call.CallInfo.Direction &amp;&amp; dialledNumber == 
callEvent.call.CallInfo.Caller.Name) { 
        eventServiceWrapper.subscribe("CallStateChange", 
callEvent.call.CallId, onCallStateChange); 
    } 
}); 
 
A new variable has been introduced. The dialledNumber is set to the value of either the 
numberToCall or numberToDial input elements in the $scope.callNumber or $scope.dialNumber 
functions respectively, as in the following example. 
dialledNumber = document.getElementById("numberToCall").value; 
 
Despite its name, the CallInfo.Caller object for outgoing calls actually contains information related 
to the destination (callee). Unless an IVR has been set up to do so, the majority of the information is 
unpopulated and the Name property actually contains the dialed number (URI if a SIP address is 
used). If the callee is another agent, the value of Name is the destination agent's display name. 
The onCallStateChange() function initially just updates a new label in the HTML page that shows the 
current outgoing call state. 
&lt;p&gt; 
    Current Outgoing Call State: &lt;label id="callState"&gt;&lt;/label&gt; 
&lt;/p&gt;</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
68 
The function is defined as follows. 
onCallStateChange = function (callEvent) { 
     document.getElementById("callState").innerHTML = callEvent.state; 
}; 
 
Reload the DemoCRM and call a number using either of the Call or Dial forms. The new label shows 
the InCall state after the call is connected. In the call card, hold and unhold the call and observe the 
changes in the state value in the DemoCRM gadget. 
When you hang up the call, the state goes to WrapUp (if WrapUp codes have been defined for the 
Agent) and on completion of WrapUp the state goes to destructed. If you make a voice call from the 
Outgoing call window directly, or email and chat calls are received, these are ignored by the 
DemoCRM gadget. 
Holding the Call 
To perform operations on the Call, a reference to it must be maintained within the gadget. For the 
DemoCRM, it is a property of the demoCRMController scope, declared as below. 
$scope.outgoingCall = null; 
 
This is now usable in the HTML (without the $scope prefix) and is set in the callback for the NewCall 
event, as below. 
$scope.outgoingCall = callEvent.call; 
$scope.$apply(); 
 
The $scope.$apply() line is required to update the binding on the HTML page when the 
outgoingCall variable has been updated, because the NewCall event callback is outside of the 
AngularJS framework.  
Note 
Add a $scope.$apply() line at the end of the onCallStateChange() function for the same reason. 
 
With a reference to the Call object, the gadget can now display its properties and use its methods 
directly. Add a button in the HTML code to the Call state line to use to hold and pick up the 
outgoing call. To demonstrate the use of the outgoingCall object's properties, write the button as 
follows. 
&lt;button ng-click="toggleHold()"&gt;{{outgoingCall.State.toUpperCase()=="ONHOLD" ? 
"Pick Up Call" : "Hold Call"}}&lt;/button&gt; 
 
The code between two curly braces uses the Call object's state to display the correct available 
operation. Reload the gadget to see this in action. On making an outgoing call, the hold button 
shows the caption "Hold Call". When putting the call on hold from the call card, the button's 
caption changes to "Pick Up Call". 
To actually perform the hold/pick up operation, implement the toggleHold() function in the 
DemoCRM.js as below.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
69 
$scope.toggleHold = function () { 
    if ("InCall" == $scope.outgoingCall.State) { 
        $scope.outgoingCall.PutOnHold(); 
    } else { 
        $scope.outgoingCall.PickUp(); 
    } 
}; 
 
The function uses the Call object's PutOnHold() and PickUp() methods to perform the actions. 
Reload the DemoCRM gadget and use the Hold Call button to hold and retrieve the call. 
Hanging up the Call 
To hang up the call, you need to use the Call object's HangUp() method. Add a new button to the 
HTML code as below. 
&lt;button ng-click="hangUp()" ng-disabled="outgoingCall == null || 
outgoingCall.State == 'Destructed' || outgoingCall.State == 'WrapUp'"&gt;Hang 
Up&lt;/button&gt; 
 
In this case, the availability of the button is determined by the state of the outgoing call. The 
hangUp() function should be implemented in the DemoCRM.js as below. 
$scope.hangUp = function () { 
    $scope.outgoingCall.HangUp(); 
}; 
 
On reloading the DemoCRM gadget, the Hang Up button is displayed but disabled. Make a call 
from the gadget, and the Hang Up button becomes enabled. Click the Hang Up button in the 
gadget to end the call.</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
70 
Transferring calls 
Transferring a call to another destination involves a number of steps that are not complicated but 
have to be followed for the correct result to be achieved. These steps are normally performed using 
the GUI, for example, displaying the Outgoing Call window during a live call, entering the number, 
waiting for the destination to pick up the call and then transferring the call. It is possible to perform 
all these steps with a single button click from the gadget page, in what is known as a one-touch 
blind transfer.  
The three most common scenarios for a call transfer are: 
• 
Transfer to another number 
• 
Transfer to a System Entry Point 
• 
Transfer to another agent 
 
The steps are basically the same because only the initial function calls vary. All three are 
demonstrated with the DemoCRM.js. 
Basic steps in transferring a call 
For a call to be transferred by a gadget, the following must occur: 
• 
The destination number must be dialed and a call established 
• 
The new call (slave) must be associated with the original (master) call 
• 
If the slave call is accepted at the destination, the media for the slave call must be connected 
• 
After the slave call reaches the Active InCall state, it can be bridged with the master call 
 
After the slave call is bridged, the Agent's and therefore the gadget's involvement with the call 
ends. 
Initiating the transfer process can be performed using: 
• 
The Call object 
• 
The dialService 
Transferring to a number using the Call object 
To start a transfer to a number using the Call object, you must use its CallOutPhone() method. 
There are specific methods for transferring to another agent or to system but not for transferring 
to a dialed number. Add another form to the HTML code as below. 
&lt;form title="Transfer via Call" id="transferUsingCallForm" 
submit="transferUsingCall()"&gt; 
    &lt;label for="transferDestCall"&gt;Number to transfer to&lt;/label&gt; 
    &lt;input type="number" placeholder="e.g. 12345" id="transferDestCall" 
/&gt;&lt;input type="submit" ng-click="transferUsingCall()" value="Transfer using 
Call Object" /&gt; 
&lt;/form&gt;</p><p>CCSP UI Integrations Guide - 7.3 and 7.4 
71 
As indicated this is used to initiate the Transfer using the Call object. In the DemoCRM.js, the 
transferUsingCall() function is implemented as follows. 
$scope.transferUsingCall = function () { 
    if ($scope.outgoingCall) { 
        transferDestination = 
document.getElementById("transferDestCall").value; 
        $scope.outgoingCall.PutOnHold(); 
        $scope.outgoingCall.CallOutPhone(transferDestination); 
    } 
}; 
 
This initiates a new call that must now be captured by the gadget when its corresponding event is 
raised in CCSP UI.  
Note 
Before making the call, the outgoing call must be put on hold by the gadget. The NewCall event 
callback function therefore needs to be modified to check for the call being a slave call and 
having a master call with the same Id as the original outgoing call. 
 
else if (true == callEvent.call.CallInfo.IsBridgeSlave &amp;&amp; 
$scope.outgoingCall.CallId == callEvent.call.BridgeMasterCall.CallId) { 
$scope.slaveCall = callEvent.call; 
 
If the call satisfies this criteria, the gadget must now store this as the slave call and subscribe to its 
CallStateChange event to invoke the original call's Bridge() function when it goes to the InCall state. 
eventServiceWrapper.subscribe("CallStateChange", $scope.slaveCall.CallId, 
function (callEvent) { 
    //Only care about the inCall and Destructed states 
    if (callEvent.state == "InCall") { 
        $scope.outgoingCall.Bridge($scope.slaveCall.CallId); 
    } else if (callEvent.state == "Destructed") { 
        $scope.slaveCall = null; 
    } 
}); 
$scope.$apply();</p></section></article></body></html>